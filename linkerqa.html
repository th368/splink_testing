
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="linkerpred.html">
      
      
        <link rel="next" href="em_training_session.html">
      
      <link rel="icon" href="img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.15">
    
    
      
        <title>Visualisation and quality assurance - Splink</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="css/custom.css">
    
      <link rel="stylesheet" href="css/ansi-colours.css">
    
      <link rel="stylesheet" href="css/jupyter-cells.css">
    
      <link rel="stylesheet" href="css/pandas-dataframe.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#documentation-for-linker-object-methods-related-to-qa" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Splink" class="md-header__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Splink
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Visualisation and quality assurance
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Splink" class="md-nav__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="img/favicon.ico" alt="logo">

    </a>
    Splink
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="installations.html" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/00_Tutorial_Introduction.html" class="md-nav__link">
        0. Tutorial introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/01_Prerequisites.html" class="md-nav__link">
        1. Data prep prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/02_Exploratory_analysis.html" class="md-nav__link">
        2. Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/03_Blocking.html" class="md-nav__link">
        3. Blocking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/04_Estimating_model_parameters.html" class="md-nav__link">
        4. Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/05_Predicting_results.html" class="md-nav__link">
        5. Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/06_Visualising_predictions.html" class="md-nav__link">
        6. Visualising predictions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/07_Quality_assurance.html" class="md-nav__link">
        7. Quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="examples_index.html" class="md-nav__link">
        Examples index
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          DuckDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          DuckDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_deduplicate_50k_synthetic.html" class="md-nav__link">
        Deduplicate 50k rows historical persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_transactions.html" class="md-nav__link">
        Linking financial transactions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_link_only.html" class="md-nav__link">
        Linking two tables of persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_real_time_record_linkage.html" class="md-nav__link">
        Real time record linkage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_accuracy_analysis_from_labels_column.html" class="md-nav__link">
        QA from ground truth column
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_pairwise_labels.html" class="md-nav__link">
        Estimating m probabilities from labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_quick_and_dirty_persons.html" class="md-nav__link">
        Quick and dirty persons model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_febrl3.html" class="md-nav__link">
        Febrl3 Dedupe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_febrl4.html" class="md-nav__link">
        Febrl4 link-only
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          PySpark
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          PySpark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="demos/example_simple_pyspark.html" class="md-nav__link">
        Deduplication using Pyspark
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Topic Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Topic Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/backends.html" class="md-nav__link">
        Splink's SQL backends - Spark, DuckDB etc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/link_type.html" class="md-nav__link">
        Link type - linking vs deduping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/querying_splink_results.html" class="md-nav__link">
        Retrieving and querying Splink results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/feature_engineering.html" class="md-nav__link">
        Feature Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
          Comparing Records
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          Comparing Records
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/customising_comparisons.html" class="md-nav__link">
        Defining and customising comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/comparison_templates.html" class="md-nav__link">
        Out-of-the-box comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5_3" id="__nav_5_5_3_label" tabindex="0">
          Comparing strings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5_3">
          <span class="md-nav__icon md-icon"></span>
          Comparing strings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/choosing_comparators.html" class="md-nav__link">
        Choosing comparators and thresholds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/comparators.html" class="md-nav__link">
        String comparators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/phonetic.html" class="md-nav__link">
        Phonetic transformations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/term-frequency.html" class="md-nav__link">
        Term-Frequency adjustments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
      
      
      
        <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
          Performance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_6">
          <span class="md-nav__icon md-icon"></span>
          Performance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/drivers_of_performance.html" class="md-nav__link">
        Run times, performance and linking large data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/blocking_rules.html" class="md-nav__link">
        Blocking rules for prediction vs estimation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/optimising_spark.html" class="md-nav__link">
        Optimising Spark performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="topic_guides/salting.html" class="md-nav__link">
        Salting blocking rules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          Linker API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Linker API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="linker.html" class="md-nav__link">
        Full API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="linkerexp.html" class="md-nav__link">
        Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="linkerest.html" class="md-nav__link">
        Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="linkerpred.html" class="md-nav__link">
        Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Visualisation and quality assurance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="linkerqa.html" class="md-nav__link md-nav__link--active">
        Visualisation and quality assurance
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker" class="md-nav__link">
    splink.linker.Linker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.cluster_studio_dashboard" class="md-nav__link">
    cluster_studio_dashboard()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.comparison_viewer_dashboard" class="md-nav__link">
    comparison_viewer_dashboard()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.m_u_parameters_chart" class="md-nav__link">
    m_u_parameters_chart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.match_weights_chart" class="md-nav__link">
    match_weights_chart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.parameter_estimate_comparisons_chart" class="md-nav__link">
    parameter_estimate_comparisons_chart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.precision_recall_chart_from_labels_column" class="md-nav__link">
    precision_recall_chart_from_labels_column()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.precision_recall_chart_from_labels_table" class="md-nav__link">
    precision_recall_chart_from_labels_table()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.prediction_errors_from_labels_table" class="md-nav__link">
    prediction_errors_from_labels_table()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.roc_chart_from_labels_column" class="md-nav__link">
    roc_chart_from_labels_column()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.roc_chart_from_labels_table" class="md-nav__link">
    roc_chart_from_labels_table()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.truth_space_table_from_labels_column" class="md-nav__link">
    truth_space_table_from_labels_column()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.truth_space_table_from_labels_table" class="md-nav__link">
    truth_space_table_from_labels_table()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.unlinkables_chart" class="md-nav__link">
    unlinkables_chart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.waterfall_chart" class="md-nav__link">
    waterfall_chart()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="em_training_session.html" class="md-nav__link">
        EM Training Session API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="SplinkDataFrame.html" class="md-nav__link">
        SplinkDataFrame API
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          Comparisons API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Comparisons API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="comparison.html" class="md-nav__link">
        Comparison
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="comparison_level.html" class="md-nav__link">
        Comparison Level
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
          Comparisons Library API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          Comparisons Library API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="comparison_library.html" class="md-nav__link">
        Comparison Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="comparison_template_library.html" class="md-nav__link">
        Comparison Template Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="comparison_level_library.html" class="md-nav__link">
        Comparison Level Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="comparison_level_composition.html" class="md-nav__link">
        Comparison Composition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="settingseditor/editor.html" class="md-nav__link">
        Settings Editor
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="settings_dict_guide.html" class="md-nav__link">
        Settings dictionary reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Developers' guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Developers' guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
      
      
      
        <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
          Making Changes to Splink
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_1">
          <span class="md-nav__icon md-icon"></span>
          Making Changes to Splink
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/changing_splink/building_env_locally.html" class="md-nav__link">
        Building a Virtual Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/changing_splink/lint.html" class="md-nav__link">
        Linting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/changing_splink/build_docs_locally.html" class="md-nav__link">
        Building Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/changing_splink/testing.html" class="md-nav__link">
        Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/changing_splink/releases.html" class="md-nav__link">
        Releasing a Package Version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/caching.html" class="md-nav__link">
        Caching and pipelining
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/debug_modes.html" class="md-nav__link">
        Understanding and debugging Splink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/spark_pipelining_and_caching.html" class="md-nav__link">
        Spark caching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/transpilation.html" class="md-nav__link">
        Transpilation using sqlglot
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_6" >
      
      
      
        <label class="md-nav__link" for="__nav_9_6" id="__nav_9_6_label" tabindex="0">
          Comparisons and comparison levels
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_6">
          <span class="md-nav__icon md-icon"></span>
          Comparisons and comparison levels
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/comparisons/new_library_comparisons_and_levels.html" class="md-nav__link">
        Creating new comparisons and comparison levels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/comparisons/extending_library_comparisons_and_levels.html" class="md-nav__link">
        Extending existing comparisons and comparison levels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="dev_guides/udfs.html" class="md-nav__link">
        User-Defined Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker" class="md-nav__link">
    splink.linker.Linker
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.cluster_studio_dashboard" class="md-nav__link">
    cluster_studio_dashboard()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.comparison_viewer_dashboard" class="md-nav__link">
    comparison_viewer_dashboard()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.m_u_parameters_chart" class="md-nav__link">
    m_u_parameters_chart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.match_weights_chart" class="md-nav__link">
    match_weights_chart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.parameter_estimate_comparisons_chart" class="md-nav__link">
    parameter_estimate_comparisons_chart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.precision_recall_chart_from_labels_column" class="md-nav__link">
    precision_recall_chart_from_labels_column()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.precision_recall_chart_from_labels_table" class="md-nav__link">
    precision_recall_chart_from_labels_table()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.prediction_errors_from_labels_table" class="md-nav__link">
    prediction_errors_from_labels_table()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.roc_chart_from_labels_column" class="md-nav__link">
    roc_chart_from_labels_column()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.roc_chart_from_labels_table" class="md-nav__link">
    roc_chart_from_labels_table()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.truth_space_table_from_labels_column" class="md-nav__link">
    truth_space_table_from_labels_column()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.truth_space_table_from_labels_table" class="md-nav__link">
    truth_space_table_from_labels_table()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.unlinkables_chart" class="md-nav__link">
    unlinkables_chart()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#splink.linker.Linker.waterfall_chart" class="md-nav__link">
    waterfall_chart()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  

  <nav class="md-tags" >
    
      
      
        <span class="md-tag">API</span>
      
    
      
      
        <span class="md-tag">QA</span>
      
    
      
      
        <span class="md-tag">Clusters</span>
      
    
      
      
        <span class="md-tag">Labels</span>
      
    
  </nav>



  
  


<h1 id="documentation-for-linker-object-methods-related-to-qa">Documentation for <code>Linker</code> object methods related to QA<a class="headerlink" href="#documentation-for-linker-object-methods-related-to-qa" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-class">


<a id="splink.linker.Linker"></a>
  <div class="doc doc-contents first">

  
      <p>The Linker object manages the data linkage process and holds the data linkage
model.</p>
<p>Most of Splink's functionality can  be accessed by calling methods (functions)
on the linker, such as <code>linker.predict()</code>, <code>linker.profile_columns()</code> etc.</p>
<p>The Linker class is intended for subclassing for specific backends, e.g.
a <code>DuckDBLinker</code>.</p>


        <details class="quote">
          <summary>Source code in <code>splink/linker.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span>
<span class="normal">1685</span>
<span class="normal">1686</span>
<span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span>
<span class="normal">1698</span>
<span class="normal">1699</span>
<span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span>
<span class="normal">1716</span>
<span class="normal">1717</span>
<span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span>
<span class="normal">1779</span>
<span class="normal">1780</span>
<span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span>
<span class="normal">1802</span>
<span class="normal">1803</span>
<span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span>
<span class="normal">1810</span>
<span class="normal">1811</span>
<span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span>
<span class="normal">1842</span>
<span class="normal">1843</span>
<span class="normal">1844</span>
<span class="normal">1845</span>
<span class="normal">1846</span>
<span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span>
<span class="normal">1858</span>
<span class="normal">1859</span>
<span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span>
<span class="normal">1870</span>
<span class="normal">1871</span>
<span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span>
<span class="normal">1892</span>
<span class="normal">1893</span>
<span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span>
<span class="normal">1912</span>
<span class="normal">1913</span>
<span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span>
<span class="normal">1926</span>
<span class="normal">1927</span>
<span class="normal">1928</span>
<span class="normal">1929</span>
<span class="normal">1930</span>
<span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span>
<span class="normal">1937</span>
<span class="normal">1938</span>
<span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span>
<span class="normal">1980</span>
<span class="normal">1981</span>
<span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span>
<span class="normal">2016</span>
<span class="normal">2017</span>
<span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span>
<span class="normal">2038</span>
<span class="normal">2039</span>
<span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span>
<span class="normal">2267</span>
<span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span>
<span class="normal">2300</span>
<span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span>
<span class="normal">2336</span>
<span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span>
<span class="normal">2376</span>
<span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span>
<span class="normal">2415</span>
<span class="normal">2416</span>
<span class="normal">2417</span>
<span class="normal">2418</span>
<span class="normal">2419</span>
<span class="normal">2420</span>
<span class="normal">2421</span>
<span class="normal">2422</span>
<span class="normal">2423</span>
<span class="normal">2424</span>
<span class="normal">2425</span>
<span class="normal">2426</span>
<span class="normal">2427</span>
<span class="normal">2428</span>
<span class="normal">2429</span>
<span class="normal">2430</span>
<span class="normal">2431</span>
<span class="normal">2432</span>
<span class="normal">2433</span>
<span class="normal">2434</span>
<span class="normal">2435</span>
<span class="normal">2436</span>
<span class="normal">2437</span>
<span class="normal">2438</span>
<span class="normal">2439</span>
<span class="normal">2440</span>
<span class="normal">2441</span>
<span class="normal">2442</span>
<span class="normal">2443</span>
<span class="normal">2444</span>
<span class="normal">2445</span>
<span class="normal">2446</span>
<span class="normal">2447</span>
<span class="normal">2448</span>
<span class="normal">2449</span>
<span class="normal">2450</span>
<span class="normal">2451</span>
<span class="normal">2452</span>
<span class="normal">2453</span>
<span class="normal">2454</span>
<span class="normal">2455</span>
<span class="normal">2456</span>
<span class="normal">2457</span>
<span class="normal">2458</span>
<span class="normal">2459</span>
<span class="normal">2460</span>
<span class="normal">2461</span>
<span class="normal">2462</span>
<span class="normal">2463</span>
<span class="normal">2464</span>
<span class="normal">2465</span>
<span class="normal">2466</span>
<span class="normal">2467</span>
<span class="normal">2468</span>
<span class="normal">2469</span>
<span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span>
<span class="normal">2501</span>
<span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span>
<span class="normal">2542</span>
<span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span>
<span class="normal">2598</span>
<span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span>
<span class="normal">2626</span>
<span class="normal">2627</span>
<span class="normal">2628</span>
<span class="normal">2629</span>
<span class="normal">2630</span>
<span class="normal">2631</span>
<span class="normal">2632</span>
<span class="normal">2633</span>
<span class="normal">2634</span>
<span class="normal">2635</span>
<span class="normal">2636</span>
<span class="normal">2637</span>
<span class="normal">2638</span>
<span class="normal">2639</span>
<span class="normal">2640</span>
<span class="normal">2641</span>
<span class="normal">2642</span>
<span class="normal">2643</span>
<span class="normal">2644</span>
<span class="normal">2645</span>
<span class="normal">2646</span>
<span class="normal">2647</span>
<span class="normal">2648</span>
<span class="normal">2649</span>
<span class="normal">2650</span>
<span class="normal">2651</span>
<span class="normal">2652</span>
<span class="normal">2653</span>
<span class="normal">2654</span>
<span class="normal">2655</span>
<span class="normal">2656</span>
<span class="normal">2657</span>
<span class="normal">2658</span>
<span class="normal">2659</span>
<span class="normal">2660</span>
<span class="normal">2661</span>
<span class="normal">2662</span>
<span class="normal">2663</span>
<span class="normal">2664</span>
<span class="normal">2665</span>
<span class="normal">2666</span>
<span class="normal">2667</span>
<span class="normal">2668</span>
<span class="normal">2669</span>
<span class="normal">2670</span>
<span class="normal">2671</span>
<span class="normal">2672</span>
<span class="normal">2673</span>
<span class="normal">2674</span>
<span class="normal">2675</span>
<span class="normal">2676</span>
<span class="normal">2677</span>
<span class="normal">2678</span>
<span class="normal">2679</span>
<span class="normal">2680</span>
<span class="normal">2681</span>
<span class="normal">2682</span>
<span class="normal">2683</span>
<span class="normal">2684</span>
<span class="normal">2685</span>
<span class="normal">2686</span>
<span class="normal">2687</span>
<span class="normal">2688</span>
<span class="normal">2689</span>
<span class="normal">2690</span>
<span class="normal">2691</span>
<span class="normal">2692</span>
<span class="normal">2693</span>
<span class="normal">2694</span>
<span class="normal">2695</span>
<span class="normal">2696</span>
<span class="normal">2697</span>
<span class="normal">2698</span>
<span class="normal">2699</span>
<span class="normal">2700</span>
<span class="normal">2701</span>
<span class="normal">2702</span>
<span class="normal">2703</span>
<span class="normal">2704</span>
<span class="normal">2705</span>
<span class="normal">2706</span>
<span class="normal">2707</span>
<span class="normal">2708</span>
<span class="normal">2709</span>
<span class="normal">2710</span>
<span class="normal">2711</span>
<span class="normal">2712</span>
<span class="normal">2713</span>
<span class="normal">2714</span>
<span class="normal">2715</span>
<span class="normal">2716</span>
<span class="normal">2717</span>
<span class="normal">2718</span>
<span class="normal">2719</span>
<span class="normal">2720</span>
<span class="normal">2721</span>
<span class="normal">2722</span>
<span class="normal">2723</span>
<span class="normal">2724</span>
<span class="normal">2725</span>
<span class="normal">2726</span>
<span class="normal">2727</span>
<span class="normal">2728</span>
<span class="normal">2729</span>
<span class="normal">2730</span>
<span class="normal">2731</span>
<span class="normal">2732</span>
<span class="normal">2733</span>
<span class="normal">2734</span>
<span class="normal">2735</span>
<span class="normal">2736</span>
<span class="normal">2737</span>
<span class="normal">2738</span>
<span class="normal">2739</span>
<span class="normal">2740</span>
<span class="normal">2741</span>
<span class="normal">2742</span>
<span class="normal">2743</span>
<span class="normal">2744</span>
<span class="normal">2745</span>
<span class="normal">2746</span>
<span class="normal">2747</span>
<span class="normal">2748</span>
<span class="normal">2749</span>
<span class="normal">2750</span>
<span class="normal">2751</span>
<span class="normal">2752</span>
<span class="normal">2753</span>
<span class="normal">2754</span>
<span class="normal">2755</span>
<span class="normal">2756</span>
<span class="normal">2757</span>
<span class="normal">2758</span>
<span class="normal">2759</span>
<span class="normal">2760</span>
<span class="normal">2761</span>
<span class="normal">2762</span>
<span class="normal">2763</span>
<span class="normal">2764</span>
<span class="normal">2765</span>
<span class="normal">2766</span>
<span class="normal">2767</span>
<span class="normal">2768</span>
<span class="normal">2769</span>
<span class="normal">2770</span>
<span class="normal">2771</span>
<span class="normal">2772</span>
<span class="normal">2773</span>
<span class="normal">2774</span>
<span class="normal">2775</span>
<span class="normal">2776</span>
<span class="normal">2777</span>
<span class="normal">2778</span>
<span class="normal">2779</span>
<span class="normal">2780</span>
<span class="normal">2781</span>
<span class="normal">2782</span>
<span class="normal">2783</span>
<span class="normal">2784</span>
<span class="normal">2785</span>
<span class="normal">2786</span>
<span class="normal">2787</span>
<span class="normal">2788</span>
<span class="normal">2789</span>
<span class="normal">2790</span>
<span class="normal">2791</span>
<span class="normal">2792</span>
<span class="normal">2793</span>
<span class="normal">2794</span>
<span class="normal">2795</span>
<span class="normal">2796</span>
<span class="normal">2797</span>
<span class="normal">2798</span>
<span class="normal">2799</span>
<span class="normal">2800</span>
<span class="normal">2801</span>
<span class="normal">2802</span>
<span class="normal">2803</span>
<span class="normal">2804</span>
<span class="normal">2805</span>
<span class="normal">2806</span>
<span class="normal">2807</span>
<span class="normal">2808</span>
<span class="normal">2809</span>
<span class="normal">2810</span>
<span class="normal">2811</span>
<span class="normal">2812</span>
<span class="normal">2813</span>
<span class="normal">2814</span>
<span class="normal">2815</span>
<span class="normal">2816</span>
<span class="normal">2817</span>
<span class="normal">2818</span>
<span class="normal">2819</span>
<span class="normal">2820</span>
<span class="normal">2821</span>
<span class="normal">2822</span>
<span class="normal">2823</span>
<span class="normal">2824</span>
<span class="normal">2825</span>
<span class="normal">2826</span>
<span class="normal">2827</span>
<span class="normal">2828</span>
<span class="normal">2829</span>
<span class="normal">2830</span>
<span class="normal">2831</span>
<span class="normal">2832</span>
<span class="normal">2833</span>
<span class="normal">2834</span>
<span class="normal">2835</span>
<span class="normal">2836</span>
<span class="normal">2837</span>
<span class="normal">2838</span>
<span class="normal">2839</span>
<span class="normal">2840</span>
<span class="normal">2841</span>
<span class="normal">2842</span>
<span class="normal">2843</span>
<span class="normal">2844</span>
<span class="normal">2845</span>
<span class="normal">2846</span>
<span class="normal">2847</span>
<span class="normal">2848</span>
<span class="normal">2849</span>
<span class="normal">2850</span>
<span class="normal">2851</span>
<span class="normal">2852</span>
<span class="normal">2853</span>
<span class="normal">2854</span>
<span class="normal">2855</span>
<span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span>
<span class="normal">2881</span>
<span class="normal">2882</span>
<span class="normal">2883</span>
<span class="normal">2884</span>
<span class="normal">2885</span>
<span class="normal">2886</span>
<span class="normal">2887</span>
<span class="normal">2888</span>
<span class="normal">2889</span>
<span class="normal">2890</span>
<span class="normal">2891</span>
<span class="normal">2892</span>
<span class="normal">2893</span>
<span class="normal">2894</span>
<span class="normal">2895</span>
<span class="normal">2896</span>
<span class="normal">2897</span>
<span class="normal">2898</span>
<span class="normal">2899</span>
<span class="normal">2900</span>
<span class="normal">2901</span>
<span class="normal">2902</span>
<span class="normal">2903</span>
<span class="normal">2904</span>
<span class="normal">2905</span>
<span class="normal">2906</span>
<span class="normal">2907</span>
<span class="normal">2908</span>
<span class="normal">2909</span>
<span class="normal">2910</span>
<span class="normal">2911</span>
<span class="normal">2912</span>
<span class="normal">2913</span>
<span class="normal">2914</span>
<span class="normal">2915</span>
<span class="normal">2916</span>
<span class="normal">2917</span>
<span class="normal">2918</span>
<span class="normal">2919</span>
<span class="normal">2920</span>
<span class="normal">2921</span>
<span class="normal">2922</span>
<span class="normal">2923</span>
<span class="normal">2924</span>
<span class="normal">2925</span>
<span class="normal">2926</span>
<span class="normal">2927</span>
<span class="normal">2928</span>
<span class="normal">2929</span>
<span class="normal">2930</span>
<span class="normal">2931</span>
<span class="normal">2932</span>
<span class="normal">2933</span>
<span class="normal">2934</span>
<span class="normal">2935</span>
<span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span>
<span class="normal">2962</span>
<span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span>
<span class="normal">3028</span>
<span class="normal">3029</span>
<span class="normal">3030</span>
<span class="normal">3031</span>
<span class="normal">3032</span>
<span class="normal">3033</span>
<span class="normal">3034</span>
<span class="normal">3035</span>
<span class="normal">3036</span>
<span class="normal">3037</span>
<span class="normal">3038</span>
<span class="normal">3039</span>
<span class="normal">3040</span>
<span class="normal">3041</span>
<span class="normal">3042</span>
<span class="normal">3043</span>
<span class="normal">3044</span>
<span class="normal">3045</span>
<span class="normal">3046</span>
<span class="normal">3047</span>
<span class="normal">3048</span>
<span class="normal">3049</span>
<span class="normal">3050</span>
<span class="normal">3051</span>
<span class="normal">3052</span>
<span class="normal">3053</span>
<span class="normal">3054</span>
<span class="normal">3055</span>
<span class="normal">3056</span>
<span class="normal">3057</span>
<span class="normal">3058</span>
<span class="normal">3059</span>
<span class="normal">3060</span>
<span class="normal">3061</span>
<span class="normal">3062</span>
<span class="normal">3063</span>
<span class="normal">3064</span>
<span class="normal">3065</span>
<span class="normal">3066</span>
<span class="normal">3067</span>
<span class="normal">3068</span>
<span class="normal">3069</span>
<span class="normal">3070</span>
<span class="normal">3071</span>
<span class="normal">3072</span>
<span class="normal">3073</span>
<span class="normal">3074</span>
<span class="normal">3075</span>
<span class="normal">3076</span>
<span class="normal">3077</span>
<span class="normal">3078</span>
<span class="normal">3079</span>
<span class="normal">3080</span>
<span class="normal">3081</span>
<span class="normal">3082</span>
<span class="normal">3083</span>
<span class="normal">3084</span>
<span class="normal">3085</span>
<span class="normal">3086</span>
<span class="normal">3087</span>
<span class="normal">3088</span>
<span class="normal">3089</span>
<span class="normal">3090</span>
<span class="normal">3091</span>
<span class="normal">3092</span>
<span class="normal">3093</span>
<span class="normal">3094</span>
<span class="normal">3095</span>
<span class="normal">3096</span>
<span class="normal">3097</span>
<span class="normal">3098</span>
<span class="normal">3099</span>
<span class="normal">3100</span>
<span class="normal">3101</span>
<span class="normal">3102</span>
<span class="normal">3103</span>
<span class="normal">3104</span>
<span class="normal">3105</span>
<span class="normal">3106</span>
<span class="normal">3107</span>
<span class="normal">3108</span>
<span class="normal">3109</span>
<span class="normal">3110</span>
<span class="normal">3111</span>
<span class="normal">3112</span>
<span class="normal">3113</span>
<span class="normal">3114</span>
<span class="normal">3115</span>
<span class="normal">3116</span>
<span class="normal">3117</span>
<span class="normal">3118</span>
<span class="normal">3119</span>
<span class="normal">3120</span>
<span class="normal">3121</span>
<span class="normal">3122</span>
<span class="normal">3123</span>
<span class="normal">3124</span>
<span class="normal">3125</span>
<span class="normal">3126</span>
<span class="normal">3127</span>
<span class="normal">3128</span>
<span class="normal">3129</span>
<span class="normal">3130</span>
<span class="normal">3131</span>
<span class="normal">3132</span>
<span class="normal">3133</span>
<span class="normal">3134</span>
<span class="normal">3135</span>
<span class="normal">3136</span>
<span class="normal">3137</span>
<span class="normal">3138</span>
<span class="normal">3139</span>
<span class="normal">3140</span>
<span class="normal">3141</span>
<span class="normal">3142</span>
<span class="normal">3143</span>
<span class="normal">3144</span>
<span class="normal">3145</span>
<span class="normal">3146</span>
<span class="normal">3147</span>
<span class="normal">3148</span>
<span class="normal">3149</span>
<span class="normal">3150</span>
<span class="normal">3151</span>
<span class="normal">3152</span>
<span class="normal">3153</span>
<span class="normal">3154</span>
<span class="normal">3155</span>
<span class="normal">3156</span>
<span class="normal">3157</span>
<span class="normal">3158</span>
<span class="normal">3159</span>
<span class="normal">3160</span>
<span class="normal">3161</span>
<span class="normal">3162</span>
<span class="normal">3163</span>
<span class="normal">3164</span>
<span class="normal">3165</span>
<span class="normal">3166</span>
<span class="normal">3167</span>
<span class="normal">3168</span>
<span class="normal">3169</span>
<span class="normal">3170</span>
<span class="normal">3171</span>
<span class="normal">3172</span>
<span class="normal">3173</span>
<span class="normal">3174</span>
<span class="normal">3175</span>
<span class="normal">3176</span>
<span class="normal">3177</span>
<span class="normal">3178</span>
<span class="normal">3179</span>
<span class="normal">3180</span>
<span class="normal">3181</span>
<span class="normal">3182</span>
<span class="normal">3183</span>
<span class="normal">3184</span>
<span class="normal">3185</span>
<span class="normal">3186</span>
<span class="normal">3187</span>
<span class="normal">3188</span>
<span class="normal">3189</span>
<span class="normal">3190</span>
<span class="normal">3191</span>
<span class="normal">3192</span>
<span class="normal">3193</span>
<span class="normal">3194</span>
<span class="normal">3195</span>
<span class="normal">3196</span>
<span class="normal">3197</span>
<span class="normal">3198</span>
<span class="normal">3199</span>
<span class="normal">3200</span>
<span class="normal">3201</span>
<span class="normal">3202</span>
<span class="normal">3203</span>
<span class="normal">3204</span>
<span class="normal">3205</span>
<span class="normal">3206</span>
<span class="normal">3207</span>
<span class="normal">3208</span>
<span class="normal">3209</span>
<span class="normal">3210</span>
<span class="normal">3211</span>
<span class="normal">3212</span>
<span class="normal">3213</span>
<span class="normal">3214</span>
<span class="normal">3215</span>
<span class="normal">3216</span>
<span class="normal">3217</span>
<span class="normal">3218</span>
<span class="normal">3219</span>
<span class="normal">3220</span>
<span class="normal">3221</span>
<span class="normal">3222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Linker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The Linker object manages the data linkage process and holds the data linkage</span>
<span class="sd">    model.</span>

<span class="sd">    Most of Splink&#39;s functionality can  be accessed by calling methods (functions)</span>
<span class="sd">    on the linker, such as `linker.predict()`, `linker.profile_columns()` etc.</span>

<span class="sd">    The Linker class is intended for subclassing for specific backends, e.g.</span>
<span class="sd">    a `DuckDBLinker`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_table_or_tables</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">settings_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
        <span class="n">accepted_df_dtypes</span><span class="p">,</span>
        <span class="n">set_up_basic_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">input_table_aliases</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise the linker object, which manages the data linkage process and</span>
<span class="sd">        holds the data linkage model.</span>

<span class="sd">        Examples:</span>
<span class="sd">            === &quot;DuckDB&quot;</span>
<span class="sd">                Dedupe</span>
<span class="sd">                ```py</span>
<span class="sd">                df = pd.read_csv(&quot;data_to_dedupe.csv&quot;)</span>
<span class="sd">                linker = DuckDBLinker(df, settings_dict)</span>
<span class="sd">                ```</span>
<span class="sd">                Link</span>
<span class="sd">                ```py</span>
<span class="sd">                df_1 = pd.read_parquet(&quot;table_1/&quot;)</span>
<span class="sd">                df_2 = pd.read_parquet(&quot;table_2/&quot;)</span>
<span class="sd">                linker = DuckDBLinker(</span>
<span class="sd">                    [df_1, df_2],</span>
<span class="sd">                    settings_dict,</span>
<span class="sd">                    input_table_aliases=[&quot;customers&quot;, &quot;contact_center_callers&quot;]</span>
<span class="sd">                    )</span>
<span class="sd">                ```</span>
<span class="sd">                Dedupe with a pre-trained model read from a json file</span>
<span class="sd">                ```py</span>
<span class="sd">                df = pd.read_csv(&quot;data_to_dedupe.csv&quot;)</span>
<span class="sd">                linker = DuckDBLinker(df, &quot;model.json&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Spark&quot;</span>
<span class="sd">                Dedupe</span>
<span class="sd">                ```py</span>
<span class="sd">                df = spark.read.csv(&quot;data_to_dedupe.csv&quot;)</span>
<span class="sd">                linker = SparkLinker(df, settings_dict)</span>
<span class="sd">                ```</span>
<span class="sd">                Link</span>
<span class="sd">                ```py</span>
<span class="sd">                df_1 = spark.read.parquet(&quot;table_1/&quot;)</span>
<span class="sd">                df_2 = spark.read.parquet(&quot;table_2/&quot;)</span>
<span class="sd">                linker = SparkLinker(</span>
<span class="sd">                    [df_1, df_2],</span>
<span class="sd">                    settings_dict,</span>
<span class="sd">                    input_table_aliases=[&quot;customers&quot;, &quot;contact_center_callers&quot;]</span>
<span class="sd">                    )</span>
<span class="sd">                ```</span>
<span class="sd">                Dedupe with a pre-trained model read from a json file</span>
<span class="sd">                ```py</span>
<span class="sd">                df = spark.read.csv(&quot;data_to_dedupe.csv&quot;)</span>
<span class="sd">                linker = SparkLinker(df, &quot;model.json&quot;)</span>
<span class="sd">                ```</span>

<span class="sd">        Args:</span>
<span class="sd">            input_table_or_tables (Union[str, list]): Input data into the linkage model.</span>
<span class="sd">                Either a single string (the name of a table in a database) for</span>
<span class="sd">                deduplication jobs, or a list of strings  (the name of tables in a</span>
<span class="sd">                database) for link_only or link_and_dedupe.  For some linkers, such as</span>
<span class="sd">                the DuckDBLinker and the SparkLinker, it&#39;s also possible to pass in</span>
<span class="sd">                dataframes (Pandas and Spark respectively) rather than strings.</span>
<span class="sd">            settings_dict (dict | Path, optional): A Splink settings dictionary, or a</span>
<span class="sd">                path to a json defining a settingss dictionary or pre-trained model.</span>
<span class="sd">                If not provided when the object is created, can later be added using</span>
<span class="sd">                `linker.load_settings()` or `linker.load_model()` Defaults to None.</span>
<span class="sd">            set_up_basic_logging (bool, optional): If true, sets ups up basic logging</span>
<span class="sd">                so that Splink sends messages at INFO level to stdout. Defaults to True.</span>
<span class="sd">            input_table_aliases (Union[str, list], optional): Labels assigned to</span>
<span class="sd">                input tables in Splink outputs.  If the names of the tables in the</span>
<span class="sd">                input database are long or unspecific, this argument can be used</span>
<span class="sd">                to attach more easily readable/interpretable names. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">set_up_basic_logging</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
                <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">splink_logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;splink&quot;</span><span class="p">)</span>
            <span class="n">splink_logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span> <span class="o">=</span> <span class="n">SQLPipeline</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_names_of_tables_created_by_splink</span><span class="p">:</span> <span class="nb">set</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="n">CacheDictWithLogging</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="c1"># Run if you&#39;ve entered a filepath</span>
            <span class="c1"># feed it a blank settings dictionary</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_settings_objs</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">settings_dict</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_settings_objs</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">)</span>

        <span class="n">homogenised_tables</span><span class="p">,</span> <span class="n">homogenised_aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_input_tables</span><span class="p">(</span>
            <span class="n">input_table_or_tables</span><span class="p">,</span>
            <span class="n">input_table_aliases</span><span class="p">,</span>
            <span class="n">accepted_df_dtypes</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_input_tables_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_input_tables_dict</span><span class="p">(</span>
            <span class="n">homogenised_tables</span><span class="p">,</span> <span class="n">homogenised_aliases</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_input_dfs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_em_training_sessions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_find_new_matches_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_train_u_using_random_sample_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compare_two_records_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_self_link_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_analyse_blocking_mode</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deterministic_link_mode</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_cache_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_cache_uid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid_no_settings</span>

    <span class="nd">@_cache_uid</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">_cache_uid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_cache_uid</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid_no_settings</span> <span class="o">=</span> <span class="n">value</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_settings_obj</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Settings</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;You did not provide a settings dictionary when you &quot;</span>
                <span class="s2">&quot;created the linker.  To continue, you need to provide a settings &quot;</span>
                <span class="s2">&quot;dictionary using the `load_settings()` method on your linker &quot;</span>
                <span class="s2">&quot;object. i.e. linker.load_settings(settings_dict)&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_input_tablename_l</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_new_matches_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_link_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_two_records_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__compare_two_records_left_with_tf&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_u_using_random_sample_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_concat_with_tf_sample&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyse_blocking_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_concat&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_two_dataset_link_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_concat_with_tf_left&quot;</span>

        <span class="k">return</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_input_tablename_r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_new_matches_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_new_records_with_tf&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_self_link_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_two_records_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__compare_two_records_right_with_tf&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_u_using_random_sample_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_concat_with_tf_sample&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyse_blocking_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink__df_concat&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_two_dataset_link_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;__splink_df_concat_with_tf_right&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_source_dataset_column_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Used throughout the scripts to feed our SQL</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_source_dataset_column_name_is_required</span><span class="p">:</span>
            <span class="n">df_obj</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_tables_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="n">columns</span> <span class="o">=</span> <span class="n">df_obj</span><span class="o">.</span><span class="n">columns_escaped</span>

            <span class="n">input_column</span><span class="p">,</span> <span class="n">src_ds_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span><span class="o">.</span><span class="n">_source_dataset_col</span>
            <span class="k">return</span> <span class="s2">&quot;__splink_source_dataset&quot;</span> <span class="k">if</span> <span class="n">src_ds_col</span> <span class="ow">in</span> <span class="n">columns</span> <span class="k">else</span> <span class="n">input_column</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_two_dataset_link_only</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Two dataset link only join is a special case where an inner join of the</span>
        <span class="c1"># two datasets is much more efficient than self-joining the vertically</span>
        <span class="c1"># concatenation of all input datasets</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_new_matches_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compare_two_records_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># in u-train sample mode we are joining the concatenated table mixing</span>
        <span class="c1"># both data sets - hence if we inner join on True we will end up with</span>
        <span class="c1"># samples which both originate from the same dataset</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_train_u_using_random_sample_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_analyse_blocking_mode</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_tables_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span> <span class="o">==</span> <span class="s2">&quot;link_only&quot;</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_sql_dialect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect_</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No SQL dialect set on object of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Did you make sure to create a dialect-specific Linker?&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect_</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_infinity_expression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;infinity sql expression not available for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_verify_link_only_job</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span>
        <span class="k">if</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span> <span class="o">==</span> <span class="s2">&quot;link_only&quot;</span><span class="p">:</span>
            <span class="c1"># if input datasets &gt; 1 then skip</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_tables_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># else, check if source dataset column is populated...</span>
            <span class="n">src_ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_dataset_column_name</span>
            <span class="k">if</span> <span class="n">src_ds</span> <span class="o">==</span> <span class="s2">&quot;__splink_source_dataset&quot;</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">src_ds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span><span class="o">.</span><span class="n">_source_dataset_col</span>

            <span class="n">sql</span> <span class="o">=</span> <span class="n">find_unique_source_dataset</span><span class="p">(</span><span class="n">src_ds</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;source_ds_distinct&quot;</span><span class="p">)</span>
            <span class="n">src_ds_distinct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">(</span>
                <span class="p">[</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat_with_tf&quot;</span><span class="p">]]</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_ds_distinct</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">())</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SplinkException</span><span class="p">(</span>
                    <span class="s2">&quot;if `link_type` is `link_only`, it should have at least two &quot;</span>
                    <span class="s2">&quot;input dataframes, or one dataframe with a `source_dataset` &quot;</span>
                    <span class="s2">&quot;column outlining which dataset each record belongs to.&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_register_input_tables</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_tables</span><span class="p">,</span> <span class="n">input_aliases</span><span class="p">,</span> <span class="n">accepted_df_dtypes</span><span class="p">):</span>
        <span class="c1"># &#39;homogenised&#39; means all entries are strings representing tables</span>
        <span class="n">homogenised_tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">homogenised_aliases</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">accepted_df_dtypes</span> <span class="o">=</span> <span class="n">ensure_is_tuple</span><span class="p">(</span><span class="n">accepted_df_dtypes</span><span class="p">)</span>

        <span class="n">existing_tables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">alias</span> <span class="ow">in</span> <span class="n">input_aliases</span><span class="p">:</span>
            <span class="c1"># Check if alias is a string (indicating a table name) and that it is not</span>
            <span class="c1"># a file path.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;.*&quot;</span><span class="p">,</span> <span class="n">string</span><span class="o">=</span><span class="n">alias</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">exists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_exists_in_database</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">exists</span><span class="p">:</span>
                <span class="n">existing_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">alias</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">existing_tables</span><span class="p">:</span>
            <span class="n">input_tables</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">existing_tables</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Table(s): </span><span class="si">{</span><span class="n">input_tables</span><span class="si">}</span><span class="s2"> already exists in database. &quot;</span>
                <span class="s2">&quot;Please remove or rename it/them before retrying&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">input_tables</span><span class="p">,</span> <span class="n">input_aliases</span><span class="p">)):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">alias</span><span class="p">,</span> <span class="n">accepted_df_dtypes</span><span class="p">):</span>
                <span class="n">alias</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;__splink__input_table_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">accepted_df_dtypes</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_table_registration</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">alias</span><span class="p">)</span>
                <span class="n">table</span> <span class="o">=</span> <span class="n">alias</span>

            <span class="n">homogenised_tables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
            <span class="n">homogenised_aliases</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alias</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">homogenised_tables</span><span class="p">,</span> <span class="n">homogenised_aliases</span>

    <span class="k">def</span> <span class="nf">_setup_settings_objs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings_dict</span><span class="p">):</span>
        <span class="c1"># Setup the linker class&#39;s required settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_dict</span> <span class="o">=</span> <span class="n">settings_dict</span>

        <span class="c1"># if settings_dict is passed, set sql_dialect on it if missing, and make sure</span>
        <span class="c1"># incompatible dialect not passed</span>
        <span class="k">if</span> <span class="n">settings_dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">settings_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sql_dialect&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;sql_dialect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect</span>

        <span class="k">if</span> <span class="n">settings_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid_no_settings</span> <span class="o">=</span> <span class="n">ascii_uid</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linker_uid&quot;</span><span class="p">,</span> <span class="n">ascii_uid</span><span class="p">(</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;linker_uid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uid</span>

        <span class="k">if</span> <span class="n">settings_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_initialise_df_concat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materialise</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span>
        <span class="n">concat_df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;__splink__df_concat&quot;</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">concat_df</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">concat_df</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat_with_tf&quot;</span><span class="p">]</span>
            <span class="n">concat_df</span><span class="o">.</span><span class="n">templated_name</span> <span class="o">=</span> <span class="s2">&quot;__splink__df_concat&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">materialise</span><span class="p">:</span>
                <span class="c1"># Clear the pipeline if we are materialising</span>
                <span class="c1"># There&#39;s no reason not to do this, since when</span>
                <span class="c1"># we execute the pipeline, it&#39;ll get cleared anyway</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">vertically_concatenate_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_concat&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">materialise</span><span class="p">:</span>
                <span class="n">concat_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">()</span>
                <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">concat_df</span>

        <span class="k">return</span> <span class="n">concat_df</span>

    <span class="k">def</span> <span class="nf">_initialise_df_concat_with_tf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">materialise</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span>
        <span class="n">nodes_with_tf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">nodes_with_tf</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat_with_tf&quot;</span><span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">materialise</span><span class="p">:</span>
                <span class="c1"># Clear the pipeline if we are materialising</span>
                <span class="c1"># There&#39;s no reason not to do this, since when</span>
                <span class="c1"># we execute the pipeline, it&#39;ll get cleared anyway</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

            <span class="n">sql</span> <span class="o">=</span> <span class="n">vertically_concatenate_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_concat&quot;</span><span class="p">)</span>

            <span class="n">sqls</span> <span class="o">=</span> <span class="n">compute_all_term_frequencies_sqls</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">sqls</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="n">sql</span><span class="p">[</span><span class="s2">&quot;output_table_name&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">materialise</span><span class="p">:</span>
                <span class="n">nodes_with_tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">()</span>
                <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat_with_tf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodes_with_tf</span>

        <span class="c1"># verify the link job</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_verify_link_only_job</span>

        <span class="k">return</span> <span class="n">nodes_with_tf</span>

    <span class="k">def</span> <span class="nf">_table_to_splink_dataframe</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">templated_name</span><span class="p">,</span> <span class="n">physical_name</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a SplinkDataframe from a table in the underlying database called</span>
<span class="sd">        `physical_name`.</span>

<span class="sd">        Associate a `templated_name` with this table, which signifies the purpose</span>
<span class="sd">        or &#39;meaning&#39; of this table to splink. (e.g. `__splink__df_blocked`)</span>

<span class="sd">        Args:</span>
<span class="sd">            templated_name (str): The purpose of the table to Splink</span>
<span class="sd">            physical_name (str): The name of the table in the underlying databse</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;_table_to_splink_dataframe not implemented on this linker&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_enqueue_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">output_table_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add sql to the current pipeline, but do not execute the pipeline.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">output_table_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_execute_sql_pipeline</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_dataframes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SplinkDataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="n">materialise_as_hash</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the SQL queued in the current pipeline as a single statement</span>
<span class="sd">        e.g. `with a as (), b as , c as (), select ... from c`, then execute the</span>
<span class="sd">        pipeline, returning the resultant table as a SplinkDataFrame</span>

<span class="sd">        Args:</span>
<span class="sd">            input_dataframes (List[SplinkDataFrame], optional): A &#39;starting point&#39; of</span>
<span class="sd">                SplinkDataFrames if needed. Defaults to [].</span>
<span class="sd">            materialise_as_hash (bool, optional): If true, the output tablename will end</span>
<span class="sd">                in a unique identifer. Defaults to True.</span>
<span class="sd">            use_cache (bool, optional): If true, look at whether the SQL pipeline has</span>
<span class="sd">                been executed before, and if so, use the existing result. Defaults to</span>
<span class="sd">                True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: An abstraction representing the table created by the sql</span>
<span class="sd">                pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
            <span class="n">sql_gen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">_generate_pipeline</span><span class="p">(</span><span class="n">input_dataframes</span><span class="p">)</span>

            <span class="n">output_tablename_templated</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">queue</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">output_table_name</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_to_splink_dataframe_checking_cache</span><span class="p">(</span>
                    <span class="n">sql_gen</span><span class="p">,</span>
                    <span class="n">output_tablename_templated</span><span class="p">,</span>
                    <span class="n">materialise_as_hash</span><span class="p">,</span>
                    <span class="n">use_cache</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

            <span class="k">return</span> <span class="n">dataframe</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># In debug mode, we do not pipeline the sql and print the</span>
            <span class="c1"># results of each part of the pipeline</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">_generate_pipeline_parts</span><span class="p">(</span><span class="n">input_dataframes</span><span class="p">):</span>
                <span class="n">output_tablename</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">output_table_name</span>
                <span class="n">sql</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">sql</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;--------Creating table: </span><span class="si">{</span><span class="n">output_tablename</span><span class="si">}</span><span class="s2">--------&quot;</span><span class="p">)</span>

                <span class="n">dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_to_splink_dataframe_checking_cache</span><span class="p">(</span>
                    <span class="n">sql</span><span class="p">,</span>
                    <span class="n">output_tablename</span><span class="p">,</span>
                    <span class="n">materialise_as_hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">dataframe</span>

    <span class="k">def</span> <span class="nf">_execute_sql_against_backend</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">templated_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">physical_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute a single sql SELECT statement, returning a SplinkDataFrame.</span>

<span class="sd">        Subclasses should implement this, using _log_and_run_sql_execution() within</span>
<span class="sd">        their implementation, maybe doing some SQL translation or other prep/cleanup</span>
<span class="sd">        work before/after.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;_execute_sql_against_backend not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_run_sql_execution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">final_sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">templated_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">physical_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;**Actually** execute the sql against the backend database.</span>

<span class="sd">        This is intended to be implemented by a subclass, but not actually called</span>
<span class="sd">        directly. Instead, call _log_and_run_sql_execution, and that will call</span>
<span class="sd">        this method.</span>

<span class="sd">        This could return something, or not. It&#39;s up to the Linker subclass to decide.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;_run_sql_execution not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_log_and_run_sql_execution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">final_sql</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">templated_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">physical_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Log the sql, then call _run_sql_execution(), wrapping any errors&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">execute_sql_logging_message_info</span><span class="p">(</span><span class="n">templated_name</span><span class="p">,</span> <span class="n">physical_name</span><span class="p">))</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">log_sql</span><span class="p">(</span><span class="n">final_sql</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_sql_execution</span><span class="p">(</span><span class="n">final_sql</span><span class="p">,</span> <span class="n">templated_name</span><span class="p">,</span> <span class="n">physical_name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Parse our SQL through sqlglot to pretty print</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">final_sql</span> <span class="o">=</span> <span class="n">sqlglot</span><span class="o">.</span><span class="n">parse_one</span><span class="p">(</span>
                    <span class="n">final_sql</span><span class="p">,</span>
                    <span class="n">read</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect</span><span class="p">,</span>
                <span class="p">)</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="c1"># if sqlglot produces any errors, just report the raw SQL</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">raise</span> <span class="n">SplinkException</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Error executing the following sql for table &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;`</span><span class="si">{</span><span class="n">templated_name</span><span class="si">}</span><span class="s2">` (</span><span class="si">{</span><span class="n">physical_name</span><span class="si">}</span><span class="s2">):</span><span class="se">\n</span><span class="si">{</span><span class="n">final_sql</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>

    <span class="k">def</span> <span class="nf">register_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a table to your backend database, to be used in one of the</span>
<span class="sd">        splink methods, or simply to allow querying.</span>

<span class="sd">        Tables can be of type: dictionary, record level dictionary,</span>
<span class="sd">        pandas dataframe, pyarrow table and in the spark case, a spark df.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            test_dict = {&quot;a&quot;: [666,777,888],&quot;b&quot;: [4,5,6]}</span>
<span class="sd">            linker.register_table(test_dict, &quot;test_dict&quot;)</span>
<span class="sd">            linker.query_sql(&quot;select * from test_dict&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        Args:</span>
<span class="sd">            input: The data you wish to register. This can be either a dictionary,</span>
<span class="sd">                pandas dataframe, pyarrow table or a spark dataframe.</span>
<span class="sd">            table_name (str): The name you wish to assign to the table.</span>
<span class="sd">            overwrite (bool): Overwrite the table in the underlying database if it</span>
<span class="sd">                exists</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: An abstraction representing the table created by the sql</span>
<span class="sd">                pipeline</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;register_table not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_table_registration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register a table to your backend database, to be used in one of the</span>
<span class="sd">        splink methods, or simply to allow querying.</span>

<span class="sd">        Tables can be of type: dictionary, record level dictionary,</span>
<span class="sd">        pandas dataframe, pyarrow table and in the spark case, a spark df.</span>

<span class="sd">        This function is contains no overwrite functionality, so it can be used</span>
<span class="sd">        where we don&#39;t want to allow for overwriting.</span>

<span class="sd">        Args:</span>
<span class="sd">            input: The data you wish to register. This can be either a dictionary,</span>
<span class="sd">                pandas dataframe, pyarrow table or a spark dataframe.</span>
<span class="sd">            table_name (str): The name you wish to assign to the table.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;_table_registration not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">query_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s2">&quot;pandas&quot;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run a SQL query against your backend database and return</span>
<span class="sd">        the resulting output.</span>

<span class="sd">        Examples:</span>
<span class="sd">            === &quot;DuckDB&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = DuckDBLinker(df, settings)</span>
<span class="sd">                df_predict = linker.predict()</span>
<span class="sd">                linker.query_sql(f&quot;select * from {df_predict.physical_name} limit 10&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Spark&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = SparkLinker(df, settings)</span>
<span class="sd">                df_predict = linker.predict()</span>
<span class="sd">                linker.query_sql(f&quot;select * from {df_predict.physical_name} limit 10&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Athena&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = AthenaLinker(df, settings)</span>
<span class="sd">                df_predict = linker.predict()</span>
<span class="sd">                linker.query_sql(f&quot;select * from {df_predict.physical_name} limit 10&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;SQLite&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = SQLiteLinker(df, settings)</span>
<span class="sd">                df_predict = linker.predict()</span>
<span class="sd">                linker.query_sql(f&quot;select * from {df_predict.physical_name} limit 10&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        Args:</span>
<span class="sd">            sql (str): The SQL to be queried.</span>
<span class="sd">            output_type (str): One of splink_df/splinkdf or pandas.</span>
<span class="sd">                This determines the type of table that your results are output in.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">output_tablename_templated</span> <span class="o">=</span> <span class="s2">&quot;__splink__df_sql_query&quot;</span>

        <span class="n">splink_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_to_splink_dataframe_checking_cache</span><span class="p">(</span>
            <span class="n">sql</span><span class="p">,</span>
            <span class="n">output_tablename_templated</span><span class="p">,</span>
            <span class="n">materialise_as_hash</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">output_type</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;splink_df&quot;</span><span class="p">,</span> <span class="s2">&quot;splinkdf&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">splink_dataframe</span>
        <span class="k">elif</span> <span class="n">output_type</span> <span class="o">==</span> <span class="s2">&quot;pandas&quot;</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">splink_dataframe</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">()</span>
            <span class="c1"># If pandas, drop the table to cleanup the db</span>
            <span class="n">splink_dataframe</span><span class="o">.</span><span class="n">drop_table_from_database</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">out</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;output_type &#39;</span><span class="si">{</span><span class="n">output_type</span><span class="si">}</span><span class="s2">&#39; is not supported.&quot;</span><span class="p">,</span>
                <span class="s2">&quot;Must be one of &#39;splink_df&#39;/&#39;splinkdf&#39; or &#39;pandas&#39;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sql_to_splink_dataframe_checking_cache</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">sql</span><span class="p">,</span>
        <span class="n">output_tablename_templated</span><span class="p">,</span>
        <span class="n">materialise_as_hash</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute sql, or if identical sql has been run before, return cached results.</span>

<span class="sd">        This function</span>
<span class="sd">            - is used by _execute_sql_pipeline to to execute SQL</span>
<span class="sd">            - or can be used directly if you have a single SQL statement that&#39;s</span>
<span class="sd">              not in a pipeline</span>

<span class="sd">        Return a SplinkDataFrame representing the results of the SQL</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">to_hash</span> <span class="o">=</span> <span class="p">(</span><span class="n">sql</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="nb">hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">to_hash</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()[:</span><span class="mi">9</span><span class="p">]</span>
        <span class="c1"># Ensure hash is valid sql table name</span>
        <span class="n">table_name_hash</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_tablename_templated</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">hash</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">use_cache</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_exists_in_database</span><span class="p">(</span><span class="n">output_tablename_templated</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using existing table </span><span class="si">{</span><span class="n">output_tablename_templated</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_to_splink_dataframe</span><span class="p">(</span>
                    <span class="n">output_tablename_templated</span><span class="p">,</span> <span class="n">output_tablename_templated</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_exists_in_database</span><span class="p">(</span><span class="n">table_name_hash</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Using cache for </span><span class="si">{</span><span class="n">output_tablename_templated</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; with physical name </span><span class="si">{</span><span class="n">table_name_hash</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_to_splink_dataframe</span><span class="p">(</span>
                    <span class="n">output_tablename_templated</span><span class="p">,</span> <span class="n">table_name_hash</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">sql</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">materialise_as_hash</span><span class="p">:</span>
            <span class="n">splink_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_against_backend</span><span class="p">(</span>
                <span class="n">sql</span><span class="p">,</span> <span class="n">output_tablename_templated</span><span class="p">,</span> <span class="n">table_name_hash</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">splink_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_against_backend</span><span class="p">(</span>
                <span class="n">sql</span><span class="p">,</span>
                <span class="n">output_tablename_templated</span><span class="p">,</span>
                <span class="n">output_tablename_templated</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_names_of_tables_created_by_splink</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">splink_dataframe</span><span class="o">.</span><span class="n">physical_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug_mode</span><span class="p">:</span>
            <span class="n">df_pd</span> <span class="o">=</span> <span class="n">splink_dataframe</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

                <span class="n">display</span><span class="p">(</span><span class="n">df_pd</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">df_pd</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">splink_dataframe</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;When we do EM training, we need a copy of the linker which is independent</span>
<span class="sd">        of the main linker e.g. setting parameters on the copy will not affect the</span>
<span class="sd">        main linker.  This method implements ensures linker can be deepcopied.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">new_linker</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">new_linker</span><span class="o">.</span><span class="n">_em_training_sessions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_settings</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span><span class="p">)</span>
        <span class="n">new_linker</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="o">=</span> <span class="n">new_settings</span>
        <span class="k">return</span> <span class="n">new_linker</span>

    <span class="k">def</span> <span class="nf">_ensure_aliases_populated_and_is_list</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">input_table_or_tables</span><span class="p">,</span> <span class="n">input_table_aliases</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">input_table_aliases</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">input_table_aliases</span> <span class="o">=</span> <span class="n">input_table_or_tables</span>

        <span class="n">input_table_aliases</span> <span class="o">=</span> <span class="n">ensure_is_list</span><span class="p">(</span><span class="n">input_table_aliases</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">input_table_aliases</span>

    <span class="k">def</span> <span class="nf">_get_input_tables_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_table_or_tables</span><span class="p">,</span> <span class="n">input_table_aliases</span><span class="p">):</span>
        <span class="n">input_table_or_tables</span> <span class="o">=</span> <span class="n">ensure_is_list</span><span class="p">(</span><span class="n">input_table_or_tables</span><span class="p">)</span>

        <span class="n">input_table_aliases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_aliases_populated_and_is_list</span><span class="p">(</span>
            <span class="n">input_table_or_tables</span><span class="p">,</span> <span class="n">input_table_aliases</span>
        <span class="p">)</span>

        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">table_alias</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">input_table_or_tables</span><span class="p">,</span> <span class="n">input_table_aliases</span><span class="p">):</span>
            <span class="n">d</span><span class="p">[</span><span class="n">table_alias</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_to_splink_dataframe</span><span class="p">(</span><span class="n">table_alias</span><span class="p">,</span> <span class="n">table_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">_get_input_tf_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_dict</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">df_name</span><span class="p">,</span> <span class="n">df_value</span> <span class="ow">in</span> <span class="n">df_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">renamed</span> <span class="o">=</span> <span class="n">colname_to_tf_tablename</span><span class="p">(</span><span class="n">df_name</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">renamed</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_table_to_splink_dataframe</span><span class="p">(</span><span class="n">renamed</span><span class="p">,</span> <span class="n">df_value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="k">def</span> <span class="nf">_predict_warning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_is_fully_trained</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> -- WARNING --</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;You have called predict(), but there are some parameter &quot;</span>
                <span class="s2">&quot;estimates which have neither been estimated or specified in your &quot;</span>
                <span class="s2">&quot;settings dictionary.  To produce predictions the following&quot;</span>
                <span class="s2">&quot; untrained trained parameters will use default values.&quot;</span>
            <span class="p">)</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_not_trained_messages</span><span class="p">()</span>

            <span class="n">warn_message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">msg</span><span class="p">]</span> <span class="o">+</span> <span class="n">messages</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">warn_message</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_table_exists_in_database</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;table_exists_in_database not implemented for </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_input_dfs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_input_tables_dict&quot;</span><span class="p">):</span>
            <span class="c1"># This is only triggered where a user loads a settings dict from a</span>
            <span class="c1"># given file path.</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_input_tables_dict</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">df</span><span class="o">.</span><span class="n">validate</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span> <span class="o">==</span> <span class="s2">&quot;dedupe_only&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_input_tables_dict</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;If link_type = &quot;dedupe only&quot; then input tables must contain &#39;</span>
                        <span class="s2">&quot;only a single input table&quot;</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_dialect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">settings_dialect</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_sql_dialect</span>
        <span class="k">if</span> <span class="n">settings_dialect</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Incompatible SQL dialect! `settings` dictionary uses &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;dialect </span><span class="si">{</span><span class="n">settings_dialect</span><span class="si">}</span><span class="s2">, but expecting &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect</span><span class="si">}</span><span class="s2">&#39; for Linker of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_populate_probability_two_random_records_match_from_trained_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">recip_prop_matches_estimates</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="mi">15</span><span class="p">,</span>
            <span class="p">(</span>
                <span class="s2">&quot;---- Using training sessions to compute &quot;</span>
                <span class="s2">&quot;probability two random records match ----&quot;</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">em_training_session</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_em_training_sessions</span><span class="p">:</span>
            <span class="n">training_lambda</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">em_training_session</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_probability_two_random_records_match</span>
            <span class="p">)</span>
            <span class="n">training_lambda_bf</span> <span class="o">=</span> <span class="n">prob_to_bayes_factor</span><span class="p">(</span><span class="n">training_lambda</span><span class="p">)</span>
            <span class="n">reverse_levels</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">em_training_session</span><span class="o">.</span><span class="n">_comparison_levels_to_reverse_blocking_rule</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="mi">15</span><span class="p">,</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Probability two random records match from trained model blocking on &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">em_training_session</span><span class="o">.</span><span class="n">_blocking_rule_for_training</span><span class="o">.</span><span class="n">blocking_rule</span><span class="si">}</span><span class="s2">: &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">training_lambda</span><span class="si">:</span><span class="s2">,.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">reverse_level</span> <span class="ow">in</span> <span class="n">reverse_levels</span><span class="p">:</span>
                <span class="c1"># Get comparison level on current settings obj</span>
                <span class="n">cc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_get_comparison_by_output_column_name</span><span class="p">(</span>
                    <span class="n">reverse_level</span><span class="o">.</span><span class="n">comparison</span><span class="o">.</span><span class="n">_output_column_name</span>
                <span class="p">)</span>

                <span class="n">cl</span> <span class="o">=</span> <span class="n">cc</span><span class="o">.</span><span class="n">_get_comparison_level_by_comparison_vector_value</span><span class="p">(</span>
                    <span class="n">reverse_level</span><span class="o">.</span><span class="n">_comparison_vector_value</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">cl</span><span class="o">.</span><span class="n">_has_estimated_values</span><span class="p">:</span>
                    <span class="n">bf</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">_trained_m_median</span> <span class="o">/</span> <span class="n">cl</span><span class="o">.</span><span class="n">_trained_u_median</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bf</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">_bayes_factor</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="mi">15</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Reversing comparison level </span><span class="si">{</span><span class="n">cc</span><span class="o">.</span><span class="n">_output_column_name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot; using bayes factor </span><span class="si">{</span><span class="n">bf</span><span class="si">:</span><span class="s2">,.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">training_lambda_bf</span> <span class="o">=</span> <span class="n">training_lambda_bf</span> <span class="o">/</span> <span class="n">bf</span>

                <span class="n">as_prob</span> <span class="o">=</span> <span class="n">bayes_factor_to_prob</span><span class="p">(</span><span class="n">training_lambda_bf</span><span class="p">)</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                    <span class="mi">15</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="s2">&quot;This estimate of probability two random records match now: &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">as_prob</span><span class="si">:</span><span class="s2">,.3f</span><span class="si">}</span><span class="s2"> &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;with reciprocal </span><span class="si">{</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">as_prob</span><span class="p">)</span><span class="si">:</span><span class="s2">,.3f</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">---------&quot;</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">bayes_factor_to_prob</span><span class="p">(</span><span class="n">training_lambda_bf</span><span class="p">)</span>
            <span class="n">recip_prop_matches_estimates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">p</span><span class="p">)</span>

        <span class="n">prop_matches_estimate</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">median</span><span class="p">(</span><span class="n">recip_prop_matches_estimates</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_probability_two_random_records_match</span> <span class="o">=</span> <span class="n">prop_matches_estimate</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="mi">15</span><span class="p">,</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Median of prop of matches estimates: &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_probability_two_random_records_match</span><span class="si">:</span><span class="s2">,.3f</span><span class="si">}</span><span class="s2"> &quot;</span>
            <span class="s2">&quot;reciprocal &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_probability_two_random_records_match</span><span class="si">:</span><span class="s2">,.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_populate_m_u_from_trained_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ccs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">comparisons</span>

        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">ccs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">cc</span><span class="o">.</span><span class="n">_comparison_levels_excluding_null</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cl</span><span class="o">.</span><span class="n">_has_estimated_u_values</span><span class="p">:</span>
                    <span class="n">cl</span><span class="o">.</span><span class="n">u_probability</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">_trained_u_median</span>
                <span class="k">if</span> <span class="n">cl</span><span class="o">.</span><span class="n">_has_estimated_m_values</span><span class="p">:</span>
                    <span class="n">cl</span><span class="o">.</span><span class="n">m_probability</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">_trained_m_median</span>

    <span class="k">def</span> <span class="nf">_delete_tables_created_by_splink_from_db</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">retain_term_frequency</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">retain_df_concat_with_tf</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="n">to_remove</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_names_of_tables_created_by_splink</span><span class="p">:</span>
            <span class="c1"># Only delete tables explicitly marked as having been created by splink</span>
            <span class="k">if</span> <span class="s2">&quot;__splink__&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">retain_df_concat_with_tf</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_delete_table_from_database</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__splink__df_tf_&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">retain_term_frequency</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_delete_table_from_database</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_delete_table_from_database</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">to_remove</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_names_of_tables_created_by_splink</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_names_of_tables_created_by_splink</span> <span class="o">-</span> <span class="n">to_remove</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_raise_error_if_necessary_waterfall_columns_not_computed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ricc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_retain_intermediate_calculation_columns</span>
        <span class="n">rmc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_retain_matching_columns</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ricc</span> <span class="ow">and</span> <span class="n">rmc</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;retain_intermediate_calculation_columns and &quot;</span>
                <span class="s2">&quot;retain_matching_columns must both be set to True in your settings&quot;</span>
                <span class="s2">&quot; dictionary to use this function, because otherwise the necessary &quot;</span>
                <span class="s2">&quot;columns will not be available in the input records.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Their current values are </span><span class="si">{</span><span class="n">ricc</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">rmc</span><span class="si">}</span><span class="s2">, respectively. &quot;</span>
                <span class="s2">&quot;Please re-run your linkage with them both set to True.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_raise_error_if_necessary_accuracy_columns_not_computed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">rmc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_retain_matching_columns</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">rmc</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;retain_matching_columns must be set to True in your settings&quot;</span>
                <span class="s2">&quot; dictionary to use this function, because otherwise the necessary &quot;</span>
                <span class="s2">&quot;columns will not be available in the input records.&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; Its current value is </span><span class="si">{</span><span class="n">rmc</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;Please re-run your linkage with it set to True.&quot;</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings_dict</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialise settings for the linker.  To be used if settings were</span>
<span class="sd">        not passed to the linker on creation. This can either be in the form</span>
<span class="sd">        of a settings dictionary or a filepath to a json file containing a</span>
<span class="sd">        valid settings dictionary.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker = DuckDBLinker(df)</span>
<span class="sd">            linker.profile_columns([&quot;first_name&quot;, &quot;surname&quot;])</span>
<span class="sd">            linker.load_settings(settings_dict)</span>
<span class="sd">            ```</span>

<span class="sd">        Args:</span>
<span class="sd">            settings_dict (dict | str | Path): A Splink settings dictionary or</span>
<span class="sd">                the path to your settings json file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>  <span class="c1"># check if it&#39;s a valid file/filepath</span>
                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
                    <span class="s2">&quot;The filepath you have provided is either not a valid file &quot;</span>
                    <span class="s2">&quot;or doesn&#39;t exist along the path provided.&quot;</span>
                <span class="p">)</span>
            <span class="n">settings_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">read_text</span><span class="p">())</span>

        <span class="c1"># Store the cache ID so it can be reloaded after cache invalidation</span>
        <span class="n">cache_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid</span>
        <span class="c1"># So we don&#39;t run into any issues with generated tables having</span>
        <span class="c1"># invalid columns as settings have been tweaked, invalidate</span>
        <span class="c1"># the cache and allow these tables to be recomputed.</span>

        <span class="c1"># This is less efficient, but triggers infrequently and ensures we don&#39;t</span>
        <span class="c1"># run into issues where the defaults used conflict with the actual values</span>
        <span class="c1"># supplied in settings.</span>

        <span class="c1"># This is particularly relevant with `source_dataset`, which appears within</span>
        <span class="c1"># concat_with_tf.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalidate_cache</span><span class="p">()</span>

        <span class="c1"># If a uid already exists in your settings object, prioritise this</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;linker_uid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linker_uid&quot;</span><span class="p">,</span> <span class="n">cache_id</span><span class="p">)</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;sql_dialect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;sql_dialect&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_dict</span> <span class="o">=</span> <span class="n">settings_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_input_dfs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load a pre-defined model from a json file into the linker.</span>
<span class="sd">        This is intended to be used with the output of</span>
<span class="sd">        `save_model_to_json()`.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.load_model(&quot;my_settings.json&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        Args:</span>
<span class="sd">            model_path (Path): A path to your model settings json file.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="n">model_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialise_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;*This method is now deprecated. Please use `load_settings`</span>
<span class="sd">        when loading existing settings or `load_model` when loading</span>
<span class="sd">         a pre-trained model.*</span>

<span class="sd">        Initialise settings for the linker.  To be used if settings were</span>
<span class="sd">        not passed to the linker on creation.</span>
<span class="sd">        Examples:</span>
<span class="sd">            === &quot;DuckDB&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = DuckDBLinker(df&quot;)</span>
<span class="sd">                linker.profile_columns([&quot;first_name&quot;, &quot;surname&quot;])</span>
<span class="sd">                linker.initialise_settings(settings_dict)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Spark&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = SparkLinker(df&quot;)</span>
<span class="sd">                linker.profile_columns([&quot;first_name&quot;, &quot;surname&quot;])</span>
<span class="sd">                linker.initialise_settings(settings_dict)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Athena&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = AthenaLinker(df&quot;)</span>
<span class="sd">                linker.profile_columns([&quot;first_name&quot;, &quot;surname&quot;])</span>
<span class="sd">                linker.initialise_settings(settings_dict)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;SQLite&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = SQLiteLinker(df&quot;)</span>
<span class="sd">                linker.profile_columns([&quot;first_name&quot;, &quot;surname&quot;])</span>
<span class="sd">                linker.initialise_settings(settings_dict)</span>
<span class="sd">                ```</span>
<span class="sd">        Args:</span>
<span class="sd">            settings_dict (dict): A Splink settings dictionary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If a uid already exists in your settings object, prioritise this</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;linker_uid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;linker_uid&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid</span><span class="p">)</span>
        <span class="n">settings_dict</span><span class="p">[</span><span class="s2">&quot;sql_dialect&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">settings_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;sql_dialect&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_dialect</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_dict</span> <span class="o">=</span> <span class="n">settings_dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj_</span> <span class="o">=</span> <span class="n">Settings</span><span class="p">(</span><span class="n">settings_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_input_dfs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dialect</span><span class="p">()</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;`initialise_settings` is deprecated. We advise you use &quot;</span>
            <span class="s2">&quot;`linker.load_settings()` when loading in your settings or a previously &quot;</span>
            <span class="s2">&quot;trained model.&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">load_settings_from_json</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;*This method is now deprecated. Please use `load_settings`</span>
<span class="sd">        when loading existing settings or `load_model` when loading</span>
<span class="sd">         a pre-trained model.*</span>

<span class="sd">        Load settings from a `.json` file.</span>
<span class="sd">        This `.json` file would usually be the output of</span>
<span class="sd">        `linker.save_model_to_json()`</span>
<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.load_settings_from_json(&quot;my_settings.json&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        Args:</span>
<span class="sd">            in_path (str): Path to settings json file</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="n">in_path</span><span class="p">)</span>

        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;`load_settings_from_json` is deprecated. We advise you use &quot;</span>
            <span class="s2">&quot;`linker.load_settings()` when loading in your settings or a previously &quot;</span>
            <span class="s2">&quot;trained model.&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_tf_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute a term frequency table for a given column and persist to the database</span>

<span class="sd">        This method is useful if you want to pre-compute term frequency tables e.g.</span>
<span class="sd">        so that real time linkage executes faster, or so that you can estimate</span>
<span class="sd">        various models without having to recompute term frequency tables each time</span>

<span class="sd">        Examples:</span>
<span class="sd">            === &quot;DuckDB&quot;</span>
<span class="sd">                Real time linkage</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = DuckDBLinker(df)</span>
<span class="sd">                linker.load_settings(&quot;saved_settings.json&quot;)</span>
<span class="sd">                linker.compute_tf_table(&quot;surname&quot;)</span>
<span class="sd">                linker.compare_two_records(record_left, record_right)</span>
<span class="sd">                ```</span>
<span class="sd">                Pre-computed term frequency tables</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = DuckDBLinker(df)</span>
<span class="sd">                df_first_name_tf = linker.compute_tf_table(&quot;first_name&quot;)</span>
<span class="sd">                df_first_name_tf.write.parquet(&quot;folder/first_name_tf&quot;)</span>
<span class="sd">                &gt;&gt;&gt;</span>
<span class="sd">                # On subsequent data linking job, read this table rather than recompute</span>
<span class="sd">                df_first_name_tf = pd.read_parquet(&quot;folder/first_name_tf&quot;)</span>
<span class="sd">                df_first_name_tf.createOrReplaceTempView(&quot;__splink__df_tf_first_name&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Spark&quot;</span>
<span class="sd">                Real time linkage</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = SparkLinker(df)</span>
<span class="sd">                linker.load_settings(&quot;saved_settings.json&quot;)</span>
<span class="sd">                linker.compute_tf_table(&quot;surname&quot;)</span>
<span class="sd">                linker.compare_two_records(record_left, record_right)</span>
<span class="sd">                ```</span>
<span class="sd">                Pre-computed term frequency tables</span>
<span class="sd">                ```py</span>
<span class="sd">                linker = SparkLinker(df)</span>
<span class="sd">                df_first_name_tf = linker.compute_tf_table(&quot;first_name&quot;)</span>
<span class="sd">                df_first_name_tf.write.parquet(&quot;folder/first_name_tf&quot;)</span>
<span class="sd">                &gt;&gt;&gt;</span>
<span class="sd">                # On subsequent data linking job, read this table rather than recompute</span>
<span class="sd">                df_first_name_tf = spark.read.parquet(&quot;folder/first_name_tf&quot;)</span>
<span class="sd">                df_first_name_tf.createOrReplaceTempView(&quot;__splink__df_tf_first_name&quot;)</span>
<span class="sd">                ```</span>

<span class="sd">        Args:</span>
<span class="sd">            column_name (str): The column name in the input table</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: The resultant table as a splink data frame</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">input_col</span> <span class="o">=</span> <span class="n">InputColumn</span><span class="p">(</span><span class="n">column_name</span><span class="p">,</span> <span class="n">settings_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">)</span>
        <span class="n">tf_tablename</span> <span class="o">=</span> <span class="n">colname_to_tf_tablename</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span>
        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span>
        <span class="n">concat_tf_tables</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">remove_quotes_from_identifiers</span><span class="p">(</span><span class="n">tf_col</span><span class="o">.</span><span class="n">input_name_as_tree</span><span class="p">)</span><span class="o">.</span><span class="n">sql</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">tf_col</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_term_frequency_columns</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">tf_tablename</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">tf_df</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="n">tf_tablename</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span> <span class="ow">in</span> <span class="n">cache</span> <span class="ow">and</span> <span class="n">column_name</span> <span class="ow">in</span> <span class="n">concat_tf_tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="c1"># If our df_concat_with_tf table already exists, use backwards inference to</span>
            <span class="c1"># find a given tf table</span>
            <span class="n">colname</span> <span class="o">=</span> <span class="n">InputColumn</span><span class="p">(</span><span class="n">column_name</span><span class="p">)</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">term_frequencies_from_concat_with_tf</span><span class="p">(</span><span class="n">colname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">colname_to_tf_tablename</span><span class="p">(</span><span class="n">colname</span><span class="p">))</span>
            <span class="n">tf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">(</span>
                <span class="p">[</span><span class="n">cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat_with_tf&quot;</span><span class="p">]],</span> <span class="n">materialise_as_hash</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span><span class="p">[</span><span class="n">tf_tablename</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf_df</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Clear the pipeline if we are materialising</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pipeline</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="n">df_concat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_df_concat</span><span class="p">()</span>
            <span class="n">input_dfs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">df_concat</span><span class="p">:</span>
                <span class="n">input_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_concat</span><span class="p">)</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="n">term_frequencies_for_single_column_sql</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="n">tf_tablename</span><span class="p">)</span>
            <span class="n">tf_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">(</span><span class="n">input_dfs</span><span class="p">,</span> <span class="n">materialise_as_hash</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span><span class="p">[</span><span class="n">tf_tablename</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf_df</span>

        <span class="k">return</span> <span class="n">tf_df</span>

    <span class="k">def</span> <span class="nf">deterministic_link</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Uses the blocking rules specified by</span>
<span class="sd">        `blocking_rules_to_generate_predictions` in the settings dictionary to</span>
<span class="sd">        generate pairwise record comparisons.</span>

<span class="sd">        For deterministic linkage, this should be a list of blocking rules which</span>
<span class="sd">        are strict enough to generate only true links.</span>

<span class="sd">        Deterministic linkage, however, is likely to result in missed links</span>
<span class="sd">        (false negatives).</span>

<span class="sd">        Examples:</span>
<span class="sd">            === &quot;DuckDB&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            from splink.duckdb.duckdb_linker import DuckDBLinker</span>

<span class="sd">            settings = {</span>
<span class="sd">                &quot;link_type&quot;: &quot;dedupe_only&quot;,</span>
<span class="sd">                &quot;blocking_rules_to_generate_predictions&quot;: [</span>
<span class="sd">                    &quot;l.first_name = r.first_name&quot;,</span>
<span class="sd">                    &quot;l.surname = r.surname&quot;,</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;comparisons&quot;: []</span>
<span class="sd">            }</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            linker = DuckDBLinker(df, settings)</span>
<span class="sd">            df = linker.deterministic_link()</span>
<span class="sd">            ```</span>
<span class="sd">            === &quot;Spark&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            from splink.spark.spark_linker import SparkLinker</span>

<span class="sd">            settings = {</span>
<span class="sd">                &quot;link_type&quot;: &quot;dedupe_only&quot;,</span>
<span class="sd">                &quot;blocking_rules_to_generate_predictions&quot;: [</span>
<span class="sd">                    &quot;l.first_name = r.first_name&quot;,</span>
<span class="sd">                    &quot;l.surname = r.surname&quot;,</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;comparisons&quot;: []</span>
<span class="sd">            }</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            linker = SparkLinker(df, settings)</span>
<span class="sd">            df = linker.deterministic_link()</span>
<span class="sd">            ```</span>
<span class="sd">            === &quot;Athena&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            from splink.athena.athena_linker import AthenaLinker</span>

<span class="sd">            settings = {</span>
<span class="sd">                &quot;link_type&quot;: &quot;dedupe_only&quot;,</span>
<span class="sd">                &quot;blocking_rules_to_generate_predictions&quot;: [</span>
<span class="sd">                    &quot;l.first_name = r.first_name&quot;,</span>
<span class="sd">                    &quot;l.surname = r.surname&quot;,</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;comparisons&quot;: []</span>
<span class="sd">            }</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            linker = AthenaLinker(df, settings)</span>
<span class="sd">            df = linker.deterministic_link()</span>
<span class="sd">            ```</span>
<span class="sd">            === &quot;SQLite&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            from splink.sqlite.sqlite_linker import SQLiteLinker</span>

<span class="sd">            settings = {</span>
<span class="sd">                &quot;link_type&quot;: &quot;dedupe_only&quot;,</span>
<span class="sd">                &quot;blocking_rules_to_generate_predictions&quot;: [</span>
<span class="sd">                    &quot;l.first_name = r.first_name&quot;,</span>
<span class="sd">                    &quot;l.surname = r.surname&quot;,</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;comparisons&quot;: []</span>
<span class="sd">            }</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            linker = SQLiteLinker(df, settings)</span>
<span class="sd">            df = linker.deterministic_link()</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: A SplinkDataFrame of the pairwise comparisons.  This</span>
<span class="sd">                represents a table materialised in the database. Methods on the</span>
<span class="sd">                SplinkDataFrame allow you to access the underlying data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Allows clustering during a deterministic linkage.</span>
        <span class="c1"># This is used in `cluster_pairwise_predictions_at_threshold`</span>
        <span class="c1"># to set the cluster threshold to 1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_deterministic_link_mode</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">concat_with_tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_df_concat_with_tf</span><span class="p">()</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">block_using_rules_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_blocked&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">([</span><span class="n">concat_with_tf</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">estimate_u_using_random_sampling</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">max_pairs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">target_rows</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate the u parameters of the linkage model using random sampling.</span>

<span class="sd">        The u parameters represent the proportion of record comparisons that fall</span>
<span class="sd">        into each comparison level amongst truly non-matching records.</span>

<span class="sd">        This procedure takes a sample of the data and generates the cartesian</span>
<span class="sd">        product of pairwise record comparisons amongst the sampled records.</span>
<span class="sd">        The validity of the u values rests on the assumption that the resultant</span>
<span class="sd">        pairwise comparisons are non-matches (or at least, they are very unlikely to be</span>
<span class="sd">        matches). For large datasets, this is typically true.</span>

<span class="sd">        The results of estimate_u_using_random_sampling, and therefore an entire splink</span>
<span class="sd">        model, can be made reproducible by setting the seed parameter. Setting the seed</span>
<span class="sd">        will have performance implications as additional processing is required.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_pairs (int): The maximum number of pairwise record comparisons to</span>
<span class="sd">            sample. Larger will give more accurate estimates</span>
<span class="sd">            but lead to longer runtimes.  In our experience at least 1e9 (one billion)</span>
<span class="sd">            gives best results but can take a long time to compute. 1e7 (ten million)</span>
<span class="sd">            is often adequate whilst testing different model specifications, before</span>
<span class="sd">            the final model is estimated.</span>
<span class="sd">            seed (int): Seed for random sampling. Assign to get reproducible u</span>
<span class="sd">            probabilities. Note, seed for random sampling is only supported for</span>
<span class="sd">            DuckDB and Spark, for Athena and SQLite set to None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.estimate_u_using_random_sampling(1e8)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: Updates the estimated u parameters within the linker object</span>
<span class="sd">            and returns nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Remove this compatibility code in a future release once we drop</span>
        <span class="c1"># support for &quot;target_rows&quot;. Deprecation warning added in 3.7.0</span>
        <span class="k">if</span> <span class="n">max_pairs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">target_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># user supplied both</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Just use max_pairs&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">max_pairs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># user is doing it correctly</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">target_rows</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># user is using deprecated argument</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;target_rows is deprecated; use max_pairs&quot;</span><span class="p">,</span>
                <span class="ne">DeprecationWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">max_pairs</span> <span class="o">=</span> <span class="n">target_rows</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Missing argument max_pairs&quot;</span><span class="p">)</span>

        <span class="n">estimate_u_values</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_pairs</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_m_u_from_trained_values</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_columns_without_estimated_parameters_message</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">estimate_m_from_label_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label_colname</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate the m parameters of the linkage model from a label (ground truth)</span>
<span class="sd">        column in the input dataframe(s).</span>

<span class="sd">        The m parameters represent the proportion of record comparisons that fall</span>
<span class="sd">        into each comparison level amongst truly matching records.</span>

<span class="sd">        The ground truth column is used to generate pairwise record comparisons</span>
<span class="sd">        which are then assumed to be matches.</span>

<span class="sd">        For example, if the entity being matched is persons, and your input dataset(s)</span>
<span class="sd">        contain social security number, this could be used to estimate the m values</span>
<span class="sd">        for the model.</span>

<span class="sd">        Note that this column does not need to be fully populated.  A common case is</span>
<span class="sd">        where a unique identifier such as social security number is only partially</span>
<span class="sd">        populated.</span>

<span class="sd">        Args:</span>
<span class="sd">            label_colname (str): The name of the column containing the ground truth</span>
<span class="sd">                label in the input data.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.estimate_m_from_label_column(&quot;social_security_number&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            Updates the estimated m parameters within the linker object</span>
<span class="sd">            and returns nothing.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Ensure this has been run on the main linker so that it can be used by</span>
        <span class="c1"># training linked when it checks the cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_df_concat_with_tf</span><span class="p">()</span>
        <span class="n">estimate_m_values_from_label_column</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_input_tables_dict</span><span class="p">,</span>
            <span class="n">label_colname</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_m_u_from_trained_values</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_columns_without_estimated_parameters_message</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">blocking_rule</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">comparisons_to_deactivate</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Comparison</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">comparison_levels_to_reverse_blocking_rule</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ComparisonLevel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">fix_probability_two_random_records_match</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">fix_m_probabilities</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">fix_u_probabilities</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">populate_probability_two_random_records_match_from_trained_values</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EMTrainingSession</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate the parameters of the linkage model using expectation maximisation.</span>

<span class="sd">        By default, the m probabilities are estimated, but not the u probabilities,</span>
<span class="sd">        because good estimates for the u probabilities can be obtained from</span>
<span class="sd">        `linker.estimate_u_using_random_sampling()`.  You can change this by setting</span>
<span class="sd">        `fix_u_probabilities` to False.</span>

<span class="sd">        The blocking rule provided is used to generate pairwise record comparisons.</span>
<span class="sd">        Usually, this should be a blocking rule that results in a dataframe where</span>
<span class="sd">        matches are between about 1% and 99% of the comparisons.</span>

<span class="sd">        By default, m parameters are estimated for all comparisons except those which</span>
<span class="sd">        are included in the blocking rule.</span>

<span class="sd">        For example, if the blocking rule is `l.first_name = r.first_name`, then</span>
<span class="sd">        parameter esimates will be made for all comparison except those which use</span>
<span class="sd">        `first_name` in their sql_condition</span>

<span class="sd">        By default, the probability two random records match is estimated for the</span>
<span class="sd">        blocked data, and then the m and u parameters for the columns specified in the</span>
<span class="sd">        blocking rules are used to estiamte the global probability two random records</span>
<span class="sd">        match.</span>

<span class="sd">        To control which comparisons should have their parameter estimated, and the</span>
<span class="sd">        process of &#39;reversing out&#39; the global probability two random records match, the</span>
<span class="sd">        user may specify `comparisons_to_deactivate` and</span>
<span class="sd">        `comparison_levels_to_reverse_blocking_rule`.   This is useful, for example</span>
<span class="sd">        if you block on the dmetaphone of a column but match on the original column.</span>

<span class="sd">        Examples:</span>
<span class="sd">            Default behaviour</span>
<span class="sd">            ```py</span>
<span class="sd">            br_training = &quot;l.first_name = r.first_name and l.dob = r.dob&quot;</span>
<span class="sd">            linker.estimate_parameters_using_expectation_maximisation(br_training)</span>
<span class="sd">            ```</span>
<span class="sd">            Specify which comparisons to deactivate</span>
<span class="sd">            ```py</span>
<span class="sd">            br_training = &quot;l.dmeta_first_name = r.dmeta_first_name&quot;</span>
<span class="sd">            settings_obj = linker._settings_obj</span>
<span class="sd">            comp = settings_obj._get_comparison_by_output_column_name(&quot;first_name&quot;)</span>
<span class="sd">            dmeta_level = comp._get_comparison_level_by_comparison_vector_value(1)</span>
<span class="sd">            linker.estimate_parameters_using_expectation_maximisation(</span>
<span class="sd">                br_training,</span>
<span class="sd">                comparisons_to_deactivate=[&quot;first_name&quot;],</span>
<span class="sd">                comparison_levels_to_reverse_blocking_rule=[dmeta_level],</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>

<span class="sd">        Args:</span>
<span class="sd">            blocking_rule (str): The blocking rule used to generate pairwise record</span>
<span class="sd">                comparisons.</span>
<span class="sd">            comparisons_to_deactivate (list, optional): By default, splink will</span>
<span class="sd">                analyse the blocking rule provided and estimate the m parameters for</span>
<span class="sd">                all comaprisons except those included in the blocking rule.  If</span>
<span class="sd">                comparisons_to_deactivate are provided, spink will instead</span>
<span class="sd">                estimate m parameters for all comparison except those specified</span>
<span class="sd">                in the comparisons_to_deactivate list.  This list can either contain</span>
<span class="sd">                the output_column_name of the Comparison as a string, or Comparison</span>
<span class="sd">                objects.  Defaults to None.</span>
<span class="sd">            comparison_levels_to_reverse_blocking_rule (list, optional): By default,</span>
<span class="sd">                splink will analyse the blocking rule provided and adjust the</span>
<span class="sd">                global probability two random records match to account for the matches</span>
<span class="sd">                specified in the blocking rule. If provided, this argument will overrule</span>
<span class="sd">                this default behaviour. The user must provide a list of ComparisonLevel</span>
<span class="sd">                objects.  Defaults to None.</span>
<span class="sd">            fix_probability_two_random_records_match (bool, optional): If True, do not</span>
<span class="sd">                update the probability two random records match after each iteration.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            fix_m_probabilities (bool, optional): If True, do not update the m</span>
<span class="sd">                probabilities after each iteration. Defaults to False.</span>
<span class="sd">            fix_u_probabilities (bool, optional): If True, do not update the u</span>
<span class="sd">                probabilities after each iteration. Defaults to True.</span>
<span class="sd">            populate_probability_two_random_records_match_from_trained_values</span>
<span class="sd">                (bool, optional): If True, derive this parameter from</span>
<span class="sd">                the blocked value. Defaults to False.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            blocking_rule = &quot;l.first_name = r.first_name and l.dob = r.dob&quot;</span>
<span class="sd">            linker.estimate_parameters_using_expectation_maximisation(blocking_rule)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            EMTrainingSession:  An object containing information about the training</span>
<span class="sd">                session such as how parameters changed during the iteration history</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure this has been run on the main linker so that it&#39;s in the cache</span>
        <span class="c1"># to be used by the training linkers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_df_concat_with_tf</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">comparisons_to_deactivate</span><span class="p">:</span>
            <span class="c1"># If user provided a string, convert to Comparison object</span>
            <span class="n">comparisons_to_deactivate</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_get_comparison_by_output_column_name</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                <span class="k">else</span> <span class="n">n</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">comparisons_to_deactivate</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">comparison_levels_to_reverse_blocking_rule</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">WARNING: </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;You have provided comparisons_to_deactivate but not &quot;</span>
                    <span class="s2">&quot;comparison_levels_to_reverse_blocking_rule.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;If comparisons_to_deactivate is provided, then &quot;</span>
                    <span class="s2">&quot;you usually need to provide corresponding &quot;</span>
                    <span class="s2">&quot;comparison_levels_to_reverse_blocking_rule &quot;</span>
                    <span class="s2">&quot;because each comparison to deactivate is effectively treated &quot;</span>
                    <span class="s2">&quot;as an exact match.&quot;</span>
                <span class="p">)</span>

        <span class="n">em_training_session</span> <span class="o">=</span> <span class="n">EMTrainingSession</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">blocking_rule</span><span class="p">,</span>
            <span class="n">fix_u_probabilities</span><span class="o">=</span><span class="n">fix_u_probabilities</span><span class="p">,</span>
            <span class="n">fix_m_probabilities</span><span class="o">=</span><span class="n">fix_m_probabilities</span><span class="p">,</span>
            <span class="n">fix_probability_two_random_records_match</span><span class="o">=</span><span class="n">fix_probability_two_random_records_match</span><span class="p">,</span>  <span class="c1"># noqa 501</span>
            <span class="n">comparisons_to_deactivate</span><span class="o">=</span><span class="n">comparisons_to_deactivate</span><span class="p">,</span>
            <span class="n">comparison_levels_to_reverse_blocking_rule</span><span class="o">=</span><span class="n">comparison_levels_to_reverse_blocking_rule</span><span class="p">,</span>  <span class="c1"># noqa 501</span>
        <span class="p">)</span>

        <span class="n">em_training_session</span><span class="o">.</span><span class="n">_train</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_populate_m_u_from_trained_values</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">populate_probability_two_random_records_match_from_trained_values</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_populate_probability_two_random_records_match_from_trained_values</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_columns_without_estimated_parameters_message</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">em_training_session</span>

    <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">threshold_match_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">threshold_match_weight</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">materialise_after_computing_term_frequencies</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a dataframe of scored pairwise comparisons using the parameters</span>
<span class="sd">        of the linkage model.</span>

<span class="sd">        Uses the blocking rules specified in the</span>
<span class="sd">        `blocking_rules_to_generate_predictions` of the settings dictionary to</span>
<span class="sd">        generate the pairwise comparisons.</span>

<span class="sd">        Args:</span>
<span class="sd">            threshold_match_probability (float, optional): If specified,</span>
<span class="sd">                filter the results to include only pairwise comparisons with a</span>
<span class="sd">                match_probability above this threshold. Defaults to None.</span>
<span class="sd">            threshold_match_weight (float, optional): If specified,</span>
<span class="sd">                filter the results to include only pairwise comparisons with a</span>
<span class="sd">                match_weight above this threshold. Defaults to None.</span>
<span class="sd">            materialise_after_computing_term_frequencies (bool): If true, Splink</span>
<span class="sd">                will materialise the table containing the input nodes (rows)</span>
<span class="sd">                joined to any term frequencies which have been asked</span>
<span class="sd">                for in the settings object.  If False, this will be</span>
<span class="sd">                computed as part of one possibly gigantic CTE</span>
<span class="sd">                pipeline.   Defaults to True</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker = DuckDBLinker(df)</span>
<span class="sd">            linker.load_settings(&quot;saved_settings.json&quot;)</span>
<span class="sd">            df = linker.predict(threshold_match_probability=0.95)</span>
<span class="sd">            df.as_pandas_dataframe(limit=5)</span>
<span class="sd">            ```</span>
<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: A SplinkDataFrame of the pairwise comparisons.  This</span>
<span class="sd">                represents a table materialised in the database. Methods on the</span>
<span class="sd">                SplinkDataFrame allow you to access the underlying data.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># If materialise_after_computing_term_frequencies=False and the user only</span>
        <span class="c1"># calls predict, it runs as a single pipeline with no materialisation</span>
        <span class="c1"># of anything.</span>

        <span class="c1"># _initialise_df_concat_with_tf returns None if the table doesn&#39;t exist</span>
        <span class="c1"># and only SQL is queued in this step.</span>
        <span class="n">nodes_with_tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_df_concat_with_tf</span><span class="p">(</span>
            <span class="n">materialise</span><span class="o">=</span><span class="n">materialise_after_computing_term_frequencies</span>
        <span class="p">)</span>

        <span class="n">input_dataframes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">nodes_with_tf</span><span class="p">:</span>
            <span class="n">input_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nodes_with_tf</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">block_using_rules_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_blocked&quot;</span><span class="p">)</span>

        <span class="n">repartition_after_blocking</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;repartition_after_blocking&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># repartition after blocking only exists on the SparkLinker</span>
        <span class="k">if</span> <span class="n">repartition_after_blocking</span><span class="p">:</span>
            <span class="n">df_blocked</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">(</span><span class="n">input_dataframes</span><span class="p">)</span>
            <span class="n">input_dataframes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df_blocked</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">compute_comparison_vector_values_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_comparison_vectors&quot;</span><span class="p">)</span>

        <span class="n">sqls</span> <span class="o">=</span> <span class="n">predict_from_comparison_vectors_sqls</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">,</span>
            <span class="n">threshold_match_probability</span><span class="p">,</span>
            <span class="n">threshold_match_weight</span><span class="p">,</span>
            <span class="n">sql_infinity_expression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_infinity_expression</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">sqls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="n">sql</span><span class="p">[</span><span class="s2">&quot;output_table_name&quot;</span><span class="p">])</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">(</span><span class="n">input_dataframes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_predict_warning</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">predictions</span>

    <span class="k">def</span> <span class="nf">find_matches_to_new_records</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">records_or_tablename</span><span class="p">,</span>
        <span class="n">blocking_rules</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">match_weight_threshold</span><span class="o">=-</span><span class="mi">4</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Given one or more records, find records in the input dataset(s) which match</span>
<span class="sd">        and return in order of the splink prediction score.</span>

<span class="sd">        This effectively provides a way of searching the input datasets</span>
<span class="sd">        for given record(s)</span>

<span class="sd">        Args:</span>
<span class="sd">            records_or_tablename (List[dict]): Input search record(s) as list of dict,</span>
<span class="sd">                or a table registered to the database.</span>
<span class="sd">            blocking_rules (list, optional): Blocking rules to select</span>
<span class="sd">                which records to find and score. If [], do not use a blocking</span>
<span class="sd">                rule - meaning the input records will be compared to all records</span>
<span class="sd">                provided to the linker when it was instantiated. Defaults to [].</span>
<span class="sd">            match_weight_threshold (int, optional): Return matches with a match weight</span>
<span class="sd">                above this threshold. Defaults to -4.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker = DuckDBLinker(df)</span>
<span class="sd">            linker.load_settings(&quot;saved_settings.json&quot;)</span>
<span class="sd">            # Pre-compute tf tables for any tables with</span>
<span class="sd">            # term frequency adjustments</span>
<span class="sd">            linker.compute_tf_table(&quot;first_name&quot;)</span>
<span class="sd">            record = {&#39;unique_id&#39;: 1,</span>
<span class="sd">                &#39;first_name&#39;: &quot;John&quot;,</span>
<span class="sd">                &#39;surname&#39;: &quot;Smith&quot;,</span>
<span class="sd">                &#39;dob&#39;: &quot;1971-05-24&quot;,</span>
<span class="sd">                &#39;city&#39;: &quot;London&quot;,</span>
<span class="sd">                &#39;email&#39;: &quot;john@smith.net&quot;</span>
<span class="sd">                }</span>
<span class="sd">            df = linker.find_matches_to_new_records([record], blocking_rules=[])</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: The pairwise comparisons.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">original_blocking_rules</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span>
        <span class="p">)</span>
        <span class="n">original_link_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">records_or_tablename</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">uid</span> <span class="o">=</span> <span class="n">ascii_uid</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span>
                <span class="n">records_or_tablename</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;__splink__df_new_records_</span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">new_records_tablename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;__splink__df_new_records_</span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_records_tablename</span> <span class="o">=</span> <span class="n">records_or_tablename</span>

        <span class="n">cache</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span>
        <span class="n">input_dfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># If our df_concat_with_tf table already exists, use backwards inference to</span>
        <span class="c1"># find all underlying term frequency tables.</span>
        <span class="k">if</span> <span class="s2">&quot;__splink__df_concat_with_tf&quot;</span> <span class="ow">in</span> <span class="n">cache</span><span class="p">:</span>
            <span class="n">concat_with_tf</span> <span class="o">=</span> <span class="n">cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat_with_tf&quot;</span><span class="p">]</span>
            <span class="n">tf_tables</span> <span class="o">=</span> <span class="n">compute_term_frequencies_from_concat_with_tf</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="c1"># This queues up our tf tables, rather materialising them</span>
            <span class="k">for</span> <span class="n">tf</span> <span class="ow">in</span> <span class="n">tf_tables</span><span class="p">:</span>
                <span class="c1"># if tf is a SplinkDataFrame, then the table already exists</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tf</span><span class="p">,</span> <span class="n">SplinkDataFrame</span><span class="p">):</span>
                    <span class="n">input_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tf</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">tf</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="n">tf</span><span class="p">[</span><span class="s2">&quot;output_table_name&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># This queues up our cols_with_tf and df_concat_with_tf tables.</span>
            <span class="n">concat_with_tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_df_concat_with_tf</span><span class="p">(</span><span class="n">materialise</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">concat_with_tf</span><span class="p">:</span>
            <span class="n">input_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">concat_with_tf</span><span class="p">)</span>

        <span class="n">rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">blocking_rules</span><span class="p">:</span>
            <span class="n">br_as_obj</span> <span class="o">=</span> <span class="n">BlockingRule</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">BlockingRule</span><span class="p">)</span> <span class="k">else</span> <span class="n">r</span>
            <span class="n">br_as_obj</span><span class="o">.</span><span class="n">preceding_rules</span> <span class="o">=</span> <span class="n">rules</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">br_as_obj</span><span class="p">)</span>
        <span class="n">blocking_rules</span> <span class="o">=</span> <span class="n">rules</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span> <span class="o">=</span> <span class="n">blocking_rules</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span> <span class="o">=</span> <span class="s2">&quot;link_only_find_matches_to_new_records&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_find_new_matches_mode</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">_join_tf_to_input_df_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;__splink__df_concat&quot;</span><span class="p">,</span> <span class="n">new_records_tablename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_new_records_with_tf&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">block_using_rules_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_blocked&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">compute_comparison_vector_values_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_comparison_vectors&quot;</span><span class="p">)</span>

        <span class="n">sqls</span> <span class="o">=</span> <span class="n">predict_from_comparison_vectors_sqls</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">,</span>
            <span class="n">sql_infinity_expression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_infinity_expression</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">sqls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="n">sql</span><span class="p">[</span><span class="s2">&quot;output_table_name&quot;</span><span class="p">])</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        select * from __splink__df_predict</span>
<span class="s2">        where match_weight &gt; </span><span class="si">{</span><span class="n">match_weight_threshold</span><span class="si">}</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__find_matches_predictions&quot;</span><span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">(</span>
            <span class="n">input_dataframes</span><span class="o">=</span><span class="n">input_dfs</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">original_blocking_rules</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span> <span class="o">=</span> <span class="n">original_link_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_find_new_matches_mode</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">predictions</span>

    <span class="k">def</span> <span class="nf">compare_two_records</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">record_2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use the linkage model to compare and score a pairwise record comparison</span>
<span class="sd">        based on the two input records provided</span>

<span class="sd">        Args:</span>
<span class="sd">            record_1 (dict): dictionary representing the first record.  Columns names</span>
<span class="sd">                and data types must be the same as the columns in the settings object</span>
<span class="sd">            record_2 (dict): dictionary representing the second record.  Columns names</span>
<span class="sd">                and data types must be the same as the columns in the settings object</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker = DuckDBLinker(df)</span>
<span class="sd">            linker.load_settings(&quot;saved_settings.json&quot;)</span>
<span class="sd">            linker.compare_two_records(record_left, record_right)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: Pairwise comparison with scored prediction</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">original_blocking_rules</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span>
        <span class="p">)</span>
        <span class="n">original_link_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_compare_two_records_mode</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">uid</span> <span class="o">=</span> <span class="n">ascii_uid</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">df_records_left</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span>
            <span class="p">[</span><span class="n">record_1</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;__splink__compare_two_records_left_</span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">df_records_left</span><span class="o">.</span><span class="n">templated_name</span> <span class="o">=</span> <span class="s2">&quot;__splink__compare_two_records_left&quot;</span>

        <span class="n">df_records_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span>
            <span class="p">[</span><span class="n">record_2</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;__splink__compare_two_records_right_</span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="n">df_records_right</span><span class="o">.</span><span class="n">templated_name</span> <span class="o">=</span> <span class="s2">&quot;__splink__compare_two_records_right&quot;</span>

        <span class="n">sql_join_tf</span> <span class="o">=</span> <span class="n">_join_tf_to_input_df_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">sql_join_tf</span> <span class="o">=</span> <span class="n">sql_join_tf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;__splink__df_concat&quot;</span><span class="p">,</span> <span class="s2">&quot;__splink__compare_two_records_left&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql_join_tf</span><span class="p">,</span> <span class="s2">&quot;__splink__compare_two_records_left_with_tf&quot;</span><span class="p">)</span>

        <span class="n">sql_join_tf</span> <span class="o">=</span> <span class="n">sql_join_tf</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;__splink__compare_two_records_left&quot;</span><span class="p">,</span> <span class="s2">&quot;__splink__compare_two_records_right&quot;</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql_join_tf</span><span class="p">,</span> <span class="s2">&quot;__splink__compare_two_records_right_with_tf&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">block_using_rules_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_blocked&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">compute_comparison_vector_values_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_comparison_vectors&quot;</span><span class="p">)</span>

        <span class="n">sqls</span> <span class="o">=</span> <span class="n">predict_from_comparison_vectors_sqls</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">,</span>
            <span class="n">sql_infinity_expression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_infinity_expression</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">sqls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="n">sql</span><span class="p">[</span><span class="s2">&quot;output_table_name&quot;</span><span class="p">])</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">(</span>
            <span class="p">[</span><span class="n">df_records_left</span><span class="p">,</span> <span class="n">df_records_right</span><span class="p">],</span> <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">original_blocking_rules</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span> <span class="o">=</span> <span class="n">original_link_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_compare_two_records_mode</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">predictions</span>

    <span class="k">def</span> <span class="nf">_self_link</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use the linkage model to compare and score all records in our input df with</span>
<span class="sd">            themselves.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: Scored pairwise comparisons of the input records to</span>
<span class="sd">                themselves.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">original_blocking_rules</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span>
        <span class="p">)</span>
        <span class="n">original_link_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span>

        <span class="c1"># Changes our sql to allow for a self link.</span>
        <span class="c1"># This is used in `_sql_gen_where_condition` in blocking.py</span>
        <span class="c1"># to remove any &#39;where&#39; clauses when blocking (normally when blocking</span>
        <span class="c1"># we want to *remove* self links!)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_self_link_mode</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Block on uid i.e. create pairwise record comparisons where the uid matches</span>
        <span class="n">uid_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_unique_id_input_columns</span>
        <span class="n">uid_l</span> <span class="o">=</span> <span class="n">_composite_unique_id_from_edges_sql</span><span class="p">(</span><span class="n">uid_cols</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;l&quot;</span><span class="p">)</span>
        <span class="n">uid_r</span> <span class="o">=</span> <span class="n">_composite_unique_id_from_edges_sql</span><span class="p">(</span><span class="n">uid_cols</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">BlockingRule</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">uid_l</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">uid_r</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="n">nodes_with_tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_df_concat_with_tf</span><span class="p">()</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">block_using_rules_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_blocked&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">compute_comparison_vector_values_sql</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_comparison_vectors&quot;</span><span class="p">)</span>

        <span class="n">sqls</span> <span class="o">=</span> <span class="n">predict_from_comparison_vectors_sqls</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">,</span>
            <span class="n">sql_infinity_expression</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_infinity_expression</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">sqls</span><span class="p">:</span>
            <span class="n">output_table_name</span> <span class="o">=</span> <span class="n">sql</span><span class="p">[</span><span class="s2">&quot;output_table_name&quot;</span><span class="p">]</span>
            <span class="n">output_table_name</span> <span class="o">=</span> <span class="n">output_table_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;predict&quot;</span><span class="p">,</span> <span class="s2">&quot;self_link&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="n">output_table_name</span><span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">(</span>
            <span class="n">input_dataframes</span><span class="o">=</span><span class="p">[</span><span class="n">nodes_with_tf</span><span class="p">],</span> <span class="n">use_cache</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_blocking_rules_to_generate_predictions</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">original_blocking_rules</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_link_type</span> <span class="o">=</span> <span class="n">original_link_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_self_link_mode</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">predictions</span>

    <span class="k">def</span> <span class="nf">cluster_pairwise_predictions_at_threshold</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df_predict</span><span class="p">:</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
        <span class="n">threshold_match_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">pairwise_formatting</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">filter_pairwise_format_for_clusters</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clusters the pairwise match predictions that result from `linker.predict()`</span>
<span class="sd">        into groups of connected record using the connected components graph clustering</span>
<span class="sd">        algorithm</span>

<span class="sd">        Records with an estimated `match_probability` above</span>
<span class="sd">        `threshold_match_probability` are considered to be a match (i.e. they represent</span>
<span class="sd">        the same entity).</span>

<span class="sd">        Args:</span>
<span class="sd">            df_predict (SplinkDataFrame): The results of `linker.predict()`</span>
<span class="sd">            threshold_match_probability (float): Filter the pairwise match predictions</span>
<span class="sd">                to include only pairwise comparisons with a match_probability above this</span>
<span class="sd">                threshold. This dataframe is then fed into the clustering</span>
<span class="sd">                algorithm.</span>
<span class="sd">            pairwise_formatting (bool): Whether to output the pairwise match predictions</span>
<span class="sd">                from linker.predict() with cluster IDs.</span>
<span class="sd">                If this is set to false, the output will be a list of all IDs, clustered</span>
<span class="sd">                into groups based on the desired match threshold.</span>
<span class="sd">            filter_pairwise_format_for_clusters (bool): If pairwise formatting has been</span>
<span class="sd">                selected, whether to output all columns found within linker.predict(),</span>
<span class="sd">                or just return clusters.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: A SplinkDataFrame containing a list of all IDs, clustered</span>
<span class="sd">                into groups based on the desired match threshold.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Feeding in df_predict forces materiailisation, if it exists in your database</span>
        <span class="n">concat_with_tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialise_df_concat_with_tf</span><span class="p">(</span><span class="n">df_predict</span><span class="p">)</span>

        <span class="n">edges_table</span> <span class="o">=</span> <span class="n">_cc_create_unique_id_cols</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">concat_with_tf</span><span class="o">.</span><span class="n">physical_name</span><span class="p">,</span>
            <span class="n">df_predict</span><span class="o">.</span><span class="n">physical_name</span><span class="p">,</span>
            <span class="n">threshold_match_probability</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">cc</span> <span class="o">=</span> <span class="n">solve_connected_components</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">edges_table</span><span class="p">,</span>
            <span class="n">df_predict</span><span class="p">,</span>
            <span class="n">concat_with_tf</span><span class="p">,</span>
            <span class="n">pairwise_formatting</span><span class="p">,</span>
            <span class="n">filter_pairwise_format_for_clusters</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">cc</span>

    <span class="k">def</span> <span class="nf">profile_columns</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">column_expressions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">top_n</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">bottom_n</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="n">profile_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_expressions</span><span class="p">,</span> <span class="n">top_n</span><span class="o">=</span><span class="n">top_n</span><span class="p">,</span> <span class="n">bottom_n</span><span class="o">=</span><span class="n">bottom_n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_labels_tablename_from_input</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">SplinkDataFrame</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span> <span class="n">SplinkDataFrame</span><span class="p">):</span>
            <span class="n">labels_tablename</span> <span class="o">=</span> <span class="n">labels_splinkdataframe_or_table_name</span><span class="o">.</span><span class="n">physical_name</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">labels_tablename</span> <span class="o">=</span> <span class="n">labels_splinkdataframe_or_table_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;The &#39;labels_splinkdataframe_or_table_name&#39; argument&quot;</span>
                <span class="s2">&quot; must be of type SplinkDataframe or a string representing a tablename&quot;</span>
                <span class="s2">&quot; in the input database&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">labels_tablename</span>

    <span class="k">def</span> <span class="nf">estimate_m_from_pairwise_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate the m parameters of the linkage model from a dataframe of pairwise</span>
<span class="sd">        labels.</span>

<span class="sd">        The table of labels should be in the following format, and should</span>
<span class="sd">        be registered with your database:</span>
<span class="sd">        |source_dataset_l|unique_id_l|source_dataset_r|unique_id_r|</span>
<span class="sd">        |----------------|-----------|----------------|-----------|</span>
<span class="sd">        |df_1            |1          |df_2            |2          |</span>
<span class="sd">        |df_1            |1          |df_2            |3          |</span>

<span class="sd">        Note that `source_dataset` and `unique_id` should correspond to the</span>
<span class="sd">        values specified in the settings dict, and the `input_table_aliases`</span>
<span class="sd">        passed to the `linker` object. Note that at the moment, this method does</span>
<span class="sd">        not respect values in a `clerical_match_score` column.  If provided, these</span>
<span class="sd">        are ignored and it is assumed that every row in the table of labels is a score</span>
<span class="sd">        of 1, i.e. a perfect match.</span>

<span class="sd">        Args:</span>
<span class="sd">          labels_splinkdataframe_or_table_name (str): Name of table containing labels</span>
<span class="sd">            in the database or SplinkDataframe</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            pairwise_labels = pd.read_csv(&quot;./data/pairwise_labels_to_estimate_m.csv&quot;)</span>
<span class="sd">            linker.register_table(pairwise_labels, &quot;labels&quot;, overwrite=True)</span>
<span class="sd">            linker.estimate_m_from_pairwise_labels(&quot;labels&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
            <span class="n">labels_splinkdataframe_or_table_name</span>
        <span class="p">)</span>
        <span class="n">estimate_m_from_pairwise_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels_tablename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">truth_space_table_from_labels_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate truth statistics (false positive etc.) for each threshold value of</span>
<span class="sd">        match_probability, suitable for plotting a ROC chart.</span>

<span class="sd">        The table of labels should be in the following format, and should be registered</span>
<span class="sd">        with your database:</span>

<span class="sd">        |source_dataset_l|unique_id_l|source_dataset_r|unique_id_r|clerical_match_score|</span>
<span class="sd">        |----------------|-----------|----------------|-----------|--------------------|</span>
<span class="sd">        |df_1            |1          |df_2            |2          |0.99                |</span>
<span class="sd">        |df_1            |1          |df_2            |3          |0.2                 |</span>

<span class="sd">        Note that `source_dataset` and `unique_id` should correspond to the values</span>
<span class="sd">        specified in the settings dict, and the `input_table_aliases` passed to the</span>
<span class="sd">        `linker` object.</span>

<span class="sd">        For `dedupe_only` links, the `source_dataset` columns can be ommitted.</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_splinkdataframe_or_table_name (str | SplinkDataFrame): Name of table</span>
<span class="sd">                containing labels in the database</span>
<span class="sd">            threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">                provided by the user is a probability rather than binary, this value</span>
<span class="sd">                is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">                matches or non matches. Defaults to 0.5.</span>
<span class="sd">            match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">                are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">                sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">                the number of points plotted on the ROC chart. Defaults to None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            === &quot;DuckDB&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                labels = pd.read_csv(&quot;my_labels.csv&quot;)</span>
<span class="sd">                linker.register_table(labels, &quot;labels&quot;)</span>
<span class="sd">                linker.truth_space_table_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Spark&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                labels = spark.read.csv(&quot;my_labels.csv&quot;, header=True)</span>
<span class="sd">                labels.createDataFrame(&quot;labels&quot;)</span>
<span class="sd">                linker.truth_space_table_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame:  Table of truth statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
            <span class="n">labels_splinkdataframe_or_table_name</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_accuracy_columns_not_computed</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">truth_space_table_from_labels_table</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">labels_tablename</span><span class="p">,</span>
            <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
            <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">roc_chart_from_labels_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a ROC chart from labelled (ground truth) data.</span>

<span class="sd">        The table of labels should be in the following format, and should be registered</span>
<span class="sd">        with your database:</span>

<span class="sd">        |source_dataset_l|unique_id_l|source_dataset_r|unique_id_r|clerical_match_score|</span>
<span class="sd">        |----------------|-----------|----------------|-----------|--------------------|</span>
<span class="sd">        |df_1            |1          |df_2            |2          |0.99                |</span>
<span class="sd">        |df_1            |1          |df_2            |3          |0.2                 |</span>

<span class="sd">        Note that `source_dataset` and `unique_id` should correspond to the values</span>
<span class="sd">        specified in the settings dict, and the `input_table_aliases` passed to the</span>
<span class="sd">        `linker` object.</span>

<span class="sd">        For `dedupe_only` links, the `source_dataset` columns can be ommitted.</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_splinkdataframe_or_table_name (str | SplinkDataFrame): Name of table</span>
<span class="sd">                containing labels in the database</span>
<span class="sd">            threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">                provided by the user is a probability rather than binary, this value</span>
<span class="sd">                is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">                matches or non matches. Defaults to 0.5.</span>
<span class="sd">            match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">                are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">                sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">                the number of points plotted on the ROC chart. Defaults to None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            === &quot;DuckDB&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                labels = pd.read_csv(&quot;my_labels.csv&quot;)</span>
<span class="sd">                linker.register_table(labels, &quot;labels&quot;)</span>
<span class="sd">                linker.roc_chart_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Spark&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                labels = spark.read.csv(&quot;my_labels.csv&quot;, header=True)</span>
<span class="sd">                labels.createDataFrame(&quot;labels&quot;)</span>
<span class="sd">                linker.roc_chart_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">                ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
            <span class="n">labels_splinkdataframe_or_table_name</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_accuracy_columns_not_computed</span><span class="p">()</span>
        <span class="n">df_truth_space</span> <span class="o">=</span> <span class="n">truth_space_table_from_labels_table</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">labels_tablename</span><span class="p">,</span>
            <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
            <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">recs</span> <span class="o">=</span> <span class="n">df_truth_space</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">roc_chart</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">precision_recall_chart_from_labels_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a precision-recall chart from labelled (ground truth) data.</span>

<span class="sd">        The table of labels should be in the following format, and should be registered</span>
<span class="sd">        as a table with your database:</span>

<span class="sd">        |source_dataset_l|unique_id_l|source_dataset_r|unique_id_r|clerical_match_score|</span>
<span class="sd">        |----------------|-----------|----------------|-----------|--------------------|</span>
<span class="sd">        |df_1            |1          |df_2            |2          |0.99                |</span>
<span class="sd">        |df_1            |1          |df_2            |3          |0.2                 |</span>

<span class="sd">        Note that `source_dataset` and `unique_id` should correspond to the values</span>
<span class="sd">        specified in the settings dict, and the `input_table_aliases` passed to the</span>
<span class="sd">        `linker` object.</span>

<span class="sd">        For `dedupe_only` links, the `source_dataset` columns can be ommitted.</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_splinkdataframe_or_table_name (str | SplinkDataFrame): Name of table</span>
<span class="sd">                containing labels in the database</span>
<span class="sd">            threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">                provided by the user is a probability rather than binary, this value</span>
<span class="sd">                is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">                matches or non matches. Defaults to 0.5.</span>
<span class="sd">            match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">                are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">                sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">                the number of points plotted on the ROC chart. Defaults to None.</span>
<span class="sd">        Examples:</span>
<span class="sd">            === &quot;DuckDB&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                labels = pd.read_csv(&quot;my_labels.csv&quot;)</span>
<span class="sd">                linker.register_table(labels, &quot;labels&quot;)</span>
<span class="sd">                linker.precision_recall_chart_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">                ```</span>
<span class="sd">            === &quot;Spark&quot;</span>
<span class="sd">                ```py</span>
<span class="sd">                labels = spark.read.csv(&quot;my_labels.csv&quot;, header=True)</span>
<span class="sd">                labels.createDataFrame(&quot;labels&quot;)</span>
<span class="sd">                linker.precision_recall_chart_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">                ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
            <span class="n">labels_splinkdataframe_or_table_name</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_accuracy_columns_not_computed</span><span class="p">()</span>
        <span class="n">df_truth_space</span> <span class="o">=</span> <span class="n">truth_space_table_from_labels_table</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">labels_tablename</span><span class="p">,</span>
            <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
            <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">recs</span> <span class="o">=</span> <span class="n">df_truth_space</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">precision_recall_chart</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prediction_errors_from_labels_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span>
        <span class="n">include_false_positives</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">include_false_negatives</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a dataframe containing false positives and false negatives</span>
<span class="sd">        based on the comparison between the clerical_match_score in the labels</span>
<span class="sd">        table compared with the splink predicted match probability</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_splinkdataframe_or_table_name (str | SplinkDataFrame): Name of table</span>
<span class="sd">                containing labels in the database</span>
<span class="sd">            include_false_positives (bool, optional): Defaults to True.</span>
<span class="sd">            include_false_negatives (bool, optional): Defaults to True.</span>
<span class="sd">            threshold (float, optional): Threshold above which a score is considered</span>
<span class="sd">                to be a match. Defaults to 0.5.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame:  Table containing false positives and negatives</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
            <span class="n">labels_splinkdataframe_or_table_name</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">prediction_errors_from_labels_table</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">labels_tablename</span><span class="p">,</span>
            <span class="n">include_false_positives</span><span class="p">,</span>
            <span class="n">include_false_negatives</span><span class="p">,</span>
            <span class="n">threshold</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">truth_space_table_from_labels_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_column_name</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate truth statistics (false positive etc.) for each threshold value of</span>
<span class="sd">        match_probability, suitable for plotting a ROC chart.</span>

<span class="sd">        Your labels_column_name should include the ground truth cluster (unique</span>
<span class="sd">        identifier) that groups entities which are the same</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_tablename (str): Name of table containing labels in the database</span>
<span class="sd">            threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">                provided by the user is a probability rather than binary, this value</span>
<span class="sd">                is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">                matches or non matches. Defaults to 0.5.</span>
<span class="sd">            match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">                are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">                sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">                the number of points plotted on the ROC chart. Defaults to None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.truth_space_table_from_labels_column(&quot;cluster&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame:  Table of truth statistics</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="n">truth_space_table_from_labels_column</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">labels_column_name</span><span class="p">,</span> <span class="n">threshold_actual</span><span class="p">,</span> <span class="n">match_weight_round_to_nearest</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">roc_chart_from_labels_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_column_name</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a ROC chart from ground truth data, whereby the ground truth</span>
<span class="sd">        is in a column in the input dataset called `labels_column_name`</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_column_name (str): Column name containing labels in the input table</span>
<span class="sd">            threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">                provided by the user is a probability rather than binary, this value</span>
<span class="sd">                is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">                matches or non matches. Defaults to 0.5.</span>
<span class="sd">            match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">                are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">                sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">                the number of points plotted on the ROC chart. Defaults to None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.roc_chart_from_labels_column(&quot;labels&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df_truth_space</span> <span class="o">=</span> <span class="n">truth_space_table_from_labels_column</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">labels_column_name</span><span class="p">,</span>
            <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
            <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">recs</span> <span class="o">=</span> <span class="n">df_truth_space</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">roc_chart</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">precision_recall_chart_from_labels_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_column_name</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a precision-recall chart from ground truth data, whereby the ground</span>
<span class="sd">        truth is in a column in the input dataset called `labels_column_name`</span>

<span class="sd">        Args:</span>
<span class="sd">            labels_column_name (str): Column name containing labels in the input table</span>
<span class="sd">            threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">                provided by the user is a probability rather than binary, this value</span>
<span class="sd">                is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">                matches or non matches. Defaults to 0.5.</span>
<span class="sd">            match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">                are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">                sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">                the number of points plotted on the ROC chart. Defaults to None.</span>
<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.precision_recall_chart_from_labels_column(&quot;ground_truth&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">df_truth_space</span> <span class="o">=</span> <span class="n">truth_space_table_from_labels_column</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">labels_column_name</span><span class="p">,</span>
            <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
            <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">recs</span> <span class="o">=</span> <span class="n">df_truth_space</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">precision_recall_chart</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">prediction_errors_from_labels_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">label_colname</span><span class="p">,</span>
        <span class="n">include_false_positives</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">include_false_negatives</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a dataframe containing false positives and false negatives</span>
<span class="sd">        based on the comparison between the splink match probability and the</span>
<span class="sd">        labels column.  A label column is a column in the input dataset that contains</span>
<span class="sd">        the &#39;ground truth&#39; cluster to which the record belongs</span>

<span class="sd">        Args:</span>
<span class="sd">            label_colname (str): Name of labels column in input data</span>
<span class="sd">            include_false_positives (bool, optional): Defaults to True.</span>
<span class="sd">            include_false_negatives (bool, optional): Defaults to True.</span>
<span class="sd">            threshold (float, optional): Threshold above which a score is considered</span>
<span class="sd">                to be a match. Defaults to 0.5.</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame:  Table containing false positives and negatives</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">prediction_errors_from_label_column</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">label_colname</span><span class="p">,</span>
            <span class="n">include_false_positives</span><span class="p">,</span>
            <span class="n">include_false_negatives</span><span class="p">,</span>
            <span class="n">threshold</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">match_weights_histogram</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">df_predict</span><span class="p">:</span> <span class="n">SplinkDataFrame</span><span class="p">,</span> <span class="n">target_bins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a histogram that shows the distribution of match weights in</span>
<span class="sd">        `df_predict`</span>

<span class="sd">        Args:</span>
<span class="sd">            df_predict (SplinkDataFrame): Output of `linker.predict()`</span>
<span class="sd">            target_bins (int, optional): Target number of bins in histogram. Defaults to</span>
<span class="sd">                30.</span>
<span class="sd">            width (int, optional): Width of output. Defaults to 600.</span>
<span class="sd">            height (int, optional): Height of output chart. Defaults to 250.</span>


<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">histogram_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_predict</span><span class="p">,</span> <span class="n">target_bins</span><span class="p">)</span>
        <span class="n">recs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">match_weights_histogram</span><span class="p">(</span><span class="n">recs</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">waterfall_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">filter_nulls</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Visualise how the final match weight is computed for the provided pairwise</span>
<span class="sd">        record comparisons.</span>

<span class="sd">        Records must be provided as a list of dictionaries. This would usually be</span>
<span class="sd">        obtained from `df.as_record_dict(limit=n)` where `df` is a SplinkDataFrame.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            df = linker.predict(threshold_match_weight=2)</span>
<span class="sd">            records = df.as_record_dict(limit=10)</span>
<span class="sd">            linker.waterfall_chart(records)</span>
<span class="sd">            ```</span>

<span class="sd">        Args:</span>
<span class="sd">            records (List[dict]): Usually be obtained from `df.as_record_dict(limit=n)`</span>
<span class="sd">                where `df` is a SplinkDataFrame.</span>
<span class="sd">            filter_nulls (bool, optional): Whether the visualiation shows null</span>
<span class="sd">                comparisons, which have no effect on final match weight. Defaults to</span>
<span class="sd">                True.</span>


<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_waterfall_columns_not_computed</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">waterfall_chart</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">,</span> <span class="n">filter_nulls</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unlinkables_chart</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">x_col</span><span class="o">=</span><span class="s2">&quot;match_weight&quot;</span><span class="p">,</span>
        <span class="n">source_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an interactive chart displaying the proportion of records that</span>
<span class="sd">        are &quot;unlinkable&quot; for a given splink score threshold and model parameters.</span>

<span class="sd">        Unlinkable records are those that, even when compared with themselves, do not</span>
<span class="sd">        contain enough information to confirm a match.</span>

<span class="sd">        Args:</span>
<span class="sd">            x_col (str, optional): Column to use for the x-axis.</span>
<span class="sd">                Defaults to &quot;match_weight&quot;.</span>
<span class="sd">            source_dataset (str, optional): Name of the source dataset to use for</span>
<span class="sd">                the title of the output chart.</span>
<span class="sd">            as_dict (bool, optional): If True, return a dict version of the chart.</span>

<span class="sd">        Examples:</span>
<span class="sd">            For the simplest code pipeline, load a pre-trained model</span>
<span class="sd">            and run this against the test data.</span>
<span class="sd">            ```py</span>
<span class="sd">            df = pd.read_csv(&quot;./tests/datasets/fake_1000_from_splink_demos.csv&quot;)</span>
<span class="sd">            linker = DuckDBLinker(df)</span>
<span class="sd">            linker.load_settings(&quot;saved_settings.json&quot;)</span>
<span class="sd">            linker.unlinkables_chart()</span>
<span class="sd">            ```</span>
<span class="sd">            For more complex code pipelines, you can run an entire pipeline</span>
<span class="sd">            that estimates your m and u values, before `unlinkables_chart().</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Link our initial df on itself and calculate the % of unlinkable entries</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">unlinkables_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unlinkables_chart</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">x_col</span><span class="p">,</span> <span class="n">source_dataset</span><span class="p">,</span> <span class="n">as_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">comparison_viewer_dashboard</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df_predict</span><span class="p">:</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
        <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">num_example_rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">return_html_as_string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an interactive html visualization of the linker&#39;s predictions and</span>
<span class="sd">        save to `out_path`.  For more information see</span>
<span class="sd">        [this video](https://www.youtube.com/watch?v=DNvCMqjipis)</span>


<span class="sd">        Args:</span>
<span class="sd">            df_predict (SplinkDataFrame): The outputs of `linker.predict()`</span>
<span class="sd">            out_path (str): The path (including filename) to save the html file to.</span>
<span class="sd">            overwrite (bool, optional): Overwrite the html file if it already exists?</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            num_example_rows (int, optional): Number of example rows per comparison</span>
<span class="sd">                vector. Defaults to 2.</span>
<span class="sd">            return_html_as_string: If True, return the html as a string</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            df_predictions = linker.predict()</span>
<span class="sd">            linker.comparison_viewer_dashboard(df_predictions, &quot;scv.html&quot;, True, 2)</span>
<span class="sd">            ```</span>

<span class="sd">            Optionally, in Jupyter, you can display the results inline</span>
<span class="sd">            Otherwise you can just load the html file in your browser</span>
<span class="sd">            ```py</span>
<span class="sd">            from IPython.display import IFrame</span>
<span class="sd">            IFrame(src=&quot;./scv.html&quot;, width=&quot;100%&quot;, height=1200)</span>
<span class="sd">            ```</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_waterfall_columns_not_computed</span><span class="p">()</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">comparison_vector_distribution_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_comparison_vector_distribution&quot;</span><span class="p">)</span>

        <span class="n">sqls</span> <span class="o">=</span> <span class="n">comparison_viewer_table_sqls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_example_rows</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">sqls</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="n">sql</span><span class="p">[</span><span class="s2">&quot;output_table_name&quot;</span><span class="p">])</span>

        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">([</span><span class="n">df_predict</span><span class="p">])</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_splink_comparison_viewer_html</span><span class="p">(</span>
            <span class="n">df</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_as_completed_dict</span><span class="p">(),</span>
            <span class="n">out_path</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">return_html_as_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rendered</span>

    <span class="k">def</span> <span class="nf">parameter_estimate_comparisons_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_m</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_u</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Show a chart that shows how parameter estimates have differed across</span>
<span class="sd">        the different estimation methods you have used.</span>

<span class="sd">        For example, if you have run two EM estimation sessions, blocking on</span>
<span class="sd">        different variables, and both result in parameter estimates for</span>
<span class="sd">        first_name, this chart will enable easy comparison of the different</span>
<span class="sd">        estimates</span>

<span class="sd">        Args:</span>
<span class="sd">            include_m (bool, optional): Show different estimates of m values. Defaults</span>
<span class="sd">                to True.</span>
<span class="sd">            include_u (bool, optional): Show different estimates of u values. Defaults</span>
<span class="sd">                to True.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_parameter_estimates_as_records</span>

        <span class="n">to_retain</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">include_m</span><span class="p">:</span>
            <span class="n">to_retain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_u</span><span class="p">:</span>
            <span class="n">to_retain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">)</span>

        <span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;m_or_u&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">to_retain</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">parameter_estimate_comparisons</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">missingness_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dataset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a summary chart of the missingness (prevalence of nulls) of</span>
<span class="sd">        columns in the input datasets.  By default, missingness is assessed across</span>
<span class="sd">        all input datasets</span>

<span class="sd">        Args:</span>
<span class="sd">            input_dataset (str, optional): Name of one of the input tables in the</span>
<span class="sd">            database.  If provided, missingness will be computed for this table alone.</span>
<span class="sd">            Defaults to None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.missingness_chart()</span>
<span class="sd">            ```</span>
<span class="sd">            To view offline (if you don&#39;t have an internet connection):</span>
<span class="sd">            ```py</span>
<span class="sd">            from splink.charts import save_offline_chart</span>
<span class="sd">            c = linker.missingness_chart()</span>
<span class="sd">            save_offline_chart(c.spec, &quot;test_chart.html&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">            View resultant html file in Jupyter (or just load it in your browser)</span>
<span class="sd">            ```py</span>
<span class="sd">            from IPython.display import IFrame</span>
<span class="sd">            IFrame(src=&quot;./test_chart.html&quot;, width=1000, height=500</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">missingness_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dataset</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">missingness_chart</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">completeness_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dataset</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cols</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a summary chart of the completeness (proportion of non-nulls) of</span>
<span class="sd">        columns in each of the input datasets. By default, completeness is assessed for</span>
<span class="sd">        all column in the input data.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_dataset (str, optional): Name of one of the input tables in the</span>
<span class="sd">                database.  If provided, completeness will be computed for this table</span>
<span class="sd">                alone. Defaults to None.</span>
<span class="sd">            cols (List[str], optional): List of column names to calculate completeness.</span>
<span class="sd">                Default to None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.completeness_chart()</span>
<span class="sd">            ```</span>
<span class="sd">            To view offline (if you don&#39;t have an internet connection):</span>
<span class="sd">            ```py</span>
<span class="sd">            from splink.charts import save_offline_chart</span>
<span class="sd">            c = linker.completeness_chart()</span>
<span class="sd">            save_offline_chart(c.spec, &quot;test_chart.html&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">            View resultant html file in Jupyter (or just load it in your browser)</span>
<span class="sd">            ```py</span>
<span class="sd">            from IPython.display import IFrame</span>
<span class="sd">            IFrame(src=&quot;./test_chart.html&quot;, width=1000, height=500</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">records</span> <span class="o">=</span> <span class="n">completeness_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_dataset</span><span class="p">,</span> <span class="n">cols</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">completeness_chart</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">count_num_comparisons_from_blocking_rule</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">blocking_rule</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the number of pairwise record comparisons that would be generated by</span>
<span class="sd">        a blocking rule</span>

<span class="sd">        Args:</span>
<span class="sd">            blocking_rule (str): The blocking rule to analyse</span>
<span class="sd">            link_type (str, optional): The link type.  This is needed only if the</span>
<span class="sd">                linker has not yet been provided with a settings dictionary.  Defaults</span>
<span class="sd">                to None.</span>
<span class="sd">            unique_id_column_name (str, optional):  This is needed only if the</span>
<span class="sd">                linker has not yet been provided with a settings dictionary.  Defaults</span>
<span class="sd">                to None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            br = &quot;l.first_name = r.first_name&quot;</span>
<span class="sd">            linker.count_num_comparisons_from_blocking_rule(br)</span>
<span class="sd">            ```</span>
<span class="sd">            &gt; 19387</span>
<span class="sd">            ```py</span>
<span class="sd">            br = &quot;l.name = r.name and substr(l.dob,1,4) = substr(r.dob,1,4)&quot;</span>
<span class="sd">            linker.count_num_comparisons_from_blocking_rule(br)</span>
<span class="sd">            ```</span>
<span class="sd">            &gt; 394</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The number of comparisons generated by the blocking rule</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">vertically_concatenate_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_concat&quot;</span><span class="p">)</span>

        <span class="n">sql</span> <span class="o">=</span> <span class="n">number_of_comparisons_generated_by_blocking_rule_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blocking_rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__analyse_blocking_rule&quot;</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">()</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="s2">&quot;count_of_pairwise_comparisons_generated&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">cumulative_comparisons_from_blocking_rules_records</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">blocking_rules</span><span class="p">:</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output the number of comparisons generated by each successive blocking rule.</span>

<span class="sd">        This is equivalent to the output size of df_predict and details how many</span>
<span class="sd">        comparisons each of your individual blocking rules will contribute to the</span>
<span class="sd">        total.</span>

<span class="sd">        Args:</span>
<span class="sd">            blocking_rules (str or list): The blocking rule(s) to compute comparisons</span>
<span class="sd">                for. If null, the rules set out in your settings object will be used.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker_settings = DuckDBLinker(df, settings)</span>
<span class="sd">            # Compute the cumulative number of comparisons generated by the rules</span>
<span class="sd">            # in your settings object.</span>
<span class="sd">            linker_settings.cumulative_comparisons_from_blocking_rules_records()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            # Generate total comparisons with custom blocking rules.</span>
<span class="sd">            blocking_rules = [</span>
<span class="sd">               &quot;l.surname = r.surname&quot;,</span>
<span class="sd">               &quot;l.first_name = r.first_name</span>
<span class="sd">                and substr(l.dob,1,4) = substr(r.dob,1,4)&quot;</span>
<span class="sd">            ]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            linker_settings.cumulative_comparisons_from_blocking_rules_records(</span>
<span class="sd">                blocking_rules</span>
<span class="sd">             )</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            List: A list of blocking rules and the corresponding number of</span>
<span class="sd">                comparisons it is forecast to generate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">blocking_rules</span><span class="p">:</span>
            <span class="n">blocking_rules</span> <span class="o">=</span> <span class="n">ensure_is_list</span><span class="p">(</span><span class="n">blocking_rules</span><span class="p">)</span>

        <span class="n">records</span> <span class="o">=</span> <span class="n">cumulative_comparisons_generated_by_blocking_rules</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">blocking_rules</span><span class="p">,</span> <span class="n">output_chart</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">records</span>

    <span class="k">def</span> <span class="nf">cumulative_num_comparisons_from_blocking_rules_chart</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">blocking_rules</span><span class="p">:</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a chart with the cumulative number of comparisons generated by a</span>
<span class="sd">        selection of blocking rules.</span>

<span class="sd">        This is equivalent to the output size of df_predict and details how many</span>
<span class="sd">        comparisons each of your individual blocking rules will contribute to the</span>
<span class="sd">        total.</span>

<span class="sd">        Args:</span>
<span class="sd">            blocking_rules (str or list): The blocking rule(s) to compute comparisons</span>
<span class="sd">                for. If null, the rules set out in your settings object will be used.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker_settings = DuckDBLinker(df, settings)</span>
<span class="sd">            # Compute the cumulative number of comparisons generated by the rules</span>
<span class="sd">            # in your settings object.</span>
<span class="sd">            linker_settings.cumulative_num_comparisons_from_blocking_rules_chart()</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            # Generate total comparisons with custom blocking rules.</span>
<span class="sd">            blocking_rules = [</span>
<span class="sd">               &quot;l.surname = r.surname&quot;,</span>
<span class="sd">               &quot;l.first_name = r.first_name</span>
<span class="sd">                and substr(l.dob,1,4) = substr(r.dob,1,4)&quot;</span>
<span class="sd">            ]</span>
<span class="sd">            &gt;&gt;&gt;</span>
<span class="sd">            linker_settings.cumulative_num_comparisons_from_blocking_rules_chart(</span>
<span class="sd">                blocking_rules</span>
<span class="sd">             )</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">blocking_rules</span><span class="p">:</span>
            <span class="n">blocking_rules</span> <span class="o">=</span> <span class="n">ensure_is_list</span><span class="p">(</span><span class="n">blocking_rules</span><span class="p">)</span>

        <span class="n">records</span> <span class="o">=</span> <span class="n">cumulative_comparisons_generated_by_blocking_rules</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">blocking_rules</span><span class="p">,</span> <span class="n">output_chart</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">cumulative_blocking_rule_comparisons_generated</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">count_num_comparisons_from_blocking_rules_for_prediction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">df_predict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Counts the maginal number of edges created from each of the blocking rules</span>
<span class="sd">        in `blocking_rules_to_generate_predictions`</span>

<span class="sd">        This is different to `count_num_comparisons_from_blocking_rule`</span>
<span class="sd">        because it (a) analyses multiple blocking rules rather than a single rule, and</span>
<span class="sd">        (b) deduplicates any comparisons that are generated, to tell you the</span>
<span class="sd">        marginal effect of each entry in `blocking_rules_to_generate_predictions`</span>

<span class="sd">        Args:</span>
<span class="sd">            df_predict (SplinkDataFrame): SplinkDataFrame with match weights</span>
<span class="sd">            and probabilities of rows matching</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker = DuckDBLinker(df, connection=&quot;:memory:&quot;)</span>
<span class="sd">            linker.load_settings(&quot;saved_settings.json&quot;)</span>
<span class="sd">            df_predict = linker.predict(threshold_match_probability=0.95)</span>
<span class="sd">            count_pairwise = linker.count_num_comparisons_from_blocking_rules_for_prediction(df_predict)</span>
<span class="sd">            count_pairwise.as_pandas_dataframe(limit=5)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            SplinkDataFrame: A SplinkDataFrame of the pairwise comparisons and</span>
<span class="sd">                estimated pairwise comparisons generated by the blocking rules.</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="n">count_num_comparisons_from_blocking_rules_for_prediction_sql</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">df_predict</span>
        <span class="p">)</span>
        <span class="n">match_key_analysis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sql_to_splink_dataframe_checking_cache</span><span class="p">(</span>
            <span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__match_key_analysis&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">match_key_analysis</span>

    <span class="k">def</span> <span class="nf">match_weights_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a chart of the (partial) match weights of the linkage model</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.match_weights_chart()</span>
<span class="sd">            ```</span>
<span class="sd">            To view offline (if you don&#39;t have an internet connection):</span>
<span class="sd">            ```py</span>
<span class="sd">            from splink.charts import save_offline_chart</span>
<span class="sd">            c = linker.match_weights_chart()</span>
<span class="sd">            save_offline_chart(c.spec, &quot;test_chart.html&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">            View resultant html file in Jupyter (or just load it in your browser)</span>
<span class="sd">            ```py</span>
<span class="sd">            from IPython.display import IFrame</span>
<span class="sd">            IFrame(src=&quot;./test_chart.html&quot;, width=1000, height=500)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">match_weights_chart</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tf_adjustment_chart</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">output_column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">n_most_freq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">n_least_freq</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">vals_to_include</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">as_dict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a chart showing the impact of term frequency adjustments on a</span>
<span class="sd">        specific comparison level.</span>
<span class="sd">        Each value</span>

<span class="sd">        Args:</span>
<span class="sd">            output_column_name (str): Name of an output column for which term frequency</span>
<span class="sd">                 adjustment has been applied.</span>
<span class="sd">            n_most_freq (int, optional): Number of most frequent values to show. If this</span>
<span class="sd">                 or `n_least_freq` set to None, all values will be shown.</span>
<span class="sd">                Default to 10.</span>
<span class="sd">            n_least_freq (int, optional): Number of least frequent values to show. If</span>
<span class="sd">                this or `n_most_freq` set to None, all values will be shown.</span>
<span class="sd">                Default to 10.</span>
<span class="sd">            vals_to_include (list, optional): Specific values for which to show term</span>
<span class="sd">                sfrequency adjustments.</span>
<span class="sd">                Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Comparisons with TF adjustments</span>
        <span class="n">tf_comparisons</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_output_column_name</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">comparisons</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">([</span><span class="n">cl</span><span class="o">.</span><span class="n">_has_tf_adjustments</span> <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">comparison_levels</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="n">output_column_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">tf_comparisons</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_column_name</span><span class="si">}</span><span class="s2"> is not a valid comparison column, or does not&quot;</span>
                <span class="sa">f</span><span class="s2">&quot; have term frequency adjustment activated&quot;</span>
            <span class="p">)</span>

        <span class="n">vals_to_include</span> <span class="o">=</span> <span class="n">ensure_is_list</span><span class="p">(</span><span class="n">vals_to_include</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tf_adjustment_chart</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">output_column_name</span><span class="p">,</span>
            <span class="n">n_most_freq</span><span class="p">,</span>
            <span class="n">n_least_freq</span><span class="p">,</span>
            <span class="n">vals_to_include</span><span class="p">,</span>
            <span class="n">as_dict</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">m_u_parameters_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Display a chart of the m and u parameters of the linkage model</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.m_u_parameters_chart()</span>
<span class="sd">            ```</span>
<span class="sd">            To view offline (if you don&#39;t have an internet connection):</span>
<span class="sd">            ```py</span>
<span class="sd">            from splink.charts import save_offline_chart</span>
<span class="sd">            c = linker.match_weights_chart()</span>
<span class="sd">            save_offline_chart(c.spec, &quot;test_chart.html&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">            View resultant html file in Jupyter (or just load it in your browser)</span>
<span class="sd">            ```py</span>
<span class="sd">            from IPython.display import IFrame</span>
<span class="sd">            IFrame(src=&quot;./test_chart.html&quot;, width=1000, height=500)</span>
<span class="sd">            ```</span>

<span class="sd">        Returns:</span>
<span class="sd">            VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">                The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">                attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">m_u_parameters_chart</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">cluster_studio_dashboard</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df_predict</span><span class="p">:</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
        <span class="n">df_clustered</span><span class="p">:</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
        <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">sampling_method</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
        <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">cluster_ids</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cluster_names</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">return_html_as_string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate an interactive html visualization of the predicted cluster and</span>
<span class="sd">        save to `out_path`.</span>

<span class="sd">        Args:</span>
<span class="sd">            df_predict (SplinkDataFrame): The outputs of `linker.predict()`</span>
<span class="sd">            df_clustered (SplinkDataFrame): The outputs of</span>
<span class="sd">                `linker.cluster_pairwise_predictions_at_threshold()`</span>
<span class="sd">            out_path (str): The path (including filename) to save the html file to.</span>
<span class="sd">            sampling_method (str, optional): `random` or `by_cluster_size`. Defaults to</span>
<span class="sd">                `random`.</span>
<span class="sd">            sample_size (int, optional): Number of clusters to show in the dahboard.</span>
<span class="sd">                Defaults to 10.</span>
<span class="sd">            cluster_ids (list): The IDs of the clusters that will be displayed in the</span>
<span class="sd">                dashboard.  If provided, ignore the `sampling_method` and `sample_size`</span>
<span class="sd">                arguments. Defaults to None.</span>
<span class="sd">            overwrite (bool, optional): Overwrite the html file if it already exists?</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            cluster_names (list, optional): If provided, the dashboard will display</span>
<span class="sd">                these names in the selection box. Ony works in conjunction with</span>
<span class="sd">                `cluster_ids`.  Defaults to None.</span>
<span class="sd">            return_html_as_string: If True, return the html as a string</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            df_p = linker.predict()</span>
<span class="sd">            df_c = linker.cluster_pairwise_predictions_at_threshold(df_p, 0.5)</span>
<span class="sd">            linker.cluster_studio_dashboard(</span>
<span class="sd">                df_p, df_c, [0, 4, 7], &quot;cluster_studio.html&quot;</span>
<span class="sd">            )</span>
<span class="sd">            ```</span>
<span class="sd">            Optionally, in Jupyter, you can display the results inline</span>
<span class="sd">            Otherwise you can just load the html file in your browser</span>
<span class="sd">            ```py</span>
<span class="sd">            from IPython.display import IFrame</span>
<span class="sd">            IFrame(src=&quot;./cluster_studio.html&quot;, width=&quot;100%&quot;, height=1200)</span>
<span class="sd">            ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_waterfall_columns_not_computed</span><span class="p">()</span>

        <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_splink_cluster_studio_html</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">df_predict</span><span class="p">,</span>
            <span class="n">df_clustered</span><span class="p">,</span>
            <span class="n">out_path</span><span class="p">,</span>
            <span class="n">sampling_method</span><span class="o">=</span><span class="n">sampling_method</span><span class="p">,</span>
            <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
            <span class="n">cluster_ids</span><span class="o">=</span><span class="n">cluster_ids</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
            <span class="n">cluster_names</span><span class="o">=</span><span class="n">cluster_names</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">return_html_as_string</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">rendered</span>

    <span class="k">def</span> <span class="nf">save_model_to_json</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the configuration and parameters of the linkage model to a `.json` file.</span>

<span class="sd">        The model can later be loaded back in using `linker.load_model()`.</span>
<span class="sd">        The settings dict is also returned in case you want to save it a different way.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ```py</span>
<span class="sd">            linker.save_model_to_json(&quot;my_settings.json&quot;, overwrite=True)</span>
<span class="sd">            ```</span>
<span class="sd">        Args:</span>
<span class="sd">            out_path (str, optional): File path for json file. If None, don&#39;t save to</span>
<span class="sd">                file. Defaults to None.</span>
<span class="sd">            overwrite (bool, optional): Overwrite if already exists? Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict: The settings as a dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">as_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">out_path</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">out_path</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The path </span><span class="si">{</span><span class="n">out_path</span><span class="si">}</span><span class="s2"> already exists. Please provide a different &quot;</span>
                    <span class="s2">&quot;path or set overwrite=True&quot;</span>
                <span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model_dict</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model_dict</span>

    <span class="k">def</span> <span class="nf">save_settings_to_json</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function is deprecated. Use save_model_to_json() instead.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;This function is deprecated. Use save_model_to_json() instead.&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
            <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_model_to_json</span><span class="p">(</span><span class="n">out_path</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">estimate_probability_two_random_records_match</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">deterministic_matching_rules</span><span class="p">,</span> <span class="n">recall</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Estimate the model parameter `probability_two_random_records_match` using</span>
<span class="sd">        a direct estimation approach.</span>

<span class="sd">        See [here](https://github.com/moj-analytical-services/splink/issues/462)</span>
<span class="sd">        for discussion of methodology</span>

<span class="sd">        Args:</span>
<span class="sd">            deterministic_matching_rules (list): A list of deterministic matching</span>
<span class="sd">                rules that should be designed to admit very few (none if possible)</span>
<span class="sd">                false positives</span>
<span class="sd">            recall (float): A guess at the recall the deterministic matching rules</span>
<span class="sd">                will attain.  i.e. what proportion of true matches will be recovered</span>
<span class="sd">                by these deterministic rules</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">recall</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">recall</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Estimated recall must be greater than 0 &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;and no more than 1. Supplied value </span><span class="si">{</span><span class="n">recall</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="c1"># If user, by error, provides a single rule as a string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deterministic_matching_rules</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">deterministic_matching_rules</span> <span class="o">=</span> <span class="p">[</span><span class="n">deterministic_matching_rules</span><span class="p">]</span>

        <span class="n">records</span> <span class="o">=</span> <span class="n">cumulative_comparisons_generated_by_blocking_rules</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">deterministic_matching_rules</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">summary_record</span> <span class="o">=</span> <span class="n">records</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">num_observed_matches</span> <span class="o">=</span> <span class="n">summary_record</span><span class="p">[</span><span class="s2">&quot;cumulative_rows&quot;</span><span class="p">]</span>
        <span class="n">num_total_comparisons</span> <span class="o">=</span> <span class="n">summary_record</span><span class="p">[</span><span class="s2">&quot;cartesian&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">num_observed_matches</span> <span class="o">&gt;</span> <span class="n">num_total_comparisons</span> <span class="o">*</span> <span class="n">recall</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Deterministic matching rules led to more &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;observed matches than is consistent with supplied recall. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;With these rules, recall must be at least &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_observed_matches</span><span class="o">/</span><span class="n">num_total_comparisons</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">num_expected_matches</span> <span class="o">=</span> <span class="n">num_observed_matches</span> <span class="o">/</span> <span class="n">recall</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="n">num_expected_matches</span> <span class="o">/</span> <span class="n">num_total_comparisons</span>

        <span class="c1"># warn about boundary values, as these will usually be in error</span>
        <span class="k">if</span> <span class="n">num_observed_matches</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;WARNING: Deterministic matching rules led to no observed matches! &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;This means that no possible record pairs are matches, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;and no records are linked to one another.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;If this is truly the case then you do not need &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;to run the linkage model.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;However this is usually in error; &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;expected rules to have recall of </span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">recall</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2">%. &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;Consider revising rules as they may have an error.&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">prob</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;WARNING: Probability two random records match is estimated to be 1.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;This means that all possible record pairs are matches, &quot;</span>
                <span class="s2">&quot;and all records are linked to one another.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;If this is truly the case then you do not need &quot;</span>
                <span class="s2">&quot;to run the linkage model.</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;However, it is more likely that this estimate is faulty. &quot;</span>
                <span class="s2">&quot;Perhaps your deterministic matching rules include &quot;</span>
                <span class="s2">&quot;too many false positives?&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_probability_two_random_records_match</span> <span class="o">=</span> <span class="n">prob</span>

        <span class="n">reciprocal_prob</span> <span class="o">=</span> <span class="s2">&quot;Infinity&quot;</span> <span class="k">if</span> <span class="n">prob</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="mi">1</span><span class="o">/</span><span class="n">prob</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Probability two random records match is estimated to be  </span><span class="si">{</span><span class="n">prob</span><span class="si">:</span><span class="s2">.3g</span><span class="si">}</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;This means that amongst all possible pairwise record comparisons, one in &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">reciprocal_prob</span><span class="si">}</span><span class="s2"> are expected to match.  &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;With </span><span class="si">{</span><span class="n">num_total_comparisons</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2"> total&quot;</span>
            <span class="s2">&quot; possible comparisons, we expect a total of around &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">num_expected_matches</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> matching pairs&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">invalidate_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Invalidate the Splink cache.  Any previously-computed tables</span>
<span class="sd">        will be recomputed.</span>
<span class="sd">        This is useful, for example, if the input data tables have changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Before Splink executes a SQL command, it checks the cache to see</span>
        <span class="c1"># whether a table already exists with the name of the output table</span>

        <span class="c1"># This function has the effect of changing the names of the output tables</span>
        <span class="c1"># to include a different unique id</span>

        <span class="c1"># As a result, any previously cached tables will not be found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid</span> <span class="o">=</span> <span class="n">ascii_uid</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

        <span class="c1"># As a result, any previously cached tables will not be found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span><span class="o">.</span><span class="n">invalidate_cache</span><span class="p">()</span>

        <span class="c1"># Also drop any existing splink tables from the database</span>
        <span class="c1"># Note, this is not actually necessary, it&#39;s just good housekeeping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_delete_tables_created_by_splink_from_db</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">register_table_input_nodes_concat_with_tf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Register a pre-computed version of the input_nodes_concat_with_tf table that</span>
<span class="sd">        you want to re-use e.g. that you created in a previous run</span>

<span class="sd">        This method allowed you to register this table in the Splink cache</span>
<span class="sd">        so it will be used rather than Splink computing this table anew.</span>

<span class="sd">        Args:</span>
<span class="sd">            input_data: The data you wish to register. This can be either a dictionary,</span>
<span class="sd">                pandas dataframe, pyarrow table or a spark dataframe.</span>
<span class="sd">            overwrite (bool): Overwrite the table in the underlying database if it</span>
<span class="sd">                exists</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">table_name_physical</span> <span class="o">=</span> <span class="s2">&quot;__splink__df_concat_with_tf_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid</span>
        <span class="n">splink_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span>
            <span class="n">input_data</span><span class="p">,</span> <span class="n">table_name_physical</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_concat_with_tf&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">splink_dataframe</span>
        <span class="k">return</span> <span class="n">splink_dataframe</span>

    <span class="k">def</span> <span class="nf">register_table_predict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">table_name_physical</span> <span class="o">=</span> <span class="s2">&quot;__splink__df_predict_&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid</span>
        <span class="n">splink_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span>
            <span class="n">input_data</span><span class="p">,</span> <span class="n">table_name_physical</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span><span class="p">[</span><span class="s2">&quot;__splink__df_predict&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">splink_dataframe</span>
        <span class="k">return</span> <span class="n">splink_dataframe</span>

    <span class="k">def</span> <span class="nf">register_term_frequency_lookup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">col_name</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">input_col</span> <span class="o">=</span> <span class="n">InputColumn</span><span class="p">(</span><span class="n">col_name</span><span class="p">,</span> <span class="n">settings_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">)</span>
        <span class="n">table_name_templated</span> <span class="o">=</span> <span class="n">colname_to_tf_tablename</span><span class="p">(</span><span class="n">input_col</span><span class="p">)</span>
        <span class="n">table_name_physical</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">table_name_templated</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cache_uid</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">splink_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span>
            <span class="n">input_data</span><span class="p">,</span> <span class="n">table_name_physical</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_intermediate_table_cache</span><span class="p">[</span><span class="n">table_name_templated</span><span class="p">]</span> <span class="o">=</span> <span class="n">splink_dataframe</span>
        <span class="k">return</span> <span class="n">splink_dataframe</span>

    <span class="k">def</span> <span class="nf">register_labels_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_data</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">table_name_physical</span> <span class="o">=</span> <span class="s2">&quot;__splink__df_labels_&quot;</span> <span class="o">+</span> <span class="n">ascii_uid</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">splink_dataframe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span>
            <span class="n">input_data</span><span class="p">,</span> <span class="n">table_name_physical</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">splink_dataframe</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.cluster_studio_dashboard" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cluster_studio_dashboard</span><span class="p">(</span><span class="n">df_predict</span><span class="p">,</span> <span class="n">df_clustered</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">sampling_method</span><span class="o">=</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">sample_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">cluster_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cluster_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">return_html_as_string</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.cluster_studio_dashboard" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate an interactive html visualization of the predicted cluster and
save to <code>out_path</code>.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df_predict</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="splink.splink_dataframe.SplinkDataFrame" href="SplinkDataFrame.html#splink.splink_dataframe.SplinkDataFrame">SplinkDataFrame</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The outputs of <code>linker.predict()</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>df_clustered</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="splink.splink_dataframe.SplinkDataFrame" href="SplinkDataFrame.html#splink.splink_dataframe.SplinkDataFrame">SplinkDataFrame</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The outputs of
<code>linker.cluster_pairwise_predictions_at_threshold()</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>out_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path (including filename) to save the html file to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>sampling_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p><code>random</code> or <code>by_cluster_size</code>. Defaults to
<code>random</code>.</p>
            </div>
          </td>
          <td>
                <code>&#39;random&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>sample_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of clusters to show in the dahboard.
Defaults to 10.</p>
            </div>
          </td>
          <td>
                <code>10</code>
          </td>
        </tr>
        <tr>
          <td><code>cluster_ids</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The IDs of the clusters that will be displayed in the
dashboard.  If provided, ignore the <code>sampling_method</code> and <code>sample_size</code>
arguments. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>overwrite</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Overwrite the html file if it already exists?
Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>cluster_names</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If provided, the dashboard will display
these names in the selection box. Ony works in conjunction with
<code>cluster_ids</code>.  Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>return_html_as_string</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, return the html as a string</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <p><div class="highlight"><pre><span></span><code><span class="n">df_p</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">df_c</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">cluster_pairwise_predictions_at_threshold</span><span class="p">(</span><span class="n">df_p</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">cluster_studio_dashboard</span><span class="p">(</span>
    <span class="n">df_p</span><span class="p">,</span> <span class="n">df_c</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="s2">&quot;cluster_studio.html&quot;</span>
<span class="p">)</span>
</code></pre></div>
Optionally, in Jupyter, you can display the results inline
Otherwise you can just load the html file in your browser
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">IFrame</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;./cluster_studio.html&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1200</span><span class="p">)</span>
</code></pre></div></p>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2963</span>
<span class="normal">2964</span>
<span class="normal">2965</span>
<span class="normal">2966</span>
<span class="normal">2967</span>
<span class="normal">2968</span>
<span class="normal">2969</span>
<span class="normal">2970</span>
<span class="normal">2971</span>
<span class="normal">2972</span>
<span class="normal">2973</span>
<span class="normal">2974</span>
<span class="normal">2975</span>
<span class="normal">2976</span>
<span class="normal">2977</span>
<span class="normal">2978</span>
<span class="normal">2979</span>
<span class="normal">2980</span>
<span class="normal">2981</span>
<span class="normal">2982</span>
<span class="normal">2983</span>
<span class="normal">2984</span>
<span class="normal">2985</span>
<span class="normal">2986</span>
<span class="normal">2987</span>
<span class="normal">2988</span>
<span class="normal">2989</span>
<span class="normal">2990</span>
<span class="normal">2991</span>
<span class="normal">2992</span>
<span class="normal">2993</span>
<span class="normal">2994</span>
<span class="normal">2995</span>
<span class="normal">2996</span>
<span class="normal">2997</span>
<span class="normal">2998</span>
<span class="normal">2999</span>
<span class="normal">3000</span>
<span class="normal">3001</span>
<span class="normal">3002</span>
<span class="normal">3003</span>
<span class="normal">3004</span>
<span class="normal">3005</span>
<span class="normal">3006</span>
<span class="normal">3007</span>
<span class="normal">3008</span>
<span class="normal">3009</span>
<span class="normal">3010</span>
<span class="normal">3011</span>
<span class="normal">3012</span>
<span class="normal">3013</span>
<span class="normal">3014</span>
<span class="normal">3015</span>
<span class="normal">3016</span>
<span class="normal">3017</span>
<span class="normal">3018</span>
<span class="normal">3019</span>
<span class="normal">3020</span>
<span class="normal">3021</span>
<span class="normal">3022</span>
<span class="normal">3023</span>
<span class="normal">3024</span>
<span class="normal">3025</span>
<span class="normal">3026</span>
<span class="normal">3027</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cluster_studio_dashboard</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df_predict</span><span class="p">:</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
    <span class="n">df_clustered</span><span class="p">:</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">sampling_method</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">,</span>
    <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">cluster_ids</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cluster_names</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">return_html_as_string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate an interactive html visualization of the predicted cluster and</span>
<span class="sd">    save to `out_path`.</span>

<span class="sd">    Args:</span>
<span class="sd">        df_predict (SplinkDataFrame): The outputs of `linker.predict()`</span>
<span class="sd">        df_clustered (SplinkDataFrame): The outputs of</span>
<span class="sd">            `linker.cluster_pairwise_predictions_at_threshold()`</span>
<span class="sd">        out_path (str): The path (including filename) to save the html file to.</span>
<span class="sd">        sampling_method (str, optional): `random` or `by_cluster_size`. Defaults to</span>
<span class="sd">            `random`.</span>
<span class="sd">        sample_size (int, optional): Number of clusters to show in the dahboard.</span>
<span class="sd">            Defaults to 10.</span>
<span class="sd">        cluster_ids (list): The IDs of the clusters that will be displayed in the</span>
<span class="sd">            dashboard.  If provided, ignore the `sampling_method` and `sample_size`</span>
<span class="sd">            arguments. Defaults to None.</span>
<span class="sd">        overwrite (bool, optional): Overwrite the html file if it already exists?</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        cluster_names (list, optional): If provided, the dashboard will display</span>
<span class="sd">            these names in the selection box. Ony works in conjunction with</span>
<span class="sd">            `cluster_ids`.  Defaults to None.</span>
<span class="sd">        return_html_as_string: If True, return the html as a string</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```py</span>
<span class="sd">        df_p = linker.predict()</span>
<span class="sd">        df_c = linker.cluster_pairwise_predictions_at_threshold(df_p, 0.5)</span>
<span class="sd">        linker.cluster_studio_dashboard(</span>
<span class="sd">            df_p, df_c, [0, 4, 7], &quot;cluster_studio.html&quot;</span>
<span class="sd">        )</span>
<span class="sd">        ```</span>
<span class="sd">        Optionally, in Jupyter, you can display the results inline</span>
<span class="sd">        Otherwise you can just load the html file in your browser</span>
<span class="sd">        ```py</span>
<span class="sd">        from IPython.display import IFrame</span>
<span class="sd">        IFrame(src=&quot;./cluster_studio.html&quot;, width=&quot;100%&quot;, height=1200)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_waterfall_columns_not_computed</span><span class="p">()</span>

    <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_splink_cluster_studio_html</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">df_predict</span><span class="p">,</span>
        <span class="n">df_clustered</span><span class="p">,</span>
        <span class="n">out_path</span><span class="p">,</span>
        <span class="n">sampling_method</span><span class="o">=</span><span class="n">sampling_method</span><span class="p">,</span>
        <span class="n">sample_size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span>
        <span class="n">cluster_ids</span><span class="o">=</span><span class="n">cluster_ids</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">,</span>
        <span class="n">cluster_names</span><span class="o">=</span><span class="n">cluster_names</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">return_html_as_string</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rendered</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.comparison_viewer_dashboard" class="doc doc-heading">
<code class="highlight language-python"><span class="n">comparison_viewer_dashboard</span><span class="p">(</span><span class="n">df_predict</span><span class="p">,</span> <span class="n">out_path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">num_example_rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_html_as_string</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.comparison_viewer_dashboard" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate an interactive html visualization of the linker's predictions and
save to <code>out_path</code>.  For more information see
<a href="https://www.youtube.com/watch?v=DNvCMqjipis">this video</a></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df_predict</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="splink.splink_dataframe.SplinkDataFrame" href="SplinkDataFrame.html#splink.splink_dataframe.SplinkDataFrame">SplinkDataFrame</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The outputs of <code>linker.predict()</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>out_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path (including filename) to save the html file to.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>overwrite</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Overwrite the html file if it already exists?
Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>num_example_rows</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of example rows per comparison
vector. Defaults to 2.</p>
            </div>
          </td>
          <td>
                <code>2</code>
          </td>
        </tr>
        <tr>
          <td><code>return_html_as_string</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, return the html as a string</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="n">df_predictions</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">linker</span><span class="o">.</span><span class="n">comparison_viewer_dashboard</span><span class="p">(</span><span class="n">df_predictions</span><span class="p">,</span> <span class="s2">&quot;scv.html&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div>
<p>Optionally, in Jupyter, you can display the results inline
Otherwise you can just load the html file in your browser
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">IFrame</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;./scv.html&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1200</span><span class="p">)</span>
</code></pre></div></p>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2543</span>
<span class="normal">2544</span>
<span class="normal">2545</span>
<span class="normal">2546</span>
<span class="normal">2547</span>
<span class="normal">2548</span>
<span class="normal">2549</span>
<span class="normal">2550</span>
<span class="normal">2551</span>
<span class="normal">2552</span>
<span class="normal">2553</span>
<span class="normal">2554</span>
<span class="normal">2555</span>
<span class="normal">2556</span>
<span class="normal">2557</span>
<span class="normal">2558</span>
<span class="normal">2559</span>
<span class="normal">2560</span>
<span class="normal">2561</span>
<span class="normal">2562</span>
<span class="normal">2563</span>
<span class="normal">2564</span>
<span class="normal">2565</span>
<span class="normal">2566</span>
<span class="normal">2567</span>
<span class="normal">2568</span>
<span class="normal">2569</span>
<span class="normal">2570</span>
<span class="normal">2571</span>
<span class="normal">2572</span>
<span class="normal">2573</span>
<span class="normal">2574</span>
<span class="normal">2575</span>
<span class="normal">2576</span>
<span class="normal">2577</span>
<span class="normal">2578</span>
<span class="normal">2579</span>
<span class="normal">2580</span>
<span class="normal">2581</span>
<span class="normal">2582</span>
<span class="normal">2583</span>
<span class="normal">2584</span>
<span class="normal">2585</span>
<span class="normal">2586</span>
<span class="normal">2587</span>
<span class="normal">2588</span>
<span class="normal">2589</span>
<span class="normal">2590</span>
<span class="normal">2591</span>
<span class="normal">2592</span>
<span class="normal">2593</span>
<span class="normal">2594</span>
<span class="normal">2595</span>
<span class="normal">2596</span>
<span class="normal">2597</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">comparison_viewer_dashboard</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">df_predict</span><span class="p">:</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
    <span class="n">out_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">num_example_rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">return_html_as_string</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate an interactive html visualization of the linker&#39;s predictions and</span>
<span class="sd">    save to `out_path`.  For more information see</span>
<span class="sd">    [this video](https://www.youtube.com/watch?v=DNvCMqjipis)</span>


<span class="sd">    Args:</span>
<span class="sd">        df_predict (SplinkDataFrame): The outputs of `linker.predict()`</span>
<span class="sd">        out_path (str): The path (including filename) to save the html file to.</span>
<span class="sd">        overwrite (bool, optional): Overwrite the html file if it already exists?</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        num_example_rows (int, optional): Number of example rows per comparison</span>
<span class="sd">            vector. Defaults to 2.</span>
<span class="sd">        return_html_as_string: If True, return the html as a string</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```py</span>
<span class="sd">        df_predictions = linker.predict()</span>
<span class="sd">        linker.comparison_viewer_dashboard(df_predictions, &quot;scv.html&quot;, True, 2)</span>
<span class="sd">        ```</span>

<span class="sd">        Optionally, in Jupyter, you can display the results inline</span>
<span class="sd">        Otherwise you can just load the html file in your browser</span>
<span class="sd">        ```py</span>
<span class="sd">        from IPython.display import IFrame</span>
<span class="sd">        IFrame(src=&quot;./scv.html&quot;, width=&quot;100%&quot;, height=1200)</span>
<span class="sd">        ```</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_waterfall_columns_not_computed</span><span class="p">()</span>

    <span class="n">sql</span> <span class="o">=</span> <span class="n">comparison_vector_distribution_sql</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="s2">&quot;__splink__df_comparison_vector_distribution&quot;</span><span class="p">)</span>

    <span class="n">sqls</span> <span class="o">=</span> <span class="n">comparison_viewer_table_sqls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_example_rows</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sql</span> <span class="ow">in</span> <span class="n">sqls</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enqueue_sql</span><span class="p">(</span><span class="n">sql</span><span class="p">[</span><span class="s2">&quot;sql&quot;</span><span class="p">],</span> <span class="n">sql</span><span class="p">[</span><span class="s2">&quot;output_table_name&quot;</span><span class="p">])</span>

    <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_execute_sql_pipeline</span><span class="p">([</span><span class="n">df_predict</span><span class="p">])</span>

    <span class="n">rendered</span> <span class="o">=</span> <span class="n">render_splink_comparison_viewer_html</span><span class="p">(</span>
        <span class="n">df</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">(),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_as_completed_dict</span><span class="p">(),</span>
        <span class="n">out_path</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">return_html_as_string</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">rendered</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.m_u_parameters_chart" class="doc doc-heading">
<code class="highlight language-python"><span class="n">m_u_parameters_chart</span><span class="p">()</span></code>

<a href="#splink.linker.Linker.m_u_parameters_chart" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Display a chart of the m and u parameters of the linkage model</p>

<p><strong>Examples:</strong></p>
    <p><div class="highlight"><pre><span></span><code><span class="n">linker</span><span class="o">.</span><span class="n">m_u_parameters_chart</span><span class="p">()</span>
</code></pre></div>
To view offline (if you don't have an internet connection):
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splink.charts</span> <span class="kn">import</span> <span class="n">save_offline_chart</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">match_weights_chart</span><span class="p">()</span>
<span class="n">save_offline_chart</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="s2">&quot;test_chart.html&quot;</span><span class="p">)</span>
</code></pre></div>
View resultant html file in Jupyter (or just load it in your browser)
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">IFrame</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;./test_chart.html&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</code></pre></div></p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>VegaLite</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.
The vegalite spec is available as a dictionary using the <code>spec</code>
attribute.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2936</span>
<span class="normal">2937</span>
<span class="normal">2938</span>
<span class="normal">2939</span>
<span class="normal">2940</span>
<span class="normal">2941</span>
<span class="normal">2942</span>
<span class="normal">2943</span>
<span class="normal">2944</span>
<span class="normal">2945</span>
<span class="normal">2946</span>
<span class="normal">2947</span>
<span class="normal">2948</span>
<span class="normal">2949</span>
<span class="normal">2950</span>
<span class="normal">2951</span>
<span class="normal">2952</span>
<span class="normal">2953</span>
<span class="normal">2954</span>
<span class="normal">2955</span>
<span class="normal">2956</span>
<span class="normal">2957</span>
<span class="normal">2958</span>
<span class="normal">2959</span>
<span class="normal">2960</span>
<span class="normal">2961</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">m_u_parameters_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display a chart of the m and u parameters of the linkage model</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```py</span>
<span class="sd">        linker.m_u_parameters_chart()</span>
<span class="sd">        ```</span>
<span class="sd">        To view offline (if you don&#39;t have an internet connection):</span>
<span class="sd">        ```py</span>
<span class="sd">        from splink.charts import save_offline_chart</span>
<span class="sd">        c = linker.match_weights_chart()</span>
<span class="sd">        save_offline_chart(c.spec, &quot;test_chart.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        View resultant html file in Jupyter (or just load it in your browser)</span>
<span class="sd">        ```py</span>
<span class="sd">        from IPython.display import IFrame</span>
<span class="sd">        IFrame(src=&quot;./test_chart.html&quot;, width=1000, height=500)</span>
<span class="sd">        ```</span>

<span class="sd">    Returns:</span>
<span class="sd">        VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">            The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">            attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">m_u_parameters_chart</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.match_weights_chart" class="doc doc-heading">
<code class="highlight language-python"><span class="n">match_weights_chart</span><span class="p">()</span></code>

<a href="#splink.linker.Linker.match_weights_chart" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Display a chart of the (partial) match weights of the linkage model</p>

<p><strong>Examples:</strong></p>
    <p><div class="highlight"><pre><span></span><code><span class="n">linker</span><span class="o">.</span><span class="n">match_weights_chart</span><span class="p">()</span>
</code></pre></div>
To view offline (if you don't have an internet connection):
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splink.charts</span> <span class="kn">import</span> <span class="n">save_offline_chart</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">match_weights_chart</span><span class="p">()</span>
<span class="n">save_offline_chart</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">spec</span><span class="p">,</span> <span class="s2">&quot;test_chart.html&quot;</span><span class="p">)</span>
</code></pre></div>
View resultant html file in Jupyter (or just load it in your browser)
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">IFrame</span><span class="p">(</span><span class="n">src</span><span class="o">=</span><span class="s2">&quot;./test_chart.html&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</code></pre></div></p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>VegaLite</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.
The vegalite spec is available as a dictionary using the <code>spec</code>
attribute.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2856</span>
<span class="normal">2857</span>
<span class="normal">2858</span>
<span class="normal">2859</span>
<span class="normal">2860</span>
<span class="normal">2861</span>
<span class="normal">2862</span>
<span class="normal">2863</span>
<span class="normal">2864</span>
<span class="normal">2865</span>
<span class="normal">2866</span>
<span class="normal">2867</span>
<span class="normal">2868</span>
<span class="normal">2869</span>
<span class="normal">2870</span>
<span class="normal">2871</span>
<span class="normal">2872</span>
<span class="normal">2873</span>
<span class="normal">2874</span>
<span class="normal">2875</span>
<span class="normal">2876</span>
<span class="normal">2877</span>
<span class="normal">2878</span>
<span class="normal">2879</span>
<span class="normal">2880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">match_weights_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Display a chart of the (partial) match weights of the linkage model</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```py</span>
<span class="sd">        linker.match_weights_chart()</span>
<span class="sd">        ```</span>
<span class="sd">        To view offline (if you don&#39;t have an internet connection):</span>
<span class="sd">        ```py</span>
<span class="sd">        from splink.charts import save_offline_chart</span>
<span class="sd">        c = linker.match_weights_chart()</span>
<span class="sd">        save_offline_chart(c.spec, &quot;test_chart.html&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">        View resultant html file in Jupyter (or just load it in your browser)</span>
<span class="sd">        ```py</span>
<span class="sd">        from IPython.display import IFrame</span>
<span class="sd">        IFrame(src=&quot;./test_chart.html&quot;, width=1000, height=500)</span>
<span class="sd">        ```</span>

<span class="sd">    Returns:</span>
<span class="sd">        VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">            The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">            attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">match_weights_chart</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.parameter_estimate_comparisons_chart" class="doc doc-heading">
<code class="highlight language-python"><span class="n">parameter_estimate_comparisons_chart</span><span class="p">(</span><span class="n">include_m</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_u</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.parameter_estimate_comparisons_chart" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Show a chart that shows how parameter estimates have differed across
the different estimation methods you have used.</p>
<p>For example, if you have run two EM estimation sessions, blocking on
different variables, and both result in parameter estimates for
first_name, this chart will enable easy comparison of the different
estimates</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>include_m</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Show different estimates of m values. Defaults
to True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>include_u</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Show different estimates of u values. Defaults
to True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2599</span>
<span class="normal">2600</span>
<span class="normal">2601</span>
<span class="normal">2602</span>
<span class="normal">2603</span>
<span class="normal">2604</span>
<span class="normal">2605</span>
<span class="normal">2606</span>
<span class="normal">2607</span>
<span class="normal">2608</span>
<span class="normal">2609</span>
<span class="normal">2610</span>
<span class="normal">2611</span>
<span class="normal">2612</span>
<span class="normal">2613</span>
<span class="normal">2614</span>
<span class="normal">2615</span>
<span class="normal">2616</span>
<span class="normal">2617</span>
<span class="normal">2618</span>
<span class="normal">2619</span>
<span class="normal">2620</span>
<span class="normal">2621</span>
<span class="normal">2622</span>
<span class="normal">2623</span>
<span class="normal">2624</span>
<span class="normal">2625</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parameter_estimate_comparisons_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_m</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_u</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Show a chart that shows how parameter estimates have differed across</span>
<span class="sd">    the different estimation methods you have used.</span>

<span class="sd">    For example, if you have run two EM estimation sessions, blocking on</span>
<span class="sd">    different variables, and both result in parameter estimates for</span>
<span class="sd">    first_name, this chart will enable easy comparison of the different</span>
<span class="sd">    estimates</span>

<span class="sd">    Args:</span>
<span class="sd">        include_m (bool, optional): Show different estimates of m values. Defaults</span>
<span class="sd">            to True.</span>
<span class="sd">        include_u (bool, optional): Show different estimates of u values. Defaults</span>
<span class="sd">            to True.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="o">.</span><span class="n">_parameter_estimates_as_records</span>

    <span class="n">to_retain</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">include_m</span><span class="p">:</span>
        <span class="n">to_retain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">include_u</span><span class="p">:</span>
        <span class="n">to_retain</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">)</span>

    <span class="n">records</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;m_or_u&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">to_retain</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">parameter_estimate_comparisons</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.precision_recall_chart_from_labels_column" class="doc doc-heading">
<code class="highlight language-python"><span class="n">precision_recall_chart_from_labels_column</span><span class="p">(</span><span class="n">labels_column_name</span><span class="p">,</span> <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.precision_recall_chart_from_labels_column" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate a precision-recall chart from ground truth data, whereby the ground
truth is in a column in the input dataset called <code>labels_column_name</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>labels_column_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Column name containing labels in the input table</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold_actual</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Where the <code>clerical_match_score</code>
provided by the user is a probability rather than binary, this value
is used as the threshold to classify <code>clerical_match_score</code>s as binary
matches or non matches. Defaults to 0.5.</p>
            </div>
          </td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>match_weight_round_to_nearest</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When provided, thresholds
are rounded.  When large numbers of labels are provided, this is
sometimes necessary to reduce the size of the ROC table, and therefore
the number of points plotted on the ROC chart. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="n">linker</span><span class="o">.</span><span class="n">precision_recall_chart_from_labels_column</span><span class="p">(</span><span class="s2">&quot;ground_truth&quot;</span><span class="p">)</span>
</code></pre></div>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>VegaLite</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.
The vegalite spec is available as a dictionary using the <code>spec</code>
attribute.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2377</span>
<span class="normal">2378</span>
<span class="normal">2379</span>
<span class="normal">2380</span>
<span class="normal">2381</span>
<span class="normal">2382</span>
<span class="normal">2383</span>
<span class="normal">2384</span>
<span class="normal">2385</span>
<span class="normal">2386</span>
<span class="normal">2387</span>
<span class="normal">2388</span>
<span class="normal">2389</span>
<span class="normal">2390</span>
<span class="normal">2391</span>
<span class="normal">2392</span>
<span class="normal">2393</span>
<span class="normal">2394</span>
<span class="normal">2395</span>
<span class="normal">2396</span>
<span class="normal">2397</span>
<span class="normal">2398</span>
<span class="normal">2399</span>
<span class="normal">2400</span>
<span class="normal">2401</span>
<span class="normal">2402</span>
<span class="normal">2403</span>
<span class="normal">2404</span>
<span class="normal">2405</span>
<span class="normal">2406</span>
<span class="normal">2407</span>
<span class="normal">2408</span>
<span class="normal">2409</span>
<span class="normal">2410</span>
<span class="normal">2411</span>
<span class="normal">2412</span>
<span class="normal">2413</span>
<span class="normal">2414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">precision_recall_chart_from_labels_column</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">labels_column_name</span><span class="p">,</span>
    <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a precision-recall chart from ground truth data, whereby the ground</span>
<span class="sd">    truth is in a column in the input dataset called `labels_column_name`</span>

<span class="sd">    Args:</span>
<span class="sd">        labels_column_name (str): Column name containing labels in the input table</span>
<span class="sd">        threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">            provided by the user is a probability rather than binary, this value</span>
<span class="sd">            is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">            matches or non matches. Defaults to 0.5.</span>
<span class="sd">        match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">            are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">            sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">            the number of points plotted on the ROC chart. Defaults to None.</span>
<span class="sd">    Examples:</span>
<span class="sd">        ```py</span>
<span class="sd">        linker.precision_recall_chart_from_labels_column(&quot;ground_truth&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">    Returns:</span>
<span class="sd">        VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">            The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">            attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df_truth_space</span> <span class="o">=</span> <span class="n">truth_space_table_from_labels_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_column_name</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">recs</span> <span class="o">=</span> <span class="n">df_truth_space</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">precision_recall_chart</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.precision_recall_chart_from_labels_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">precision_recall_chart_from_labels_table</span><span class="p">(</span><span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span> <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.precision_recall_chart_from_labels_table" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate a precision-recall chart from labelled (ground truth) data.</p>
<p>The table of labels should be in the following format, and should be registered
as a table with your database:</p>
<table>
<thead>
<tr>
<th>source_dataset_l</th>
<th>unique_id_l</th>
<th>source_dataset_r</th>
<th>unique_id_r</th>
<th>clerical_match_score</th>
</tr>
</thead>
<tbody>
<tr>
<td>df_1</td>
<td>1</td>
<td>df_2</td>
<td>2</td>
<td>0.99</td>
</tr>
<tr>
<td>df_1</td>
<td>1</td>
<td>df_2</td>
<td>3</td>
<td>0.2</td>
</tr>
</tbody>
</table>
<p>Note that <code>source_dataset</code> and <code>unique_id</code> should correspond to the values
specified in the settings dict, and the <code>input_table_aliases</code> passed to the
<code>linker</code> object.</p>
<p>For <code>dedupe_only</code> links, the <code>source_dataset</code> columns can be ommitted.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>labels_splinkdataframe_or_table_name</code></td>
          <td>
                <code>str | <a class="autorefs autorefs-internal" title="splink.splink_dataframe.SplinkDataFrame" href="SplinkDataFrame.html#splink.splink_dataframe.SplinkDataFrame">SplinkDataFrame</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of table
containing labels in the database</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold_actual</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Where the <code>clerical_match_score</code>
provided by the user is a probability rather than binary, this value
is used as the threshold to classify <code>clerical_match_score</code>s as binary
matches or non matches. Defaults to 0.5.</p>
            </div>
          </td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>match_weight_round_to_nearest</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When provided, thresholds
are rounded.  When large numbers of labels are provided, this is
sometimes necessary to reduce the size of the ROC table, and therefore
the number of points plotted on the ROC chart. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="splink.linker.Linker.precision_recall_chart_from_labels_table--__tabbed_1_1" name="splink.linker.Linker.precision_recall_chart_from_labels_table--__tabbed_1" type="radio" /><input id="splink.linker.Linker.precision_recall_chart_from_labels_table--__tabbed_1_2" name="splink.linker.Linker.precision_recall_chart_from_labels_table--__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="splink.linker.Linker.precision_recall_chart_from_labels_table--__tabbed_1_1">DuckDB</label><label for="splink.linker.Linker.precision_recall_chart_from_labels_table--__tabbed_1_2">Spark</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;my_labels.csv&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">precision_recall_chart_from_labels_table</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">labels</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;my_labels.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">labels</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">precision_recall_chart_from_labels_table</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>VegaLite</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.
The vegalite spec is available as a dictionary using the <code>spec</code>
attribute.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span>
<span class="normal">2227</span>
<span class="normal">2228</span>
<span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span>
<span class="normal">2237</span>
<span class="normal">2238</span>
<span class="normal">2239</span>
<span class="normal">2240</span>
<span class="normal">2241</span>
<span class="normal">2242</span>
<span class="normal">2243</span>
<span class="normal">2244</span>
<span class="normal">2245</span>
<span class="normal">2246</span>
<span class="normal">2247</span>
<span class="normal">2248</span>
<span class="normal">2249</span>
<span class="normal">2250</span>
<span class="normal">2251</span>
<span class="normal">2252</span>
<span class="normal">2253</span>
<span class="normal">2254</span>
<span class="normal">2255</span>
<span class="normal">2256</span>
<span class="normal">2257</span>
<span class="normal">2258</span>
<span class="normal">2259</span>
<span class="normal">2260</span>
<span class="normal">2261</span>
<span class="normal">2262</span>
<span class="normal">2263</span>
<span class="normal">2264</span>
<span class="normal">2265</span>
<span class="normal">2266</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">precision_recall_chart_from_labels_table</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span>
    <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a precision-recall chart from labelled (ground truth) data.</span>

<span class="sd">    The table of labels should be in the following format, and should be registered</span>
<span class="sd">    as a table with your database:</span>

<span class="sd">    |source_dataset_l|unique_id_l|source_dataset_r|unique_id_r|clerical_match_score|</span>
<span class="sd">    |----------------|-----------|----------------|-----------|--------------------|</span>
<span class="sd">    |df_1            |1          |df_2            |2          |0.99                |</span>
<span class="sd">    |df_1            |1          |df_2            |3          |0.2                 |</span>

<span class="sd">    Note that `source_dataset` and `unique_id` should correspond to the values</span>
<span class="sd">    specified in the settings dict, and the `input_table_aliases` passed to the</span>
<span class="sd">    `linker` object.</span>

<span class="sd">    For `dedupe_only` links, the `source_dataset` columns can be ommitted.</span>

<span class="sd">    Args:</span>
<span class="sd">        labels_splinkdataframe_or_table_name (str | SplinkDataFrame): Name of table</span>
<span class="sd">            containing labels in the database</span>
<span class="sd">        threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">            provided by the user is a probability rather than binary, this value</span>
<span class="sd">            is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">            matches or non matches. Defaults to 0.5.</span>
<span class="sd">        match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">            are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">            sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">            the number of points plotted on the ROC chart. Defaults to None.</span>
<span class="sd">    Examples:</span>
<span class="sd">        === &quot;DuckDB&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            labels = pd.read_csv(&quot;my_labels.csv&quot;)</span>
<span class="sd">            linker.register_table(labels, &quot;labels&quot;)</span>
<span class="sd">            linker.precision_recall_chart_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        === &quot;Spark&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            labels = spark.read.csv(&quot;my_labels.csv&quot;, header=True)</span>
<span class="sd">            labels.createDataFrame(&quot;labels&quot;)</span>
<span class="sd">            linker.precision_recall_chart_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">    Returns:</span>
<span class="sd">        VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">            The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">            attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
        <span class="n">labels_splinkdataframe_or_table_name</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_accuracy_columns_not_computed</span><span class="p">()</span>
    <span class="n">df_truth_space</span> <span class="o">=</span> <span class="n">truth_space_table_from_labels_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_tablename</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">recs</span> <span class="o">=</span> <span class="n">df_truth_space</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">precision_recall_chart</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.prediction_errors_from_labels_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">prediction_errors_from_labels_table</span><span class="p">(</span><span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span> <span class="n">include_false_positives</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">include_false_negatives</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.prediction_errors_from_labels_table" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate a dataframe containing false positives and false negatives
based on the comparison between the clerical_match_score in the labels
table compared with the splink predicted match probability</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>labels_splinkdataframe_or_table_name</code></td>
          <td>
                <code>str | <a class="autorefs autorefs-internal" title="splink.splink_dataframe.SplinkDataFrame" href="SplinkDataFrame.html#splink.splink_dataframe.SplinkDataFrame">SplinkDataFrame</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of table
containing labels in the database</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>include_false_positives</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Defaults to True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>include_false_negatives</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Defaults to True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Threshold above which a score is considered
to be a match. Defaults to 0.5.</p>
            </div>
          </td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>SplinkDataFrame</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Table containing false positives and negatives</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2268</span>
<span class="normal">2269</span>
<span class="normal">2270</span>
<span class="normal">2271</span>
<span class="normal">2272</span>
<span class="normal">2273</span>
<span class="normal">2274</span>
<span class="normal">2275</span>
<span class="normal">2276</span>
<span class="normal">2277</span>
<span class="normal">2278</span>
<span class="normal">2279</span>
<span class="normal">2280</span>
<span class="normal">2281</span>
<span class="normal">2282</span>
<span class="normal">2283</span>
<span class="normal">2284</span>
<span class="normal">2285</span>
<span class="normal">2286</span>
<span class="normal">2287</span>
<span class="normal">2288</span>
<span class="normal">2289</span>
<span class="normal">2290</span>
<span class="normal">2291</span>
<span class="normal">2292</span>
<span class="normal">2293</span>
<span class="normal">2294</span>
<span class="normal">2295</span>
<span class="normal">2296</span>
<span class="normal">2297</span>
<span class="normal">2298</span>
<span class="normal">2299</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prediction_errors_from_labels_table</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span>
    <span class="n">include_false_positives</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">include_false_negatives</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a dataframe containing false positives and false negatives</span>
<span class="sd">    based on the comparison between the clerical_match_score in the labels</span>
<span class="sd">    table compared with the splink predicted match probability</span>

<span class="sd">    Args:</span>
<span class="sd">        labels_splinkdataframe_or_table_name (str | SplinkDataFrame): Name of table</span>
<span class="sd">            containing labels in the database</span>
<span class="sd">        include_false_positives (bool, optional): Defaults to True.</span>
<span class="sd">        include_false_negatives (bool, optional): Defaults to True.</span>
<span class="sd">        threshold (float, optional): Threshold above which a score is considered</span>
<span class="sd">            to be a match. Defaults to 0.5.</span>

<span class="sd">    Returns:</span>
<span class="sd">        SplinkDataFrame:  Table containing false positives and negatives</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
        <span class="n">labels_splinkdataframe_or_table_name</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">prediction_errors_from_labels_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_tablename</span><span class="p">,</span>
        <span class="n">include_false_positives</span><span class="p">,</span>
        <span class="n">include_false_negatives</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.roc_chart_from_labels_column" class="doc doc-heading">
<code class="highlight language-python"><span class="n">roc_chart_from_labels_column</span><span class="p">(</span><span class="n">labels_column_name</span><span class="p">,</span> <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.roc_chart_from_labels_column" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate a ROC chart from ground truth data, whereby the ground truth
is in a column in the input dataset called <code>labels_column_name</code></p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>labels_column_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Column name containing labels in the input table</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold_actual</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Where the <code>clerical_match_score</code>
provided by the user is a probability rather than binary, this value
is used as the threshold to classify <code>clerical_match_score</code>s as binary
matches or non matches. Defaults to 0.5.</p>
            </div>
          </td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>match_weight_round_to_nearest</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When provided, thresholds
are rounded.  When large numbers of labels are provided, this is
sometimes necessary to reduce the size of the ROC table, and therefore
the number of points plotted on the ROC chart. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="n">linker</span><span class="o">.</span><span class="n">roc_chart_from_labels_column</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
</code></pre></div>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>VegaLite</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.
The vegalite spec is available as a dictionary using the <code>spec</code>
attribute.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2337</span>
<span class="normal">2338</span>
<span class="normal">2339</span>
<span class="normal">2340</span>
<span class="normal">2341</span>
<span class="normal">2342</span>
<span class="normal">2343</span>
<span class="normal">2344</span>
<span class="normal">2345</span>
<span class="normal">2346</span>
<span class="normal">2347</span>
<span class="normal">2348</span>
<span class="normal">2349</span>
<span class="normal">2350</span>
<span class="normal">2351</span>
<span class="normal">2352</span>
<span class="normal">2353</span>
<span class="normal">2354</span>
<span class="normal">2355</span>
<span class="normal">2356</span>
<span class="normal">2357</span>
<span class="normal">2358</span>
<span class="normal">2359</span>
<span class="normal">2360</span>
<span class="normal">2361</span>
<span class="normal">2362</span>
<span class="normal">2363</span>
<span class="normal">2364</span>
<span class="normal">2365</span>
<span class="normal">2366</span>
<span class="normal">2367</span>
<span class="normal">2368</span>
<span class="normal">2369</span>
<span class="normal">2370</span>
<span class="normal">2371</span>
<span class="normal">2372</span>
<span class="normal">2373</span>
<span class="normal">2374</span>
<span class="normal">2375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">roc_chart_from_labels_column</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">labels_column_name</span><span class="p">,</span>
    <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a ROC chart from ground truth data, whereby the ground truth</span>
<span class="sd">    is in a column in the input dataset called `labels_column_name`</span>

<span class="sd">    Args:</span>
<span class="sd">        labels_column_name (str): Column name containing labels in the input table</span>
<span class="sd">        threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">            provided by the user is a probability rather than binary, this value</span>
<span class="sd">            is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">            matches or non matches. Defaults to 0.5.</span>
<span class="sd">        match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">            are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">            sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">            the number of points plotted on the ROC chart. Defaults to None.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```py</span>
<span class="sd">        linker.roc_chart_from_labels_column(&quot;labels&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">    Returns:</span>
<span class="sd">        VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">            The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">            attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df_truth_space</span> <span class="o">=</span> <span class="n">truth_space_table_from_labels_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_column_name</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">recs</span> <span class="o">=</span> <span class="n">df_truth_space</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">roc_chart</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.roc_chart_from_labels_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">roc_chart_from_labels_table</span><span class="p">(</span><span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span> <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.roc_chart_from_labels_table" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate a ROC chart from labelled (ground truth) data.</p>
<p>The table of labels should be in the following format, and should be registered
with your database:</p>
<table>
<thead>
<tr>
<th>source_dataset_l</th>
<th>unique_id_l</th>
<th>source_dataset_r</th>
<th>unique_id_r</th>
<th>clerical_match_score</th>
</tr>
</thead>
<tbody>
<tr>
<td>df_1</td>
<td>1</td>
<td>df_2</td>
<td>2</td>
<td>0.99</td>
</tr>
<tr>
<td>df_1</td>
<td>1</td>
<td>df_2</td>
<td>3</td>
<td>0.2</td>
</tr>
</tbody>
</table>
<p>Note that <code>source_dataset</code> and <code>unique_id</code> should correspond to the values
specified in the settings dict, and the <code>input_table_aliases</code> passed to the
<code>linker</code> object.</p>
<p>For <code>dedupe_only</code> links, the <code>source_dataset</code> columns can be ommitted.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>labels_splinkdataframe_or_table_name</code></td>
          <td>
                <code>str | <a class="autorefs autorefs-internal" title="splink.splink_dataframe.SplinkDataFrame" href="SplinkDataFrame.html#splink.splink_dataframe.SplinkDataFrame">SplinkDataFrame</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of table
containing labels in the database</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold_actual</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Where the <code>clerical_match_score</code>
provided by the user is a probability rather than binary, this value
is used as the threshold to classify <code>clerical_match_score</code>s as binary
matches or non matches. Defaults to 0.5.</p>
            </div>
          </td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>match_weight_round_to_nearest</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When provided, thresholds
are rounded.  When large numbers of labels are provided, this is
sometimes necessary to reduce the size of the ROC table, and therefore
the number of points plotted on the ROC chart. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="splink.linker.Linker.roc_chart_from_labels_table--__tabbed_1_1" name="splink.linker.Linker.roc_chart_from_labels_table--__tabbed_1" type="radio" /><input id="splink.linker.Linker.roc_chart_from_labels_table--__tabbed_1_2" name="splink.linker.Linker.roc_chart_from_labels_table--__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="splink.linker.Linker.roc_chart_from_labels_table--__tabbed_1_1">DuckDB</label><label for="splink.linker.Linker.roc_chart_from_labels_table--__tabbed_1_2">Spark</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;my_labels.csv&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">roc_chart_from_labels_table</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">labels</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;my_labels.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">labels</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">roc_chart_from_labels_table</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>VegaLite</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.
The vegalite spec is available as a dictionary using the <code>spec</code>
attribute.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span>
<span class="normal">2183</span>
<span class="normal">2184</span>
<span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span>
<span class="normal">2198</span>
<span class="normal">2199</span>
<span class="normal">2200</span>
<span class="normal">2201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">roc_chart_from_labels_table</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">SplinkDataFrame</span><span class="p">,</span>
    <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a ROC chart from labelled (ground truth) data.</span>

<span class="sd">    The table of labels should be in the following format, and should be registered</span>
<span class="sd">    with your database:</span>

<span class="sd">    |source_dataset_l|unique_id_l|source_dataset_r|unique_id_r|clerical_match_score|</span>
<span class="sd">    |----------------|-----------|----------------|-----------|--------------------|</span>
<span class="sd">    |df_1            |1          |df_2            |2          |0.99                |</span>
<span class="sd">    |df_1            |1          |df_2            |3          |0.2                 |</span>

<span class="sd">    Note that `source_dataset` and `unique_id` should correspond to the values</span>
<span class="sd">    specified in the settings dict, and the `input_table_aliases` passed to the</span>
<span class="sd">    `linker` object.</span>

<span class="sd">    For `dedupe_only` links, the `source_dataset` columns can be ommitted.</span>

<span class="sd">    Args:</span>
<span class="sd">        labels_splinkdataframe_or_table_name (str | SplinkDataFrame): Name of table</span>
<span class="sd">            containing labels in the database</span>
<span class="sd">        threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">            provided by the user is a probability rather than binary, this value</span>
<span class="sd">            is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">            matches or non matches. Defaults to 0.5.</span>
<span class="sd">        match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">            are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">            sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">            the number of points plotted on the ROC chart. Defaults to None.</span>

<span class="sd">    Examples:</span>
<span class="sd">        === &quot;DuckDB&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            labels = pd.read_csv(&quot;my_labels.csv&quot;)</span>
<span class="sd">            linker.register_table(labels, &quot;labels&quot;)</span>
<span class="sd">            linker.roc_chart_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        === &quot;Spark&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            labels = spark.read.csv(&quot;my_labels.csv&quot;, header=True)</span>
<span class="sd">            labels.createDataFrame(&quot;labels&quot;)</span>
<span class="sd">            linker.roc_chart_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">            ```</span>

<span class="sd">    Returns:</span>
<span class="sd">        VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">            The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">            attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
        <span class="n">labels_splinkdataframe_or_table_name</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_accuracy_columns_not_computed</span><span class="p">()</span>
    <span class="n">df_truth_space</span> <span class="o">=</span> <span class="n">truth_space_table_from_labels_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_tablename</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">recs</span> <span class="o">=</span> <span class="n">df_truth_space</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">roc_chart</span><span class="p">(</span><span class="n">recs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.truth_space_table_from_labels_column" class="doc doc-heading">
<code class="highlight language-python"><span class="n">truth_space_table_from_labels_column</span><span class="p">(</span><span class="n">labels_column_name</span><span class="p">,</span> <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.truth_space_table_from_labels_column" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate truth statistics (false positive etc.) for each threshold value of
match_probability, suitable for plotting a ROC chart.</p>
<p>Your labels_column_name should include the ground truth cluster (unique
identifier) that groups entities which are the same</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>labels_tablename</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of table containing labels in the database</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold_actual</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Where the <code>clerical_match_score</code>
provided by the user is a probability rather than binary, this value
is used as the threshold to classify <code>clerical_match_score</code>s as binary
matches or non matches. Defaults to 0.5.</p>
            </div>
          </td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>match_weight_round_to_nearest</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When provided, thresholds
are rounded.  When large numbers of labels are provided, this is
sometimes necessary to reduce the size of the ROC table, and therefore
the number of points plotted on the ROC chart. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="n">linker</span><span class="o">.</span><span class="n">truth_space_table_from_labels_column</span><span class="p">(</span><span class="s2">&quot;cluster&quot;</span><span class="p">)</span>
</code></pre></div>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>SplinkDataFrame</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Table of truth statistics</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2301</span>
<span class="normal">2302</span>
<span class="normal">2303</span>
<span class="normal">2304</span>
<span class="normal">2305</span>
<span class="normal">2306</span>
<span class="normal">2307</span>
<span class="normal">2308</span>
<span class="normal">2309</span>
<span class="normal">2310</span>
<span class="normal">2311</span>
<span class="normal">2312</span>
<span class="normal">2313</span>
<span class="normal">2314</span>
<span class="normal">2315</span>
<span class="normal">2316</span>
<span class="normal">2317</span>
<span class="normal">2318</span>
<span class="normal">2319</span>
<span class="normal">2320</span>
<span class="normal">2321</span>
<span class="normal">2322</span>
<span class="normal">2323</span>
<span class="normal">2324</span>
<span class="normal">2325</span>
<span class="normal">2326</span>
<span class="normal">2327</span>
<span class="normal">2328</span>
<span class="normal">2329</span>
<span class="normal">2330</span>
<span class="normal">2331</span>
<span class="normal">2332</span>
<span class="normal">2333</span>
<span class="normal">2334</span>
<span class="normal">2335</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">truth_space_table_from_labels_column</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">labels_column_name</span><span class="p">,</span>
    <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate truth statistics (false positive etc.) for each threshold value of</span>
<span class="sd">    match_probability, suitable for plotting a ROC chart.</span>

<span class="sd">    Your labels_column_name should include the ground truth cluster (unique</span>
<span class="sd">    identifier) that groups entities which are the same</span>

<span class="sd">    Args:</span>
<span class="sd">        labels_tablename (str): Name of table containing labels in the database</span>
<span class="sd">        threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">            provided by the user is a probability rather than binary, this value</span>
<span class="sd">            is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">            matches or non matches. Defaults to 0.5.</span>
<span class="sd">        match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">            are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">            sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">            the number of points plotted on the ROC chart. Defaults to None.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```py</span>
<span class="sd">        linker.truth_space_table_from_labels_column(&quot;cluster&quot;)</span>
<span class="sd">        ```</span>

<span class="sd">    Returns:</span>
<span class="sd">        SplinkDataFrame:  Table of truth statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">truth_space_table_from_labels_column</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">labels_column_name</span><span class="p">,</span> <span class="n">threshold_actual</span><span class="p">,</span> <span class="n">match_weight_round_to_nearest</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.truth_space_table_from_labels_table" class="doc doc-heading">
<code class="highlight language-python"><span class="n">truth_space_table_from_labels_table</span><span class="p">(</span><span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span> <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.truth_space_table_from_labels_table" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate truth statistics (false positive etc.) for each threshold value of
match_probability, suitable for plotting a ROC chart.</p>
<p>The table of labels should be in the following format, and should be registered
with your database:</p>
<table>
<thead>
<tr>
<th>source_dataset_l</th>
<th>unique_id_l</th>
<th>source_dataset_r</th>
<th>unique_id_r</th>
<th>clerical_match_score</th>
</tr>
</thead>
<tbody>
<tr>
<td>df_1</td>
<td>1</td>
<td>df_2</td>
<td>2</td>
<td>0.99</td>
</tr>
<tr>
<td>df_1</td>
<td>1</td>
<td>df_2</td>
<td>3</td>
<td>0.2</td>
</tr>
</tbody>
</table>
<p>Note that <code>source_dataset</code> and <code>unique_id</code> should correspond to the values
specified in the settings dict, and the <code>input_table_aliases</code> passed to the
<code>linker</code> object.</p>
<p>For <code>dedupe_only</code> links, the <code>source_dataset</code> columns can be ommitted.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>labels_splinkdataframe_or_table_name</code></td>
          <td>
                <code>str | <a class="autorefs autorefs-internal" title="splink.splink_dataframe.SplinkDataFrame" href="SplinkDataFrame.html#splink.splink_dataframe.SplinkDataFrame">SplinkDataFrame</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of table
containing labels in the database</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>threshold_actual</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Where the <code>clerical_match_score</code>
provided by the user is a probability rather than binary, this value
is used as the threshold to classify <code>clerical_match_score</code>s as binary
matches or non matches. Defaults to 0.5.</p>
            </div>
          </td>
          <td>
                <code>0.5</code>
          </td>
        </tr>
        <tr>
          <td><code>match_weight_round_to_nearest</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>When provided, thresholds
are rounded.  When large numbers of labels are provided, this is
sometimes necessary to reduce the size of the ROC table, and therefore
the number of points plotted on the ROC chart. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="splink.linker.Linker.truth_space_table_from_labels_table--__tabbed_1_1" name="splink.linker.Linker.truth_space_table_from_labels_table--__tabbed_1" type="radio" /><input id="splink.linker.Linker.truth_space_table_from_labels_table--__tabbed_1_2" name="splink.linker.Linker.truth_space_table_from_labels_table--__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="splink.linker.Linker.truth_space_table_from_labels_table--__tabbed_1_1">DuckDB</label><label for="splink.linker.Linker.truth_space_table_from_labels_table--__tabbed_1_2">Spark</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">labels</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;my_labels.csv&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">register_table</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="s2">&quot;labels&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">truth_space_table_from_labels_table</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="n">labels</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;my_labels.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">labels</span><span class="o">.</span><span class="n">createDataFrame</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">truth_space_table_from_labels_table</span><span class="p">(</span><span class="s2">&quot;labels&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
</div>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>SplinkDataFrame</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="splink.splink_dataframe.SplinkDataFrame" href="SplinkDataFrame.html#splink.splink_dataframe.SplinkDataFrame">SplinkDataFrame</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Table of truth statistics</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2073</span>
<span class="normal">2074</span>
<span class="normal">2075</span>
<span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">truth_space_table_from_labels_table</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">labels_splinkdataframe_or_table_name</span><span class="p">,</span>
    <span class="n">threshold_actual</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">match_weight_round_to_nearest</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SplinkDataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate truth statistics (false positive etc.) for each threshold value of</span>
<span class="sd">    match_probability, suitable for plotting a ROC chart.</span>

<span class="sd">    The table of labels should be in the following format, and should be registered</span>
<span class="sd">    with your database:</span>

<span class="sd">    |source_dataset_l|unique_id_l|source_dataset_r|unique_id_r|clerical_match_score|</span>
<span class="sd">    |----------------|-----------|----------------|-----------|--------------------|</span>
<span class="sd">    |df_1            |1          |df_2            |2          |0.99                |</span>
<span class="sd">    |df_1            |1          |df_2            |3          |0.2                 |</span>

<span class="sd">    Note that `source_dataset` and `unique_id` should correspond to the values</span>
<span class="sd">    specified in the settings dict, and the `input_table_aliases` passed to the</span>
<span class="sd">    `linker` object.</span>

<span class="sd">    For `dedupe_only` links, the `source_dataset` columns can be ommitted.</span>

<span class="sd">    Args:</span>
<span class="sd">        labels_splinkdataframe_or_table_name (str | SplinkDataFrame): Name of table</span>
<span class="sd">            containing labels in the database</span>
<span class="sd">        threshold_actual (float, optional): Where the `clerical_match_score`</span>
<span class="sd">            provided by the user is a probability rather than binary, this value</span>
<span class="sd">            is used as the threshold to classify `clerical_match_score`s as binary</span>
<span class="sd">            matches or non matches. Defaults to 0.5.</span>
<span class="sd">        match_weight_round_to_nearest (float, optional): When provided, thresholds</span>
<span class="sd">            are rounded.  When large numbers of labels are provided, this is</span>
<span class="sd">            sometimes necessary to reduce the size of the ROC table, and therefore</span>
<span class="sd">            the number of points plotted on the ROC chart. Defaults to None.</span>

<span class="sd">    Examples:</span>
<span class="sd">        === &quot;DuckDB&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            labels = pd.read_csv(&quot;my_labels.csv&quot;)</span>
<span class="sd">            linker.register_table(labels, &quot;labels&quot;)</span>
<span class="sd">            linker.truth_space_table_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">        === &quot;Spark&quot;</span>
<span class="sd">            ```py</span>
<span class="sd">            labels = spark.read.csv(&quot;my_labels.csv&quot;, header=True)</span>
<span class="sd">            labels.createDataFrame(&quot;labels&quot;)</span>
<span class="sd">            linker.truth_space_table_from_labels_table(&quot;labels&quot;)</span>
<span class="sd">            ```</span>
<span class="sd">    Returns:</span>
<span class="sd">        SplinkDataFrame:  Table of truth statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">labels_tablename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_labels_tablename_from_input</span><span class="p">(</span>
        <span class="n">labels_splinkdataframe_or_table_name</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_accuracy_columns_not_computed</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">truth_space_table_from_labels_table</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">labels_tablename</span><span class="p">,</span>
        <span class="n">threshold_actual</span><span class="o">=</span><span class="n">threshold_actual</span><span class="p">,</span>
        <span class="n">match_weight_round_to_nearest</span><span class="o">=</span><span class="n">match_weight_round_to_nearest</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.unlinkables_chart" class="doc doc-heading">
<code class="highlight language-python"><span class="n">unlinkables_chart</span><span class="p">(</span><span class="n">x_col</span><span class="o">=</span><span class="s1">&#39;match_weight&#39;</span><span class="p">,</span> <span class="n">source_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.unlinkables_chart" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Generate an interactive chart displaying the proportion of records that
are "unlinkable" for a given splink score threshold and model parameters.</p>
<p>Unlinkable records are those that, even when compared with themselves, do not
contain enough information to confirm a match.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x_col</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Column to use for the x-axis.
Defaults to "match_weight".</p>
            </div>
          </td>
          <td>
                <code>&#39;match_weight&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>source_dataset</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the source dataset to use for
the title of the output chart.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>as_dict</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, return a dict version of the chart.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <p>For the simplest code pipeline, load a pre-trained model
and run this against the test data.
<div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;./tests/datasets/fake_1000_from_splink_demos.csv&quot;</span><span class="p">)</span>
<span class="n">linker</span> <span class="o">=</span> <span class="n">DuckDBLinker</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">load_settings</span><span class="p">(</span><span class="s2">&quot;saved_settings.json&quot;</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">unlinkables_chart</span><span class="p">()</span>
</code></pre></div>
For more complex code pipelines, you can run an entire pipeline
that estimates your m and u values, before `unlinkables_chart().</p>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>VegaLite</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.
The vegalite spec is available as a dictionary using the <code>spec</code>
attribute.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2502</span>
<span class="normal">2503</span>
<span class="normal">2504</span>
<span class="normal">2505</span>
<span class="normal">2506</span>
<span class="normal">2507</span>
<span class="normal">2508</span>
<span class="normal">2509</span>
<span class="normal">2510</span>
<span class="normal">2511</span>
<span class="normal">2512</span>
<span class="normal">2513</span>
<span class="normal">2514</span>
<span class="normal">2515</span>
<span class="normal">2516</span>
<span class="normal">2517</span>
<span class="normal">2518</span>
<span class="normal">2519</span>
<span class="normal">2520</span>
<span class="normal">2521</span>
<span class="normal">2522</span>
<span class="normal">2523</span>
<span class="normal">2524</span>
<span class="normal">2525</span>
<span class="normal">2526</span>
<span class="normal">2527</span>
<span class="normal">2528</span>
<span class="normal">2529</span>
<span class="normal">2530</span>
<span class="normal">2531</span>
<span class="normal">2532</span>
<span class="normal">2533</span>
<span class="normal">2534</span>
<span class="normal">2535</span>
<span class="normal">2536</span>
<span class="normal">2537</span>
<span class="normal">2538</span>
<span class="normal">2539</span>
<span class="normal">2540</span>
<span class="normal">2541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">unlinkables_chart</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">x_col</span><span class="o">=</span><span class="s2">&quot;match_weight&quot;</span><span class="p">,</span>
    <span class="n">source_dataset</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">as_dict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate an interactive chart displaying the proportion of records that</span>
<span class="sd">    are &quot;unlinkable&quot; for a given splink score threshold and model parameters.</span>

<span class="sd">    Unlinkable records are those that, even when compared with themselves, do not</span>
<span class="sd">    contain enough information to confirm a match.</span>

<span class="sd">    Args:</span>
<span class="sd">        x_col (str, optional): Column to use for the x-axis.</span>
<span class="sd">            Defaults to &quot;match_weight&quot;.</span>
<span class="sd">        source_dataset (str, optional): Name of the source dataset to use for</span>
<span class="sd">            the title of the output chart.</span>
<span class="sd">        as_dict (bool, optional): If True, return a dict version of the chart.</span>

<span class="sd">    Examples:</span>
<span class="sd">        For the simplest code pipeline, load a pre-trained model</span>
<span class="sd">        and run this against the test data.</span>
<span class="sd">        ```py</span>
<span class="sd">        df = pd.read_csv(&quot;./tests/datasets/fake_1000_from_splink_demos.csv&quot;)</span>
<span class="sd">        linker = DuckDBLinker(df)</span>
<span class="sd">        linker.load_settings(&quot;saved_settings.json&quot;)</span>
<span class="sd">        linker.unlinkables_chart()</span>
<span class="sd">        ```</span>
<span class="sd">        For more complex code pipelines, you can run an entire pipeline</span>
<span class="sd">        that estimates your m and u values, before `unlinkables_chart().</span>

<span class="sd">    Returns:</span>
<span class="sd">        VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">            The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">            attribute.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Link our initial df on itself and calculate the % of unlinkable entries</span>
    <span class="n">records</span> <span class="o">=</span> <span class="n">unlinkables_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">unlinkables_chart</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">x_col</span><span class="p">,</span> <span class="n">source_dataset</span><span class="p">,</span> <span class="n">as_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="splink.linker.Linker.waterfall_chart" class="doc doc-heading">
<code class="highlight language-python"><span class="n">waterfall_chart</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="n">filter_nulls</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#splink.linker.Linker.waterfall_chart" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">
  
      <p>Visualise how the final match weight is computed for the provided pairwise
record comparisons.</p>
<p>Records must be provided as a list of dictionaries. This would usually be
obtained from <code>df.as_record_dict(limit=n)</code> where <code>df</code> is a SplinkDataFrame.</p>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="n">df</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">threshold_match_weight</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">records</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">as_record_dict</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">linker</span><span class="o">.</span><span class="n">waterfall_chart</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
</code></pre></div>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>records</code></td>
          <td>
                <code>List[dict]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Usually be obtained from <code>df.as_record_dict(limit=n)</code>
where <code>df</code> is a SplinkDataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>filter_nulls</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether the visualiation shows null
comparisons, which have no effect on final match weight. Defaults to
True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>VegaLite</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.
The vegalite spec is available as a dictionary using the <code>spec</code>
attribute.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>splink/linker.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2470</span>
<span class="normal">2471</span>
<span class="normal">2472</span>
<span class="normal">2473</span>
<span class="normal">2474</span>
<span class="normal">2475</span>
<span class="normal">2476</span>
<span class="normal">2477</span>
<span class="normal">2478</span>
<span class="normal">2479</span>
<span class="normal">2480</span>
<span class="normal">2481</span>
<span class="normal">2482</span>
<span class="normal">2483</span>
<span class="normal">2484</span>
<span class="normal">2485</span>
<span class="normal">2486</span>
<span class="normal">2487</span>
<span class="normal">2488</span>
<span class="normal">2489</span>
<span class="normal">2490</span>
<span class="normal">2491</span>
<span class="normal">2492</span>
<span class="normal">2493</span>
<span class="normal">2494</span>
<span class="normal">2495</span>
<span class="normal">2496</span>
<span class="normal">2497</span>
<span class="normal">2498</span>
<span class="normal">2499</span>
<span class="normal">2500</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">waterfall_chart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">records</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">filter_nulls</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualise how the final match weight is computed for the provided pairwise</span>
<span class="sd">    record comparisons.</span>

<span class="sd">    Records must be provided as a list of dictionaries. This would usually be</span>
<span class="sd">    obtained from `df.as_record_dict(limit=n)` where `df` is a SplinkDataFrame.</span>

<span class="sd">    Examples:</span>
<span class="sd">        ```py</span>
<span class="sd">        df = linker.predict(threshold_match_weight=2)</span>
<span class="sd">        records = df.as_record_dict(limit=10)</span>
<span class="sd">        linker.waterfall_chart(records)</span>
<span class="sd">        ```</span>

<span class="sd">    Args:</span>
<span class="sd">        records (List[dict]): Usually be obtained from `df.as_record_dict(limit=n)`</span>
<span class="sd">            where `df` is a SplinkDataFrame.</span>
<span class="sd">        filter_nulls (bool, optional): Whether the visualiation shows null</span>
<span class="sd">            comparisons, which have no effect on final match weight. Defaults to</span>
<span class="sd">            True.</span>


<span class="sd">    Returns:</span>
<span class="sd">        VegaLite: A VegaLite chart object. See altair.vegalite.v4.display.VegaLite.</span>
<span class="sd">            The vegalite spec is available as a dictionary using the `spec`</span>
<span class="sd">            attribute.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_raise_error_if_necessary_waterfall_columns_not_computed</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">waterfall_chart</span><span class="p">(</span><span class="n">records</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_settings_obj</span><span class="p">,</span> <span class="n">filter_nulls</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="linkerpred.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Predicting results" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Predicting results
              </div>
            </div>
          </a>
        
        
          
          <a href="em_training_session.html" class="md-footer__link md-footer__link--next" aria-label="Next: EM Training Session API" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                EM Training Session API
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": ".", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "search.highlight", "search.share", "search.suggest", "navigation.footer"], "search": "assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>