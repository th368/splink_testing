
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="example_febrl3.html">
      
      
        <link rel="next" href="example_simple_pyspark.html">
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.15">
    
    
      
        <title>Febrl4 link-only - Splink</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#linking-the-febrl4-datasets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Splink" class="md-header__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Splink
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Febrl4 link-only
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Splink" class="md-nav__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../img/favicon.ico" alt="logo">

    </a>
    Splink
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installations.html" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="00_Tutorial_Introduction.html" class="md-nav__link">
        0. Tutorial introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="01_Prerequisites.html" class="md-nav__link">
        1. Data prep prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="02_Exploratory_analysis.html" class="md-nav__link">
        2. Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="03_Blocking.html" class="md-nav__link">
        3. Blocking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="04_Estimating_model_parameters.html" class="md-nav__link">
        4. Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="05_Predicting_results.html" class="md-nav__link">
        5. Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="06_Visualising_predictions.html" class="md-nav__link">
        6. Visualising predictions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="07_Quality_assurance.html" class="md-nav__link">
        7. Quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_index.html" class="md-nav__link">
        Examples index
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          DuckDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          DuckDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_deduplicate_50k_synthetic.html" class="md-nav__link">
        Deduplicate 50k rows historical persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_transactions.html" class="md-nav__link">
        Linking financial transactions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_link_only.html" class="md-nav__link">
        Linking two tables of persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_real_time_record_linkage.html" class="md-nav__link">
        Real time record linkage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_accuracy_analysis_from_labels_column.html" class="md-nav__link">
        QA from ground truth column
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_pairwise_labels.html" class="md-nav__link">
        Estimating m probabilities from labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_quick_and_dirty_persons.html" class="md-nav__link">
        Quick and dirty persons model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_febrl3.html" class="md-nav__link">
        Febrl3 Dedupe
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Febrl4 link-only
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="example_febrl4.html" class="md-nav__link md-nav__link--active">
        Febrl4 link-only
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linking-the-febrl4-datasets" class="md-nav__link">
    Linking the febrl4 datasets
  </a>
  
    <nav class="md-nav" aria-label="Linking the febrl4 datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploring-data-and-defining-model" class="md-nav__link">
    Exploring data and defining model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estimating-model-parameters" class="md-nav__link">
    Estimating model parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictions" class="md-nav__link">
    Predictions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-refinements" class="md-nav__link">
    Further refinements
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          PySpark
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          PySpark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_simple_pyspark.html" class="md-nav__link">
        Deduplication using Pyspark
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Topic Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Topic Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/backends.html" class="md-nav__link">
        Splink's SQL backends - Spark, DuckDB etc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/link_type.html" class="md-nav__link">
        Link type - linking vs deduping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/querying_splink_results.html" class="md-nav__link">
        Retrieving and querying Splink results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/feature_engineering.html" class="md-nav__link">
        Feature Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
          Comparing Records
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          Comparing Records
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/customising_comparisons.html" class="md-nav__link">
        Defining and customising comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/comparison_templates.html" class="md-nav__link">
        Out-of-the-box comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5_3" id="__nav_5_5_3_label" tabindex="0">
          Comparing strings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5_3">
          <span class="md-nav__icon md-icon"></span>
          Comparing strings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/choosing_comparators.html" class="md-nav__link">
        Choosing comparators and thresholds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/comparators.html" class="md-nav__link">
        String comparators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/phonetic.html" class="md-nav__link">
        Phonetic transformations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/term-frequency.html" class="md-nav__link">
        Term-Frequency adjustments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
      
      
      
        <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
          Performance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_6">
          <span class="md-nav__icon md-icon"></span>
          Performance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/drivers_of_performance.html" class="md-nav__link">
        Run times, performance and linking large data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/blocking_rules.html" class="md-nav__link">
        Blocking rules for prediction vs estimation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/optimising_spark.html" class="md-nav__link">
        Optimising Spark performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/salting.html" class="md-nav__link">
        Salting blocking rules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          Linker API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Linker API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linker.html" class="md-nav__link">
        Full API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerexp.html" class="md-nav__link">
        Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerest.html" class="md-nav__link">
        Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerpred.html" class="md-nav__link">
        Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerqa.html" class="md-nav__link">
        Visualisation and quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../em_training_session.html" class="md-nav__link">
        EM Training Session API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SplinkDataFrame.html" class="md-nav__link">
        SplinkDataFrame API
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          Comparisons API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Comparisons API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison.html" class="md-nav__link">
        Comparison
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level.html" class="md-nav__link">
        Comparison Level
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
          Comparisons Library API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          Comparisons Library API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_library.html" class="md-nav__link">
        Comparison Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_template_library.html" class="md-nav__link">
        Comparison Template Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level_library.html" class="md-nav__link">
        Comparison Level Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level_composition.html" class="md-nav__link">
        Comparison Composition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../settingseditor/editor.html" class="md-nav__link">
        Settings Editor
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../settings_dict_guide.html" class="md-nav__link">
        Settings dictionary reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Developers' guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Developers' guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
      
      
      
        <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
          Making Changes to Splink
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_1">
          <span class="md-nav__icon md-icon"></span>
          Making Changes to Splink
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/building_env_locally.html" class="md-nav__link">
        Building a Virtual Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/lint.html" class="md-nav__link">
        Linting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/build_docs_locally.html" class="md-nav__link">
        Building Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/testing.html" class="md-nav__link">
        Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/releases.html" class="md-nav__link">
        Releasing a Package Version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/caching.html" class="md-nav__link">
        Caching and pipelining
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/debug_modes.html" class="md-nav__link">
        Understanding and debugging Splink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/spark_pipelining_and_caching.html" class="md-nav__link">
        Spark caching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/transpilation.html" class="md-nav__link">
        Transpilation using sqlglot
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_6" >
      
      
      
        <label class="md-nav__link" for="__nav_9_6" id="__nav_9_6_label" tabindex="0">
          Comparisons and comparison levels
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_6">
          <span class="md-nav__icon md-icon"></span>
          Comparisons and comparison levels
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/comparisons/new_library_comparisons_and_levels.html" class="md-nav__link">
        Creating new comparisons and comparison levels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/comparisons/extending_library_comparisons_and_levels.html" class="md-nav__link">
        Extending existing comparisons and comparison levels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/udfs.html" class="md-nav__link">
        User-Defined Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linking-the-febrl4-datasets" class="md-nav__link">
    Linking the febrl4 datasets
  </a>
  
    <nav class="md-nav" aria-label="Linking the febrl4 datasets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploring-data-and-defining-model" class="md-nav__link">
    Exploring data and defining model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estimating-model-parameters" class="md-nav__link">
    Estimating model parameters
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predictions" class="md-nav__link">
    Predictions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#further-refinements" class="md-nav__link">
    Further refinements
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  



  
  


  <h1>Febrl4 link-only</h1>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="linking-the-febrl4-datasets">Linking the febrl4 datasets<a class="headerlink" href="#linking-the-febrl4-datasets" title="Permanent link">&para;</a></h2>
<p>See A.2 <a href="https://arxiv.org/pdf/2008.04443.pdf">here</a> and <a href="https://recordlinkage.readthedocs.io/en/latest/ref-datasets.html">here</a> for the source of this data.</p>
<p>It consists of two datasets, A and B, of 5000 records each, with each record in dataset A having a corresponding record in dataset B. The aim will be to capture as many of those 5000 true links as possible, with minimal false linkages.</p>
<p>It is worth noting that we should not necessarily expect to capture <em>all</em> links. There are some links that although we know they <em>do</em> correspond to the same person, the data is so mismatched between them that we would not reasonably expect a model to link them, and indeed should a model do so may indicate that we have overengineered things using our knowledge of true links, which will not be a helpful reference in situations where we attempt to link unlabelled data, as will usually be the case.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="exploring-data-and-defining-model">Exploring data and defining model<a class="headerlink" href="#exploring-data-and-defining-model" title="Permanent link">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Firstly let's read in the data and have a little look at it</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">IFrame</span>
<span class="n">alt</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="s1">&#39;mimetype&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">read_and_prepare</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="n">fn</span><span class="p">,</span>
        <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;, &quot;</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;date_of_birth&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">},</span>
        <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span>
    <span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;rec_id&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">df</span>
<span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">read_and_prepare</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;./data/febrl/dataset4</span><span class="si">{</span><span class="n">dataset</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">display</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rec_id</th>
      <th>given_name</th>
      <th>surname</th>
      <th>street_number</th>
      <th>address_1</th>
      <th>address_2</th>
      <th>suburb</th>
      <th>postcode</th>
      <th>state</th>
      <th>date_of_birth</th>
      <th>soc_sec_id</th>
      <th>cluster</th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th>0</th>
      <td>rec-1070-org</td>
      <td>michaela</td>
      <td>neumann</td>
      <td>8.0</td>
      <td>stanley street</td>
      <td>miami</td>
      <td>winston hills</td>
      <td>4223</td>
      <td>nsw</td>
      <td>19151111</td>
      <td>5304218</td>
      <td>rec-1070</td>
    </tr>
    <tr>
      <th>1</th>
      <td>rec-1016-org</td>
      <td>courtney</td>
      <td>painter</td>
      <td>12.0</td>
      <td>pinkerton circuit</td>
      <td>bega flats</td>
      <td>richlands</td>
      <td>4560</td>
      <td>vic</td>
      <td>19161214</td>
      <td>4066625</td>
      <td>rec-1016</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="output_area">
<div class="output_html rendered_html output_subarea ">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rec_id</th>
      <th>given_name</th>
      <th>surname</th>
      <th>street_number</th>
      <th>address_1</th>
      <th>address_2</th>
      <th>suburb</th>
      <th>postcode</th>
      <th>state</th>
      <th>date_of_birth</th>
      <th>soc_sec_id</th>
      <th>cluster</th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th>0</th>
      <td>rec-561-dup-0</td>
      <td>elton</td>
      <td>NaN</td>
      <td>3.0</td>
      <td>light setreet</td>
      <td>pinehill</td>
      <td>windermere</td>
      <td>3212</td>
      <td>vic</td>
      <td>19651013</td>
      <td>1551941</td>
      <td>rec-561</td>
    </tr>
    <tr>
      <th>1</th>
      <td>rec-2642-dup-0</td>
      <td>mitchell</td>
      <td>maxon</td>
      <td>47.0</td>
      <td>edkins street</td>
      <td>lochaoair</td>
      <td>north ryde</td>
      <td>3355</td>
      <td>nsw</td>
      <td>19390212</td>
      <td>8859999</td>
      <td>rec-2642</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next, to better understand which variables will prove useful in linking, we have a look at how populated each column is, as well as the distribution of unique values within each</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splink.duckdb.duckdb_linker</span> <span class="kn">import</span> <span class="n">DuckDBLinker</span>

<span class="n">basic_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;unique_id_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;rec_id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;link_type&quot;</span><span class="p">:</span> <span class="s2">&quot;link_only&quot;</span><span class="p">,</span>
    <span class="c1"># NB as we are linking one-one, we know the probability that a random pair will be a match</span>
    <span class="c1"># hence we could set:</span>
    <span class="c1"># &quot;probability_two_random_records_match&quot;: 1/5000,</span>
    <span class="c1"># however we will not specify this here, as we will use this as a check that</span>
    <span class="c1"># our estimation procedure returns something sensible</span>
<span class="p">}</span>

<span class="n">linker</span> <span class="o">=</span> <span class="n">DuckDBLinker</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">basic_settings</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker</span><span class="o">.</span><span class="n">missingness_chart</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">cols_to_profile</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">cols_to_profile</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols_to_profile</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;rec_id&quot;</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">)]</span>
<span class="n">linker</span><span class="o">.</span><span class="n">profile_columns</span><span class="p">(</span><span class="n">cols_to_profile</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next let's come up with some candidate blocking rules, which define which record comparisons are generated, and have a look at how many comparisons each will generate.</p>
<p>For blocking rules that we use in prediction, our aim is to have the union of all rules cover all true matches, whilst avoiding generating so many comparisons that it becomes computationally intractable - i.e. each true match should have at least <em>one</em> of the following conditions holding.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">blocking_rules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;l.given_name = r.given_name AND l.surname = r.surname&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.date_of_birth = r.date_of_birth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.soc_sec_id = r.soc_sec_id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.state = r.state AND l.address_1 = r.address_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.street_number = r.street_number AND l.address_1 = r.address_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.postcode = r.postcode&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">linker</span><span class="o">.</span><span class="n">cumulative_num_comparisons_from_blocking_rules_chart</span><span class="p">(</span><span class="n">blocking_rules</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The broadest rule, having a matching postcode, unsurpisingly gives the largest number of comparisons.
For this small dataset we still have a very manageable number, but if it was larger we might have needed to include a further <code>AND</code> condition with it to break the number of comparisons further.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we get the full settings by including the blocking rules, as well as deciding the actual comparisons we will be including in our model.</p>
<p>We will define two models, each with a separate linker with different settings, so that we can compare performance. One will be a very basic model, whilst the other will include a lot more detail.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">splink.duckdb.duckdb_comparison_level_library</span> <span class="k">as</span> <span class="nn">cll</span>
<span class="kn">import</span> <span class="nn">splink.duckdb.duckdb_comparison_library</span> <span class="k">as</span> <span class="nn">cl</span>
<span class="kn">import</span> <span class="nn">splink.duckdb.duckdb_comparison_template_library</span> <span class="k">as</span> <span class="nn">ctl</span>

<span class="c1"># the simple model only considers a few columns, and only two comparison levels for each</span>
<span class="n">simple_model_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">**</span><span class="n">basic_settings</span><span class="p">,</span>
    <span class="s2">&quot;blocking_rules_to_generate_predictions&quot;</span><span class="p">:</span> <span class="n">blocking_rules</span><span class="p">,</span>
    <span class="s2">&quot;comparisons&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">exact_match</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">exact_match</span><span class="p">(</span><span class="s2">&quot;surname&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">exact_match</span><span class="p">(</span><span class="s2">&quot;street_number&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;retain_intermediate_calculation_columns&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
<span class="c1"># the detailed model considers more columns, using the information we saw in the exploratory phase</span>
<span class="c1"># we also include further comparison levels to account for typos and other differences</span>
<span class="n">detailed_model_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">**</span><span class="n">basic_settings</span><span class="p">,</span>
    <span class="s2">&quot;blocking_rules_to_generate_predictions&quot;</span><span class="p">:</span> <span class="n">blocking_rules</span><span class="p">,</span>
    <span class="s2">&quot;comparisons&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">ctl</span><span class="o">.</span><span class="n">name_comparison</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments_name</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">ctl</span><span class="o">.</span><span class="n">name_comparison</span><span class="p">(</span><span class="s2">&quot;surname&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments_name</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">levenshtein_at_thresholds</span><span class="p">(</span><span class="s2">&quot;date_of_birth&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">levenshtein_at_thresholds</span><span class="p">(</span><span class="s2">&quot;soc_sec_id&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">exact_match</span><span class="p">(</span><span class="s2">&quot;street_number&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">levenshtein_at_thresholds</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="c1"># we don&#39;t consider further location columns as they will be strongly correlated with postcode</span>
    <span class="p">],</span>
    <span class="s2">&quot;retain_intermediate_calculation_columns&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>


<span class="n">linker_simple</span> <span class="o">=</span> <span class="n">DuckDBLinker</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">simple_model_settings</span><span class="p">)</span>
<span class="n">linker_detailed</span> <span class="o">=</span> <span class="n">DuckDBLinker</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">detailed_model_settings</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="estimating-model-parameters">Estimating model parameters<a class="headerlink" href="#estimating-model-parameters" title="Permanent link">&para;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to furnish our models with parameter estimates so that we can generate results. We will focus on the detailed model, generating the values for the simple model at the end</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can instead estimate the probability two random records match, and compare with the known value of 1/5000 = 0.0002, to see how well our estimation procedure works.</p>
<p>To do this we come up with some deterministic rules - the aim here is that we generate very few false positives (i.e. we expect that the majority of records with at least one of these conditions holding are true matches), whilst also capturing the majority of matches - our guess here is that these two rules should capture 80% of all matches.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">deterministic_rules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;l.soc_sec_id = r.soc_sec_id&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.given_name = r.given_name and l.surname = r.surname and l.date_of_birth = r.date_of_birth&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">linker_detailed</span><span class="o">.</span><span class="n">estimate_probability_two_random_records_match</span><span class="p">(</span><span class="n">deterministic_rules</span><span class="p">,</span> <span class="n">recall</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>Probability two random records match is estimated to be  0.000238.
This means that amongst all possible pairwise record comparisons, one in 4,195.51 are expected to match.  With 25,000,000 total possible comparisons, we expect a total of around 5,958.75 matching pairs
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Even playing around with changing these deterministic rules, or the nominal recall leaves us with an answer which is pretty close to our known value</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Next we estimate <code>u</code> and <code>m</code> values for each comparison, so that we can move to generating predictions</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker_detailed</span><span class="o">.</span><span class="n">estimate_u_using_random_sampling</span><span class="p">(</span><span class="n">max_pairs</span><span class="o">=</span><span class="mf">1e7</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>----- Estimating u probabilities using random sampling -----
/Users/rosskennedy/splink_demos/venv/lib/python3.9/site-packages/ipykernel/comm/comm.py:79: DeprecationWarning: The `ipykernel.comm.Comm` class has been deprecated. Please use the `comm` module instead.For creating comms, use the function `from comm import create_comm`.
  warn(
/Users/rosskennedy/splink_demos/venv/lib/python3.9/site-packages/ipykernel/comm/comm.py:79: DeprecationWarning: The `ipykernel.comm.Comm` class has been deprecated. Please use the `comm` module instead.For creating comms, use the function `from comm import create_comm`.
  warn(
/Users/rosskennedy/splink_demos/venv/lib/python3.9/site-packages/ipykernel/comm/comm.py:79: DeprecationWarning: The `ipykernel.comm.Comm` class has been deprecated. Please use the `comm` module instead.For creating comms, use the function `from comm import create_comm`.
  warn(
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea ">
<pre>
<code>FloatProgress(value=0.0, layout=Layout(width=&#39;100%&#39;), style=ProgressStyle(bar_color=&#39;black&#39;))</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>
Estimated u probabilities using random sampling

Your model is not yet fully trained. Missing estimates for:
    - given_name (no m values are trained).
    - surname (no m values are trained).
    - date_of_birth (no m values are trained).
    - soc_sec_id (no m values are trained).
    - street_number (no m values are trained).
    - postcode (no m values are trained).
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When training the <code>m</code> values using expectation maximisation, we need somre more blocking rules to reduce the total number of comparisons. For each rule, we want to ensure that we have neither proportionally too many matches, or too few.</p>
<p>We must run this multiple times using different rules so that we can obtain estimates for all comparisons - if we block on e.g. <code>date_of_birth</code>, then we cannot compute the <code>m</code> values for the <code>date_of_birth</code> comparison, as we have only looked at records where these match.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">session_dob</span> <span class="o">=</span> <span class="n">linker_detailed</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span>
    <span class="s2">&quot;l.date_of_birth = r.date_of_birth&quot;</span>
<span class="p">)</span>
<span class="n">session_pc</span> <span class="o">=</span> <span class="n">linker_detailed</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span>
    <span class="s2">&quot;l.postcode = r.postcode&quot;</span>
<span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>
----- Starting EM training session -----

Estimating the m probabilities of the model by blocking on:
l.date_of_birth = r.date_of_birth

Parameter estimates will be made for the following comparison(s):
    - given_name
    - surname
    - soc_sec_id
    - street_number
    - postcode

Parameter estimates cannot be made for the following comparison(s) since they are used in the blocking rules: 
    - date_of_birth

Iteration 1: Largest change in params was 0.362 in probability_two_random_records_match
Iteration 2: Largest change in params was 0.00425 in probability_two_random_records_match
Iteration 3: Largest change in params was 5.61e-05 in the m_probability of soc_sec_id, level `All other comparisons`

EM converged after 3 iterations

Your model is not yet fully trained. Missing estimates for:
    - date_of_birth (no m values are trained).

----- Starting EM training session -----

Estimating the m probabilities of the model by blocking on:
l.postcode = r.postcode

Parameter estimates will be made for the following comparison(s):
    - given_name
    - surname
    - date_of_birth
    - soc_sec_id
    - street_number

Parameter estimates cannot be made for the following comparison(s) since they are used in the blocking rules: 
    - postcode

Iteration 1: Largest change in params was 0.0293 in the m_probability of date_of_birth, level `All other comparisons`
Iteration 2: Largest change in params was 0.000301 in the m_probability of date_of_birth, level `All other comparisons`
Iteration 3: Largest change in params was 4.38e-06 in the m_probability of soc_sec_id, level `All other comparisons`

EM converged after 3 iterations

Your model is fully trained. All comparisons have at least one estimate for their m and u values
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If we wish we can have a look at how our parameter estimates changes over these training sessions</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># session_dob.m_u_values_interactive_history_chart()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For variables that aren't used in the <code>m</code>-training blocking rules, we have two estimates --- one from each of the training sessions (see for example <code>street_number</code>). We can have a look at how the values compare between them, to ensure that we don't have drastically different values, which may be indicative of an issue.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker_detailed</span><span class="o">.</span><span class="n">parameter_estimate_comparisons_chart</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We repeat our parameter estimations for the simple model in much the same fashion</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker_simple</span><span class="o">.</span><span class="n">estimate_probability_two_random_records_match</span><span class="p">(</span><span class="n">deterministic_rules</span><span class="p">,</span> <span class="n">recall</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">linker_simple</span><span class="o">.</span><span class="n">estimate_u_using_random_sampling</span><span class="p">(</span><span class="n">max_pairs</span><span class="o">=</span><span class="mf">1e7</span><span class="p">)</span>
<span class="n">session_ssid</span> <span class="o">=</span> <span class="n">linker_simple</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span>
    <span class="s2">&quot;l.given_name = r.given_name&quot;</span>
<span class="p">)</span>
<span class="n">session_pc</span> <span class="o">=</span> <span class="n">linker_simple</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span>
    <span class="s2">&quot;l.street_number = r.street_number&quot;</span>
<span class="p">)</span>
<span class="c1"># linker_simple.parameter_estimate_comparisons_chart()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>Probability two random records match is estimated to be  0.000238.
This means that amongst all possible pairwise record comparisons, one in 4,195.51 are expected to match.  With 25,000,000 total possible comparisons, we expect a total of around 5,958.75 matching pairs
----- Estimating u probabilities using random sampling -----

Estimated u probabilities using random sampling

Your model is not yet fully trained. Missing estimates for:
    - given_name (no m values are trained).
    - surname (no m values are trained).
    - street_number (no m values are trained).

----- Starting EM training session -----

Estimating the m probabilities of the model by blocking on:
l.given_name = r.given_name

Parameter estimates will be made for the following comparison(s):
    - surname
    - street_number

Parameter estimates cannot be made for the following comparison(s) since they are used in the blocking rules: 
    - given_name

Iteration 1: Largest change in params was 0.101 in the m_probability of surname, level `All other comparisons`
Iteration 2: Largest change in params was -0.0467 in the m_probability of surname, level `Exact match`
Iteration 3: Largest change in params was -0.0326 in the m_probability of surname, level `Exact match`
Iteration 4: Largest change in params was -0.0215 in the m_probability of surname, level `Exact match`
Iteration 5: Largest change in params was 0.0136 in the m_probability of surname, level `All other comparisons`
Iteration 6: Largest change in params was -0.00839 in the m_probability of surname, level `Exact match`
Iteration 7: Largest change in params was -0.00516 in the m_probability of surname, level `Exact match`
Iteration 8: Largest change in params was -0.00319 in the m_probability of surname, level `Exact match`
Iteration 9: Largest change in params was 0.00198 in the m_probability of surname, level `All other comparisons`
Iteration 10: Largest change in params was 0.00124 in the m_probability of surname, level `All other comparisons`
Iteration 11: Largest change in params was -0.000777 in the m_probability of surname, level `Exact match`
Iteration 12: Largest change in params was -0.00049 in the m_probability of surname, level `Exact match`
Iteration 13: Largest change in params was 0.00031 in the m_probability of surname, level `All other comparisons`
Iteration 14: Largest change in params was -0.000197 in the m_probability of surname, level `Exact match`
Iteration 15: Largest change in params was 0.000125 in the m_probability of surname, level `All other comparisons`
Iteration 16: Largest change in params was 7.96e-05 in the m_probability of surname, level `All other comparisons`

EM converged after 16 iterations

Your model is not yet fully trained. Missing estimates for:
    - given_name (no m values are trained).

----- Starting EM training session -----

Estimating the m probabilities of the model by blocking on:
l.street_number = r.street_number

Parameter estimates will be made for the following comparison(s):
    - given_name
    - surname

Parameter estimates cannot be made for the following comparison(s) since they are used in the blocking rules: 
    - street_number

Iteration 1: Largest change in params was -0.0665 in the m_probability of given_name, level `Exact match`
Iteration 2: Largest change in params was -0.0432 in the m_probability of given_name, level `Exact match`
Iteration 3: Largest change in params was -0.0275 in the m_probability of given_name, level `Exact match`
Iteration 4: Largest change in params was 0.0159 in the m_probability of given_name, level `All other comparisons`
Iteration 5: Largest change in params was 0.00869 in the m_probability of given_name, level `All other comparisons`
Iteration 6: Largest change in params was -0.00471 in the m_probability of given_name, level `Exact match`
Iteration 7: Largest change in params was -0.00258 in the m_probability of given_name, level `Exact match`
Iteration 8: Largest change in params was 0.00145 in the m_probability of given_name, level `All other comparisons`
Iteration 9: Largest change in params was 0.000842 in the m_probability of given_name, level `All other comparisons`
Iteration 10: Largest change in params was -0.000505 in the m_probability of given_name, level `Exact match`
Iteration 11: Largest change in params was -0.000313 in the m_probability of given_name, level `Exact match`
Iteration 12: Largest change in params was -0.000214 in the m_probability of surname, level `Exact match`
Iteration 13: Largest change in params was 0.000154 in the m_probability of surname, level `All other comparisons`
Iteration 14: Largest change in params was 0.00011 in the m_probability of surname, level `All other comparisons`
Iteration 15: Largest change in params was -7.78e-05 in the m_probability of surname, level `Exact match`

EM converged after 15 iterations

Your model is fully trained. All comparisons have at least one estimate for their m and u values
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># import json</span>
<span class="c1"># we can have a look at the full settings if we wish, including the values of our estimated parameters:</span>
<span class="c1"># print(json.dumps(linker_detailed._settings_obj.as_dict(), indent=2))</span>
<span class="c1"># we can also get a handy summary of of the model in an easily readable format if we wish:</span>
<span class="c1"># print(linker_detailed._settings_obj.human_readable_description)</span>
<span class="c1"># (we suppress output here for brevity)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can now visualise some of the details of our models. We can look at the match weights, which tell us the relative importance for/against a match for each of our comparsion levels.</p>
<p>Comparing the two models will show the added benefit we get in the more detailed model --- what in the simple model is classed as 'all other comparisons' is instead broken down further, and we can see that the detail of how this is broken down in fact gives us quite a bit of useful information about the likelihood of a match.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker_simple</span><span class="o">.</span><span class="n">match_weights_chart</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker_detailed</span><span class="o">.</span><span class="n">match_weights_chart</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As well as the match weights, which give us an idea of the overall effect of each comparison level, we can also look at the individual <code>u</code> and <code>m</code> parameter estimates, which tells us about the prevalence of coincidences and mistakes (for further details/explanation about this see <a href="https://www.robinlinacre.com/maths_of_fellegi_sunter/">this article</a>). We might want to revise aspects of our model based on the information we ascertain here.</p>
<p>Note however that some of these values are very small, which is why the match weight chart is often more useful for getting a decent picture of things.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># linker_simple.m_u_parameters_chart()</span>
<span class="n">linker_detailed</span><span class="o">.</span><span class="n">m_u_parameters_chart</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It is also useful to have a look at unlinkable records - these are records which do not contain enough information to be linked at some match probability threshold. We can figure this out be seeing whether records are able to be matched with themselves.</p>
<p>This is of course relative to the information we have put into the model - we see that in our simple model, at a 99% match threshold nearly 10% of records are unlinkable, as we have not included enough information in the model for distinct records to be adequately distinguished; this is not an issue in our more detailed model.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker_simple</span><span class="o">.</span><span class="n">unlinkables_chart</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker_detailed</span><span class="o">.</span><span class="n">unlinkables_chart</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Our simple model doesn't do <em>terribly</em>, but suffers if we want to have a high match probability --- to be 99% certain of matches we have ~10% of records that we will be unable to link.</p>
<p>Our detailed model, however, has enough nuance that we can at least self-link records.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="predictions">Predictions<a class="headerlink" href="#predictions" title="Permanent link">&para;</a></h3>
<p>Now that we have had a look into the details of the models, we will focus on only our more detailed model, which should be able to capture more of the genuine links in our data</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">predictions</span> <span class="o">=</span> <span class="n">linker_detailed</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">df_predictions</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">()</span>
<span class="n">df_predictions</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_weight</th>
      <th>match_probability</th>
      <th>source_dataset_l</th>
      <th>source_dataset_r</th>
      <th>rec_id_l</th>
      <th>rec_id_r</th>
      <th>given_name_l</th>
      <th>given_name_r</th>
      <th>gamma_given_name</th>
      <th>tf_given_name_l</th>
      <th>...</th>
      <th>gamma_postcode</th>
      <th>tf_postcode_l</th>
      <th>tf_postcode_r</th>
      <th>bf_postcode</th>
      <th>bf_tf_adj_postcode</th>
      <th>state_l</th>
      <th>state_r</th>
      <th>address_1_l</th>
      <th>address_1_r</th>
      <th>match_key</th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th>0</th>
      <td>33.218065</td>
      <td>1.0</td>
      <td>__splink__input_table_0</td>
      <td>__splink__input_table_1</td>
      <td>rec-3440-org</td>
      <td>rec-3440-dup-0</td>
      <td>matthew</td>
      <td>matthew</td>
      <td>3</td>
      <td>0.007251</td>
      <td>...</td>
      <td>1</td>
      <td>0.0002</td>
      <td>0.0003</td>
      <td>0.917896</td>
      <td>1.000000</td>
      <td>vic</td>
      <td>vic</td>
      <td>cowcher place</td>
      <td>cowcher dlace</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>42.790666</td>
      <td>1.0</td>
      <td>__splink__input_table_0</td>
      <td>__splink__input_table_1</td>
      <td>rec-4028-org</td>
      <td>rec-4028-dup-0</td>
      <td>lachlan</td>
      <td>lachlan</td>
      <td>3</td>
      <td>0.011705</td>
      <td>...</td>
      <td>3</td>
      <td>0.0014</td>
      <td>0.0014</td>
      <td>729.077700</td>
      <td>0.823831</td>
      <td>sa</td>
      <td>sa</td>
      <td>lienhop street</td>
      <td>lienhop street</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>37.893804</td>
      <td>1.0</td>
      <td>__splink__input_table_0</td>
      <td>__splink__input_table_1</td>
      <td>rec-555-org</td>
      <td>rec-555-dup-0</td>
      <td>harry</td>
      <td>harry</td>
      <td>3</td>
      <td>0.004765</td>
      <td>...</td>
      <td>3</td>
      <td>0.0013</td>
      <td>0.0013</td>
      <td>729.077700</td>
      <td>0.887202</td>
      <td>nsw</td>
      <td>nsw</td>
      <td>hodgson crescent</td>
      <td>charteris crescent</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>43.205900</td>
      <td>1.0</td>
      <td>__splink__input_table_0</td>
      <td>__splink__input_table_1</td>
      <td>rec-1155-org</td>
      <td>rec-1155-dup-0</td>
      <td>jessica</td>
      <td>jessica</td>
      <td>3</td>
      <td>0.008805</td>
      <td>...</td>
      <td>3</td>
      <td>0.0024</td>
      <td>0.0024</td>
      <td>729.077700</td>
      <td>0.480568</td>
      <td>sa</td>
      <td>sa</td>
      <td>dugan street</td>
      <td>dugan street</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>33.661827</td>
      <td>1.0</td>
      <td>__splink__input_table_0</td>
      <td>__splink__input_table_1</td>
      <td>rec-18-org</td>
      <td>rec-18-dup-0</td>
      <td>riley</td>
      <td>riley</td>
      <td>3</td>
      <td>0.005904</td>
      <td>...</td>
      <td>3</td>
      <td>0.0008</td>
      <td>0.0008</td>
      <td>729.077700</td>
      <td>1.441704</td>
      <td>vic</td>
      <td>nsw</td>
      <td>clem hill street</td>
      <td>clem hill street</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 47 columns</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see how our model performs at different probability thresholds, with a couple of options depending on the space we wish to view things</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># linker_detailed.roc_chart_from_labels_column(&quot;cluster&quot;)</span>
<span class="n">linker_detailed</span><span class="o">.</span><span class="n">precision_recall_chart_from_labels_column</span><span class="p">(</span><span class="s2">&quot;cluster&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>and we can easily see how many individuals we identify and link by looking at clusters generated at some threshold match probability of interest - in this example 99%</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">clusters</span> <span class="o">=</span> <span class="n">linker_detailed</span><span class="o">.</span><span class="n">cluster_pairwise_predictions_at_threshold</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">threshold_match_probability</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
<span class="n">df_clusters</span> <span class="o">=</span> <span class="n">clusters</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">)</span>
<span class="n">df_clusters</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>Completed iteration 1, root rows count 0
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>2    4950
1     100
Name: count, dtype: int64</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case, we happen to know what the true links are, so we can manually inspect the ones that are doing worst to see what our model is not capturing - i.e. where we have false negatives.</p>
<p>Similarly, we can look at the non-links which are performing the best, to see whether we have an issue with false positives.</p>
<p>Ordinarily we would not have this luxury, and so would need to dig a bit deeper for clues as to how to improve our model, such as manually inspecting records across threshold probabilities, </p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df_predictions</span><span class="p">[</span><span class="s2">&quot;cluster_l&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_predictions</span><span class="p">[</span><span class="s2">&quot;rec_id_l&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">df_predictions</span><span class="p">[</span><span class="s2">&quot;cluster_r&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_predictions</span><span class="p">[</span><span class="s2">&quot;rec_id_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">df_true_links</span> <span class="o">=</span> <span class="n">df_predictions</span><span class="p">[</span><span class="n">df_predictions</span><span class="p">[</span><span class="s2">&quot;cluster_l&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">df_predictions</span><span class="p">[</span><span class="s2">&quot;cluster_r&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;match_probability&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">records_to_view</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">linker_detailed</span><span class="o">.</span><span class="n">waterfall_chart</span><span class="p">(</span><span class="n">df_true_links</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">records_to_view</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">))</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">df_non_links</span> <span class="o">=</span> <span class="n">df_predictions</span><span class="p">[</span><span class="n">df_predictions</span><span class="p">[</span><span class="s2">&quot;cluster_l&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">df_predictions</span><span class="p">[</span><span class="s2">&quot;cluster_r&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;match_probability&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">linker_detailed</span><span class="o">.</span><span class="n">waterfall_chart</span><span class="p">(</span><span class="n">df_non_links</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="n">records_to_view</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s2">&quot;records&quot;</span><span class="p">))</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="further-refinements">Further refinements<a class="headerlink" href="#further-refinements" title="Permanent link">&para;</a></h2>
<p>Looking at the non-links we have done well in having no false positives at any substantial match probability --- however looking at some of the true links we can see that there are a few that we are not capturing with sufficient match probability.</p>
<p>We can see that there are a few features that we are not capturing/weighting appropriately
* single-character transpostions, particularly in postcode (which is being lumped in with more 'severe typos'/probable non-matches)
* given/sur-names being swapped with typos
* given/sur-names being cross-matches on one only, with no match on the other cross</p>
<p>We will quickly see if we can incorporate these features into a new model. As we are now going into more detail with the inter-relationship between given name and surname, it is probably no longer sensible to model them as independent comparisons, and so we will need to switch to a combined comparison on full name.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># we need to append a full name column to our source data frames</span>
<span class="c1"># so that we can use it for term frequency adjustments</span>
<span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;given_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">dfs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;surname&quot;</span><span class="p">]</span>
<span class="n">dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;full_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;given_name&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">dfs</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;surname&quot;</span><span class="p">]</span>


<span class="n">extended_model_settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">**</span><span class="n">basic_settings</span><span class="p">,</span>
    <span class="s2">&quot;blocking_rules_to_generate_predictions&quot;</span><span class="p">:</span> <span class="n">blocking_rules</span><span class="p">,</span>
    <span class="s2">&quot;comparisons&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;output_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Full name&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comparison_levels&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;sql_condition&quot;</span><span class="p">:</span> <span class="s2">&quot;(given_name_l IS NULL OR given_name_r IS NULL) and (surname_l IS NULL OR surname_r IS NULL)&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;label_for_charts&quot;</span><span class="p">:</span> <span class="s2">&quot;Null&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;is_null_level&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="p">},</span>
                <span class="c1"># full name match</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">exact_match_level</span><span class="p">(</span><span class="s2">&quot;full_name&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="c1"># typos - keep levels across full name rather than scoring separately</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">jaro_winkler_level</span><span class="p">(</span><span class="s2">&quot;full_name&quot;</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">jaro_winkler_level</span><span class="p">(</span><span class="s2">&quot;full_name&quot;</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">),</span>
                <span class="c1"># name switched</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">columns_reversed_level</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="s2">&quot;surname&quot;</span><span class="p">),</span>
                <span class="c1"># name switched + typo</span>
                <span class="p">{</span>
                    <span class="s2">&quot;sql_condition&quot;</span><span class="p">:</span> <span class="s2">&quot;jaro_winkler_similarity(given_name_l, surname_r) + jaro_winkler_similarity(surname_l, given_name_r) &gt;= 1.8&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;label_for_charts&quot;</span><span class="p">:</span> <span class="s2">&quot;switched + jaro_winkler_similarity &gt;= 1.8&quot;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="s2">&quot;sql_condition&quot;</span><span class="p">:</span> <span class="s2">&quot;jaro_winkler_similarity(given_name_l, surname_r) + jaro_winkler_similarity(surname_l, given_name_r) &gt;= 1.4&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;label_for_charts&quot;</span><span class="p">:</span> <span class="s2">&quot;switched + jaro_winkler_similarity &gt;= 1.4&quot;</span>
                <span class="p">},</span>
                <span class="c1"># single name match</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">exact_match_level</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">exact_match_level</span><span class="p">(</span><span class="s2">&quot;surname&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="c1"># single name cross-match</span>
                <span class="p">{</span>
                    <span class="s2">&quot;sql_condition&quot;</span><span class="p">:</span> <span class="s2">&quot;given_name_l = surname_r OR surname_l = given_name_r&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;label_for_charts&quot;</span><span class="p">:</span> <span class="s2">&quot;single name cross-matches&quot;</span>
                <span class="p">},</span>                <span class="c1"># single name typos</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">jaro_winkler_level</span><span class="p">(</span><span class="s2">&quot;given_name&quot;</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">jaro_winkler_level</span><span class="p">(</span><span class="s2">&quot;surname&quot;</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
                <span class="c1"># the rest</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">else_level</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;output_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Date of birth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comparison_levels&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">null_level</span><span class="p">(</span><span class="s2">&quot;date_of_birth&quot;</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">exact_match_level</span><span class="p">(</span><span class="s2">&quot;date_of_birth&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;date_of_birth&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="c1"># this is the extra level</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">and_</span><span class="p">(</span> <span class="c1"># we have the same set of letters, and two levenshtein edits between them - i.e. a single transposition</span>
                    <span class="n">cll</span><span class="o">.</span><span class="n">jaccard_level</span><span class="p">(</span><span class="s2">&quot;date_of_birth&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;date_of_birth&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;date_of_birth&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">else_level</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;output_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Social security ID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comparison_levels&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">null_level</span><span class="p">(</span><span class="s2">&quot;soc_sec_id&quot;</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">exact_match_level</span><span class="p">(</span><span class="s2">&quot;soc_sec_id&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;soc_sec_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="c1"># this is the extra level</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">and_</span><span class="p">(</span> <span class="c1"># we have the same set of letters, and two levenshtein edits between them - i.e. a single transposition</span>
                    <span class="n">cll</span><span class="o">.</span><span class="n">jaccard_level</span><span class="p">(</span><span class="s2">&quot;soc_sec_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;soc_sec_id&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;soc_sec_id&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">else_level</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;output_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Street number&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comparison_levels&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">null_level</span><span class="p">(</span><span class="s2">&quot;street_number&quot;</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">exact_match_level</span><span class="p">(</span><span class="s2">&quot;street_number&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;street_number&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="c1"># this is the extra level</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">and_</span><span class="p">(</span> <span class="c1"># we have the same set of letters, and two levenshtein edits between them - i.e. a single transposition</span>
                    <span class="n">cll</span><span class="o">.</span><span class="n">jaccard_level</span><span class="p">(</span><span class="s2">&quot;street_number&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;street_number&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">else_level</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;output_column_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Postcode&quot;</span><span class="p">,</span>
            <span class="s2">&quot;comparison_levels&quot;</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">null_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">exact_match_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">and_</span><span class="p">(</span> <span class="c1"># we have the same set of letters, and two levenshtein edits between them - i.e. a single transposition</span>
                    <span class="n">cll</span><span class="o">.</span><span class="n">jaccard_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">levenshtein_level</span><span class="p">(</span><span class="s2">&quot;postcode&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
                <span class="n">cll</span><span class="o">.</span><span class="n">else_level</span><span class="p">()</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="c1"># we don&#39;t consider further location columns as they will be strongly correlated with postcode</span>
    <span class="p">],</span>
    <span class="s2">&quot;retain_intermediate_calculation_columns&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># train</span>
<span class="n">linker_advanced</span> <span class="o">=</span> <span class="n">DuckDBLinker</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">extended_model_settings</span><span class="p">)</span>
<span class="n">linker_advanced</span><span class="o">.</span><span class="n">estimate_probability_two_random_records_match</span><span class="p">(</span><span class="n">deterministic_rules</span><span class="p">,</span> <span class="n">recall</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="c1"># we increase target rows to improve accuracy for u values in full name comparison, as we have subdivided the data more finely</span>
<span class="n">linker_advanced</span><span class="o">.</span><span class="n">estimate_u_using_random_sampling</span><span class="p">(</span><span class="n">max_pairs</span><span class="o">=</span><span class="mf">1e8</span><span class="p">)</span>
<span class="n">session_dob</span> <span class="o">=</span> <span class="n">linker_advanced</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span>
    <span class="s2">&quot;l.date_of_birth = r.date_of_birth&quot;</span>
<span class="p">)</span>
<span class="n">session_pc</span> <span class="o">=</span> <span class="n">linker_advanced</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span>
    <span class="s2">&quot;l.postcode = r.postcode&quot;</span>
<span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>Probability two random records match is estimated to be  0.000238.
This means that amongst all possible pairwise record comparisons, one in 4,195.51 are expected to match.  With 25,000,000 total possible comparisons, we expect a total of around 5,958.75 matching pairs
----- Estimating u probabilities using random sampling -----
/Users/rosskennedy/splink_demos/venv/lib/python3.9/site-packages/ipykernel/comm/comm.py:79: DeprecationWarning: The `ipykernel.comm.Comm` class has been deprecated. Please use the `comm` module instead.For creating comms, use the function `from comm import create_comm`.
  warn(
/Users/rosskennedy/splink_demos/venv/lib/python3.9/site-packages/ipykernel/comm/comm.py:79: DeprecationWarning: The `ipykernel.comm.Comm` class has been deprecated. Please use the `comm` module instead.For creating comms, use the function `from comm import create_comm`.
  warn(
/Users/rosskennedy/splink_demos/venv/lib/python3.9/site-packages/ipykernel/comm/comm.py:79: DeprecationWarning: The `ipykernel.comm.Comm` class has been deprecated. Please use the `comm` module instead.For creating comms, use the function `from comm import create_comm`.
  warn(
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea ">
<pre>
<code>FloatProgress(value=0.0, layout=Layout(width=&#39;100%&#39;), style=ProgressStyle(bar_color=&#39;black&#39;))</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>
Estimated u probabilities using random sampling

Your model is not yet fully trained. Missing estimates for:
    - Full name (no m values are trained).
    - Date of birth (no m values are trained).
    - Social security ID (no m values are trained).
    - Street number (no m values are trained).
    - Postcode (no m values are trained).

----- Starting EM training session -----

Estimating the m probabilities of the model by blocking on:
l.date_of_birth = r.date_of_birth

Parameter estimates will be made for the following comparison(s):
    - Full name
    - Social security ID
    - Street number
    - Postcode

Parameter estimates cannot be made for the following comparison(s) since they are used in the blocking rules: 
    - Date of birth

Iteration 1: Largest change in params was -0.484 in the m_probability of Full name, level `Exact match`
Iteration 2: Largest change in params was 0.00197 in probability_two_random_records_match
Iteration 3: Largest change in params was 8.25e-06 in probability_two_random_records_match

EM converged after 3 iterations

Your model is not yet fully trained. Missing estimates for:
    - Date of birth (no m values are trained).

----- Starting EM training session -----

Estimating the m probabilities of the model by blocking on:
l.postcode = r.postcode

Parameter estimates will be made for the following comparison(s):
    - Full name
    - Date of birth
    - Social security ID
    - Street number

Parameter estimates cannot be made for the following comparison(s) since they are used in the blocking rules: 
    - Postcode

Iteration 1: Largest change in params was 0.0333 in the m_probability of Date of birth, level `All other comparisons`
Iteration 2: Largest change in params was 0.000447 in the m_probability of Date of birth, level `All other comparisons`
Iteration 3: Largest change in params was 1.09e-05 in the m_probability of Social security ID, level `All other comparisons`

EM converged after 3 iterations

Your model is fully trained. All comparisons have at least one estimate for their m and u values
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="c1"># linker_advanced.parameter_estimate_comparisons_chart()</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker_advanced</span><span class="o">.</span><span class="n">match_weights_chart</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>&lt;VegaLite 4 object&gt;

If you see this message, it means the renderer has not been properly enabled
for the frontend that you are using. For more information, see
https://altair-viz.github.io/user_guide/troubleshooting.html
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">predictions_adv</span> <span class="o">=</span> <span class="n">linker_advanced</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">df_predictions_adv</span> <span class="o">=</span> <span class="n">predictions_adv</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">()</span>
<span class="n">clusters_adv</span> <span class="o">=</span> <span class="n">linker_advanced</span><span class="o">.</span><span class="n">cluster_pairwise_predictions_at_threshold</span><span class="p">(</span><span class="n">predictions_adv</span><span class="p">,</span> <span class="n">threshold_match_probability</span><span class="o">=</span><span class="mf">0.99</span><span class="p">)</span>
<span class="n">df_clusters_adv</span> <span class="o">=</span> <span class="n">clusters_adv</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">)</span>
<span class="n">df_clusters_adv</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cluster_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>Completed iteration 1, root rows count 0
</code>
</pre>
</div>
</div>
<div class="output_area">
<div class="output_text output_subarea output_execute_result">
<pre>
<code>2    4970
1      60
Name: count, dtype: int64</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a pretty modest improvement on our previous model - however it is worth re-iterating that we should not necessarily expect to recover <em>all</em> matches, as in several cases it may be unreasonable for a model to have reasonable confidence that two records refer to the same entity.</p>
<p>If we wished to improve matters we could iterate on this process - investigating where our model is not performing as we would hope, and seeing how we can adjust these areas to address these shortcomings.</p>
</div>
</div>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="example_febrl3.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Febrl3 Dedupe" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Febrl3 Dedupe
              </div>
            </div>
          </a>
        
        
          
          <a href="example_simple_pyspark.html" class="md-footer__link md-footer__link--next" aria-label="Next: Deduplication using Pyspark" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Deduplication using Pyspark
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "search.highlight", "search.share", "search.suggest", "navigation.footer"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>