
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="example_febrl4.html">
      
      
        <link rel="next" href="../topic_guides/backends.html">
      
      <link rel="icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.15">
    
    
      
        <title>Deduplication using Pyspark - Splink</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/custom.css">
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#linking-in-spark" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Splink" class="md-header__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../img/favicon.ico" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Splink
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Deduplication using Pyspark
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="purple" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Splink" class="md-nav__button md-logo" aria-label="Splink" data-md-component="logo">
      
  <img src="../img/favicon.ico" alt="logo">

    </a>
    Splink
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/moj-analytical-services/splink" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installations.html" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="00_Tutorial_Introduction.html" class="md-nav__link">
        0. Tutorial introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="01_Prerequisites.html" class="md-nav__link">
        1. Data prep prerequisites
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="02_Exploratory_analysis.html" class="md-nav__link">
        2. Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="03_Blocking.html" class="md-nav__link">
        3. Blocking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="04_Estimating_model_parameters.html" class="md-nav__link">
        4. Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="05_Predicting_results.html" class="md-nav__link">
        5. Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="06_Visualising_predictions.html" class="md-nav__link">
        6. Visualising predictions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="07_Quality_assurance.html" class="md-nav__link">
        7. Quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples_index.html" class="md-nav__link">
        Examples index
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          DuckDB
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          DuckDB
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_deduplicate_50k_synthetic.html" class="md-nav__link">
        Deduplicate 50k rows historical persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_transactions.html" class="md-nav__link">
        Linking financial transactions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_link_only.html" class="md-nav__link">
        Linking two tables of persons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_real_time_record_linkage.html" class="md-nav__link">
        Real time record linkage
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_accuracy_analysis_from_labels_column.html" class="md-nav__link">
        QA from ground truth column
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_pairwise_labels.html" class="md-nav__link">
        Estimating m probabilities from labels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_quick_and_dirty_persons.html" class="md-nav__link">
        Quick and dirty persons model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_febrl3.html" class="md-nav__link">
        Febrl3 Dedupe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="example_febrl4.html" class="md-nav__link">
        Febrl4 link-only
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          PySpark
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          PySpark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Deduplication using Pyspark
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="example_simple_pyspark.html" class="md-nav__link md-nav__link--active">
        Deduplication using Pyspark
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linking-in-spark" class="md-nav__link">
    Linking in Spark
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Topic Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Topic Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/backends.html" class="md-nav__link">
        Splink's SQL backends - Spark, DuckDB etc
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/link_type.html" class="md-nav__link">
        Link type - linking vs deduping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/querying_splink_results.html" class="md-nav__link">
        Retrieving and querying Splink results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/feature_engineering.html" class="md-nav__link">
        Feature Engineering
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
          Comparing Records
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          Comparing Records
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/customising_comparisons.html" class="md-nav__link">
        Defining and customising comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/comparison_templates.html" class="md-nav__link">
        Out-of-the-box comparisons
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5_3" id="__nav_5_5_3_label" tabindex="0">
          Comparing strings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5_3">
          <span class="md-nav__icon md-icon"></span>
          Comparing strings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/choosing_comparators.html" class="md-nav__link">
        Choosing comparators and thresholds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/comparators.html" class="md-nav__link">
        String comparators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/phonetic.html" class="md-nav__link">
        Phonetic transformations
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/term-frequency.html" class="md-nav__link">
        Term-Frequency adjustments
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" >
      
      
      
        <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="0">
          Performance
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_6">
          <span class="md-nav__icon md-icon"></span>
          Performance
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/drivers_of_performance.html" class="md-nav__link">
        Run times, performance and linking large data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/blocking_rules.html" class="md-nav__link">
        Blocking rules for prediction vs estimation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/optimising_spark.html" class="md-nav__link">
        Optimising Spark performance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../topic_guides/salting.html" class="md-nav__link">
        Salting blocking rules
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_1" >
      
      
      
        <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
          Linker API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Linker API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linker.html" class="md-nav__link">
        Full API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerexp.html" class="md-nav__link">
        Exploratory analysis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerest.html" class="md-nav__link">
        Estimating model parameters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerpred.html" class="md-nav__link">
        Predicting results
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../linkerqa.html" class="md-nav__link">
        Visualisation and quality assurance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../em_training_session.html" class="md-nav__link">
        EM Training Session API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../SplinkDataFrame.html" class="md-nav__link">
        SplinkDataFrame API
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_4" >
      
      
      
        <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
          Comparisons API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_4">
          <span class="md-nav__icon md-icon"></span>
          Comparisons API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison.html" class="md-nav__link">
        Comparison
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level.html" class="md-nav__link">
        Comparison Level
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6_5" >
      
      
      
        <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
          Comparisons Library API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6_5">
          <span class="md-nav__icon md-icon"></span>
          Comparisons Library API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_library.html" class="md-nav__link">
        Comparison Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_template_library.html" class="md-nav__link">
        Comparison Template Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level_library.html" class="md-nav__link">
        Comparison Level Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../comparison_level_composition.html" class="md-nav__link">
        Comparison Composition
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../settingseditor/editor.html" class="md-nav__link">
        Settings Editor
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../settings_dict_guide.html" class="md-nav__link">
        Settings dictionary reference
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
      
      
      
        <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
          Developers' guides
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Developers' guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_1" >
      
      
      
        <label class="md-nav__link" for="__nav_9_1" id="__nav_9_1_label" tabindex="0">
          Making Changes to Splink
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_1">
          <span class="md-nav__icon md-icon"></span>
          Making Changes to Splink
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/building_env_locally.html" class="md-nav__link">
        Building a Virtual Environment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/lint.html" class="md-nav__link">
        Linting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/build_docs_locally.html" class="md-nav__link">
        Building Docs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/testing.html" class="md-nav__link">
        Testing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/changing_splink/releases.html" class="md-nav__link">
        Releasing a Package Version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/caching.html" class="md-nav__link">
        Caching and pipelining
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/debug_modes.html" class="md-nav__link">
        Understanding and debugging Splink
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/spark_pipelining_and_caching.html" class="md-nav__link">
        Spark caching
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/transpilation.html" class="md-nav__link">
        Transpilation using sqlglot
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9_6" >
      
      
      
        <label class="md-nav__link" for="__nav_9_6" id="__nav_9_6_label" tabindex="0">
          Comparisons and comparison levels
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_9_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_9_6">
          <span class="md-nav__icon md-icon"></span>
          Comparisons and comparison levels
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/comparisons/new_library_comparisons_and_levels.html" class="md-nav__link">
        Creating new comparisons and comparison levels
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/comparisons/extending_library_comparisons_and_levels.html" class="md-nav__link">
        Extending existing comparisons and comparison levels
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dev_guides/udfs.html" class="md-nav__link">
        User-Defined Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#linking-in-spark" class="md-nav__link">
    Linking in Spark
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  
  



  
  


  <h1>Deduplication using Pyspark</h1>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script>
(function() {
  function addWidgetsRenderer() {
    var requireJsScript = document.createElement('script');
    requireJsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js';

    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var jupyterWidgetsScript = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    jupyterWidgetsScript.src = widgetRendererSrc;

    document.body.appendChild(requireJsScript);
    document.body.appendChild(jupyterWidgetsScript);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script>

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="linking-in-spark">Linking in Spark<a class="headerlink" href="#linking-in-spark" title="Permanent link">&para;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splink.spark.jar_location</span> <span class="kn">import</span> <span class="n">similarity_jar_location</span>

<span class="kn">from</span> <span class="nn">pyspark</span> <span class="kn">import</span> <span class="n">SparkContext</span><span class="p">,</span> <span class="n">SparkConf</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">types</span>

<span class="n">conf</span> <span class="o">=</span> <span class="n">SparkConf</span><span class="p">()</span>
<span class="c1"># This parallelism setting is only suitable for a small toy example</span>
<span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.driver.memory&quot;</span><span class="p">,</span> <span class="s2">&quot;12g&quot;</span><span class="p">)</span>
<span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.default.parallelism&quot;</span><span class="p">,</span> <span class="s2">&quot;16&quot;</span><span class="p">)</span>


<span class="c1"># Add custom similarity functions, which are bundled with Splink</span>
<span class="c1"># documented here: https://github.com/moj-analytical-services/splink_scalaudfs</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">similarity_jar_location</span><span class="p">()</span>
<span class="n">conf</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;spark.jars&quot;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="n">sc</span> <span class="o">=</span> <span class="n">SparkContext</span><span class="o">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">conf</span><span class="o">=</span><span class="n">conf</span><span class="p">)</span>

<span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="n">spark</span><span class="o">.</span><span class="n">sparkContext</span><span class="o">.</span><span class="n">setCheckpointDir</span><span class="p">(</span><span class="s2">&quot;./tmp_checkpoints&quot;</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>23/05/04 09:25:04 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
Using Spark&#39;s default log4j profile: org/apache/spark/log4j-defaults.properties
Setting default log level to &#34;WARN&#34;.
To adjust logging level use sc.setLogLevel(newLevel). For SparkR, use setLogLevel(newLevel).
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;./data/fake_1000.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">splink.spark.spark_comparison_library</span> <span class="k">as</span> <span class="nn">cl</span>
<span class="kn">import</span> <span class="nn">splink.spark.spark_comparison_template_library</span> <span class="k">as</span> <span class="nn">ctl</span>

<span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;link_type&quot;</span><span class="p">:</span> <span class="s2">&quot;dedupe_only&quot;</span><span class="p">,</span>
    <span class="s2">&quot;comparisons&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="n">ctl</span><span class="o">.</span><span class="n">name_comparison</span><span class="p">(</span><span class="s2">&quot;first_name&quot;</span><span class="p">),</span>
        <span class="n">ctl</span><span class="o">.</span><span class="n">name_comparison</span><span class="p">(</span><span class="s2">&quot;surname&quot;</span><span class="p">),</span>
        <span class="n">ctl</span><span class="o">.</span><span class="n">date_comparison</span><span class="p">(</span><span class="s2">&quot;dob&quot;</span><span class="p">,</span> <span class="n">cast_strings_to_date</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">exact_match</span><span class="p">(</span><span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="n">term_frequency_adjustments</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
        <span class="n">cl</span><span class="o">.</span><span class="n">levenshtein_at_thresholds</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="s2">&quot;blocking_rules_to_generate_predictions&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;l.first_name = r.first_name&quot;</span><span class="p">,</span>
        <span class="s2">&quot;l.surname = r.surname&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;retain_matching_columns&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;retain_intermediate_calculation_columns&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="s2">&quot;em_convergence&quot;</span><span class="p">:</span> <span class="mf">0.01</span>
<span class="p">}</span>
</code></pre></div>

</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">splink.spark.spark_linker</span> <span class="kn">import</span> <span class="n">SparkLinker</span>
<span class="n">linker</span> <span class="o">=</span> <span class="n">SparkLinker</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>
<span class="n">deterministic_rules</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;l.first_name = r.first_name and levenshtein(r.dob, l.dob) &lt;= 1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.surname = r.surname and levenshtein(r.dob, l.dob) &lt;= 1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.first_name = r.first_name and levenshtein(r.surname, l.surname) &lt;= 2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;l.email = r.email&quot;</span>
<span class="p">]</span>

<span class="n">linker</span><span class="o">.</span><span class="n">estimate_probability_two_random_records_match</span><span class="p">(</span><span class="n">deterministic_rules</span><span class="p">,</span> <span class="n">recall</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>--WARN-- 
 You are using datediff comparison
                        with str-casting and ANSI is not enabled. Bad dates
                        e.g. 1999-13-54 will not trigger an exception but will
                        classed as comparison level = &#34;ELSE&#34;. Ensure date strings
                        are cleaned to remove bad dates 

Probability two random records match is estimated to be  0.00389.
This means that amongst all possible pairwise record comparisons, one in 257.25 are expected to match.  With 499,500 total possible comparisons, we expect a total of around 1,941.67 matching pairs
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">linker</span><span class="o">.</span><span class="n">estimate_u_using_random_sampling</span><span class="p">(</span><span class="n">max_pairs</span><span class="o">=</span><span class="mf">5e5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>----- Estimating u probabilities using random sampling -----
23/05/04 09:25:17 WARN DataSource: All paths were ignored:                      
  file:/Users/rosskennedy/splink_demos/tmp_checkpoints/4a3d6387-4dc2-4a2b-8726-37954ed09b3a/__splink__df_concat_with_tf_d4ce2bbdc

Estimated u probabilities using random sampling

Your model is not yet fully trained. Missing estimates for:
    - first_name (no m values are trained).
    - surname (no m values are trained).
    - dob (no m values are trained).
    - city (no m values are trained).
    - email (no m values are trained).
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">training_blocking_rule</span> <span class="o">=</span> <span class="s2">&quot;l.first_name = r.first_name and l.surname = r.surname&quot;</span>
<span class="n">training_session_fname_sname</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span><span class="n">training_blocking_rule</span><span class="p">)</span>

<span class="n">training_blocking_rule</span> <span class="o">=</span> <span class="s2">&quot;l.dob = r.dob&quot;</span>
<span class="n">training_session_dob</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">estimate_parameters_using_expectation_maximisation</span><span class="p">(</span><span class="n">training_blocking_rule</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>
----- Starting EM training session -----

Estimating the m probabilities of the model by blocking on:
l.first_name = r.first_name and l.surname = r.surname

Parameter estimates will be made for the following comparison(s):
    - dob
    - city
    - email

Parameter estimates cannot be made for the following comparison(s) since they are used in the blocking rules: 
    - first_name
    - surname
23/05/04 09:25:26 WARN DataSource: All paths were ignored:                      
  file:/Users/rosskennedy/splink_demos/tmp_checkpoints/4a3d6387-4dc2-4a2b-8726-37954ed09b3a/__splink__df_comparison_vectors_90769078f

Iteration 1: Largest change in params was -0.539 in the m_probability of dob, level `Exact match`
Iteration 2: Largest change in params was 0.0385 in probability_two_random_records_match
Iteration 3: Largest change in params was 0.00854 in probability_two_random_records_match

EM converged after 3 iterations

Your model is not yet fully trained. Missing estimates for:
    - first_name (no m values are trained).
    - surname (no m values are trained).

----- Starting EM training session -----

Estimating the m probabilities of the model by blocking on:
l.dob = r.dob

Parameter estimates will be made for the following comparison(s):
    - first_name
    - surname
    - city
    - email

Parameter estimates cannot be made for the following comparison(s) since they are used in the blocking rules: 
    - dob
23/05/04 09:25:32 WARN DataSource: All paths were ignored:                      
  file:/Users/rosskennedy/splink_demos/tmp_checkpoints/4a3d6387-4dc2-4a2b-8726-37954ed09b3a/__splink__df_comparison_vectors_035f39cb5

Iteration 1: Largest change in params was -0.395 in the m_probability of surname, level `Exact match surname`
Iteration 2: Largest change in params was 0.121 in probability_two_random_records_match
Iteration 3: Largest change in params was 0.0383 in probability_two_random_records_match
Iteration 4: Largest change in params was 0.0151 in probability_two_random_records_match
Iteration 5: Largest change in params was 0.00715 in probability_two_random_records_match

EM converged after 5 iterations

Your model is fully trained. All comparisons have at least one estimate for their m and u values
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">results</span> <span class="o">=</span> <span class="n">linker</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">threshold_match_probability</span><span class="o">=</span><span class="mf">0.9</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_subarea output_stream output_stderr output_text">
<pre>
<code>23/05/04 09:25:42 WARN package: Truncated the string representation of a plan since it was too large. This behavior can be adjusted by setting &#39;spark.sql.debug.maxToStringFields&#39;.
23/05/04 09:25:43 ERROR CodeGenerator: failed to compile: org.codehaus.janino.InternalCompilerException: Compiling &#34;GeneratedClass&#34; in &#34;generated.java&#34;: Code of method &#34;bhj_doConsume_0$(Lorg/apache/spark/sql/catalyst/expressions/GeneratedClass$GeneratedIteratorForCodegenStage3;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZDZ)V&#34; of class &#34;org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage3&#34; grows beyond 64 KB
org.codehaus.janino.InternalCompilerException: Compiling &#34;GeneratedClass&#34; in &#34;generated.java&#34;: Code of method &#34;bhj_doConsume_0$(Lorg/apache/spark/sql/catalyst/expressions/GeneratedClass$GeneratedIteratorForCodegenStage3;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZDZ)V&#34; of class &#34;org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage3&#34; grows beyond 64 KB
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:366)
    at org.codehaus.janino.UnitCompiler.access$000(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$1.visitCompilationUnit(UnitCompiler.java:336)
    at org.codehaus.janino.UnitCompiler$1.visitCompilationUnit(UnitCompiler.java:333)
    at org.codehaus.janino.Java$CompilationUnit.accept(Java.java:363)
    at org.codehaus.janino.UnitCompiler.compileUnit(UnitCompiler.java:333)
    at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:235)
    at org.codehaus.janino.SimpleCompiler.compileToClassLoader(SimpleCompiler.java:464)
    at org.codehaus.janino.ClassBodyEvaluator.compileToClass(ClassBodyEvaluator.java:314)
    at org.codehaus.janino.ClassBodyEvaluator.cook(ClassBodyEvaluator.java:237)
    at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:205)
    at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:80)
    at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$.org$apache$spark$sql$catalyst$expressions$codegen$CodeGenerator$$doCompile(CodeGenerator.scala:1489)
    at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$$anon$1.load(CodeGenerator.scala:1586)
    at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$$anon$1.load(CodeGenerator.scala:1583)
    at org.sparkproject.guava.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3599)
    at org.sparkproject.guava.cache.LocalCache$Segment.loadSync(LocalCache.java:2379)
    at org.sparkproject.guava.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2342)
    at org.sparkproject.guava.cache.LocalCache$Segment.get(LocalCache.java:2257)
    at org.sparkproject.guava.cache.LocalCache.get(LocalCache.java:4000)
    at org.sparkproject.guava.cache.LocalCache.getOrLoad(LocalCache.java:4004)
    at org.sparkproject.guava.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4874)
    at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$.compile(CodeGenerator.scala:1436)
    at org.apache.spark.sql.execution.WholeStageCodegenExec.liftedTree1$1(WholeStageCodegenExec.scala:725)
    at org.apache.spark.sql.execution.WholeStageCodegenExec.doExecute(WholeStageCodegenExec.scala:724)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$execute$1(SparkPlan.scala:184)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
    at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
    at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
    at org.apache.spark.sql.execution.SparkPlan.execute(SparkPlan.scala:180)
    at org.apache.spark.sql.execution.UnionExec.$anonfun$doExecute$5(basicPhysicalOperators.scala:698)
    at scala.collection.TraversableLike.$anonfun$map$1(TraversableLike.scala:286)
    at scala.collection.Iterator.foreach(Iterator.scala:943)
    at scala.collection.Iterator.foreach$(Iterator.scala:943)
    at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
    at scala.collection.IterableLike.foreach(IterableLike.scala:74)
    at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
    at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
    at scala.collection.TraversableLike.map(TraversableLike.scala:286)
    at scala.collection.TraversableLike.map$(TraversableLike.scala:279)
    at scala.collection.AbstractTraversable.map(Traversable.scala:108)
    at org.apache.spark.sql.execution.UnionExec.doExecute(basicPhysicalOperators.scala:698)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$execute$1(SparkPlan.scala:184)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
    at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
    at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
    at org.apache.spark.sql.execution.SparkPlan.execute(SparkPlan.scala:180)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.inputRDD$lzycompute(ShuffleExchangeExec.scala:135)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.inputRDD(ShuffleExchangeExec.scala:135)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.mapOutputStatisticsFuture$lzycompute(ShuffleExchangeExec.scala:140)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.mapOutputStatisticsFuture(ShuffleExchangeExec.scala:139)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.$anonfun$submitShuffleJob$1(ShuffleExchangeExec.scala:68)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
    at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
    at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.submitShuffleJob(ShuffleExchangeExec.scala:68)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.submitShuffleJob$(ShuffleExchangeExec.scala:67)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.submitShuffleJob(ShuffleExchangeExec.scala:115)
    at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.shuffleFuture$lzycompute(QueryStageExec.scala:170)
    at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.shuffleFuture(QueryStageExec.scala:170)
    at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.doMaterialize(QueryStageExec.scala:172)
    at org.apache.spark.sql.execution.adaptive.QueryStageExec.materialize(QueryStageExec.scala:82)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$5(AdaptiveSparkPlanExec.scala:256)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$5$adapted(AdaptiveSparkPlanExec.scala:254)
    at scala.collection.immutable.List.foreach(List.scala:431)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$1(AdaptiveSparkPlanExec.scala:254)
    at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:775)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.getFinalPhysicalPlan(AdaptiveSparkPlanExec.scala:226)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.withFinalPlanUpdate(AdaptiveSparkPlanExec.scala:365)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.doExecute(AdaptiveSparkPlanExec.scala:350)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$execute$1(SparkPlan.scala:184)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
    at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
    at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
    at org.apache.spark.sql.execution.SparkPlan.execute(SparkPlan.scala:180)
    at org.apache.spark.sql.execution.datasources.FileFormatWriter$.write(FileFormatWriter.scala:186)
    at org.apache.spark.sql.execution.datasources.InsertIntoHadoopFsRelationCommand.run(InsertIntoHadoopFsRelationCommand.scala:186)
    at org.apache.spark.sql.execution.command.DataWritingCommandExec.sideEffectResult$lzycompute(commands.scala:113)
    at org.apache.spark.sql.execution.command.DataWritingCommandExec.sideEffectResult(commands.scala:111)
    at org.apache.spark.sql.execution.command.DataWritingCommandExec.executeCollect(commands.scala:125)
    at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.$anonfun$applyOrElse$1(QueryExecution.scala:110)
    at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$5(SQLExecution.scala:103)
    at org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:163)
    at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:90)
    at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:775)
    at org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)
    at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.applyOrElse(QueryExecution.scala:110)
    at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.applyOrElse(QueryExecution.scala:106)
    at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformDownWithPruning$1(TreeNode.scala:481)
    at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:82)
    at org.apache.spark.sql.catalyst.trees.TreeNode.transformDownWithPruning(TreeNode.scala:481)
    at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.org$apache$spark$sql$catalyst$plans$logical$AnalysisHelper$$super$transformDownWithPruning(LogicalPlan.scala:30)
    at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.transformDownWithPruning(AnalysisHelper.scala:267)
    at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.transformDownWithPruning$(AnalysisHelper.scala:263)
    at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.transformDownWithPruning(LogicalPlan.scala:30)
    at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.transformDownWithPruning(LogicalPlan.scala:30)
    at org.apache.spark.sql.catalyst.trees.TreeNode.transformDown(TreeNode.scala:457)
    at org.apache.spark.sql.execution.QueryExecution.eagerlyExecuteCommands(QueryExecution.scala:106)
    at org.apache.spark.sql.execution.QueryExecution.commandExecuted$lzycompute(QueryExecution.scala:93)
    at org.apache.spark.sql.execution.QueryExecution.commandExecuted(QueryExecution.scala:91)
    at org.apache.spark.sql.execution.QueryExecution.assertCommandExecuted(QueryExecution.scala:128)
    at org.apache.spark.sql.DataFrameWriter.runCommand(DataFrameWriter.scala:848)
    at org.apache.spark.sql.DataFrameWriter.saveToV1Source(DataFrameWriter.scala:382)
    at org.apache.spark.sql.DataFrameWriter.saveInternal(DataFrameWriter.scala:355)
    at org.apache.spark.sql.DataFrameWriter.save(DataFrameWriter.scala:239)
    at org.apache.spark.sql.DataFrameWriter.parquet(DataFrameWriter.scala:781)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
    at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)
    at py4j.Gateway.invoke(Gateway.java:282)
    at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
    at py4j.commands.CallCommand.execute(CallCommand.java:79)
    at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
    at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
    at java.lang.Thread.run(Thread.java:750)
Caused by: org.codehaus.janino.InternalCompilerException: Code of method &#34;bhj_doConsume_0$(Lorg/apache/spark/sql/catalyst/expressions/GeneratedClass$GeneratedIteratorForCodegenStage3;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZDZ)V&#34; of class &#34;org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage3&#34; grows beyond 64 KB
    at org.codehaus.janino.CodeContext.makeSpace(CodeContext.java:1051)
    at org.codehaus.janino.CodeContext.write(CodeContext.java:932)
    at org.codehaus.janino.UnitCompiler.writeOpcode(UnitCompiler.java:12101)
    at org.codehaus.janino.UnitCompiler.pushConstant(UnitCompiler.java:10688)
    at org.codehaus.janino.UnitCompiler.compileGet2(UnitCompiler.java:5661)
    at org.codehaus.janino.UnitCompiler.access$9300(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$16.visitIntegerLiteral(UnitCompiler.java:4484)
    at org.codehaus.janino.UnitCompiler$16.visitIntegerLiteral(UnitCompiler.java:4455)
    at org.codehaus.janino.Java$IntegerLiteral.accept(Java.java:5763)
    at org.codehaus.janino.UnitCompiler.compileGet(UnitCompiler.java:4455)
    at org.codehaus.janino.UnitCompiler.fakeCompile(UnitCompiler.java:3766)
    at org.codehaus.janino.UnitCompiler.compileGetValue(UnitCompiler.java:5677)
    at org.codehaus.janino.UnitCompiler.compileArithmeticOperation(UnitCompiler.java:7804)
    at org.codehaus.janino.UnitCompiler.compileGet2(UnitCompiler.java:5001)
    at org.codehaus.janino.UnitCompiler.access$8500(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$16.visitBinaryOperation(UnitCompiler.java:4476)
    at org.codehaus.janino.UnitCompiler$16.visitBinaryOperation(UnitCompiler.java:4455)
    at org.codehaus.janino.Java$BinaryOperation.accept(Java.java:5077)
    at org.codehaus.janino.UnitCompiler.compileGet(UnitCompiler.java:4455)
    at org.codehaus.janino.UnitCompiler.compileGetValue(UnitCompiler.java:5683)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:3839)
    at org.codehaus.janino.UnitCompiler.access$6100(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$13.visitAssignment(UnitCompiler.java:3799)
    at org.codehaus.janino.UnitCompiler$13.visitAssignment(UnitCompiler.java:3779)
    at org.codehaus.janino.Java$Assignment.accept(Java.java:4690)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:3779)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2366)
    at org.codehaus.janino.UnitCompiler.access$1800(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitExpressionStatement(UnitCompiler.java:1497)
    at org.codehaus.janino.UnitCompiler$6.visitExpressionStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$ExpressionStatement.accept(Java.java:3064)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.access$3700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$7.compile(UnitCompiler.java:2751)
    at org.codehaus.janino.UnitCompiler.compileTryCatch(UnitCompiler.java:3092)
    at org.codehaus.janino.UnitCompiler.compileTryCatchFinally(UnitCompiler.java:2969)
    at org.codehaus.janino.UnitCompiler.compileTryCatchFinallyWithResources(UnitCompiler.java:2773)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2745)
    at org.codehaus.janino.UnitCompiler.access$2300(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitTryStatement(UnitCompiler.java:1502)
    at org.codehaus.janino.UnitCompiler$6.visitTryStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$TryStatement.accept(Java.java:3433)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2486)
    at org.codehaus.janino.UnitCompiler.access$1900(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1498)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$IfStatement.accept(Java.java:3140)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2443)
    at org.codehaus.janino.UnitCompiler.access$1900(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1498)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$IfStatement.accept(Java.java:3140)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1598)
    at org.codehaus.janino.UnitCompiler.access$2600(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitDoStatement(UnitCompiler.java:1505)
    at org.codehaus.janino.UnitCompiler$6.visitDoStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$DoStatement.accept(Java.java:3664)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1598)
    at org.codehaus.janino.UnitCompiler.access$2600(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitDoStatement(UnitCompiler.java:1505)
    at org.codehaus.janino.UnitCompiler$6.visitDoStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$DoStatement.accept(Java.java:3664)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2486)
    at org.codehaus.janino.UnitCompiler.access$1900(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1498)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$IfStatement.accept(Java.java:3140)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1848)
    at org.codehaus.janino.UnitCompiler.access$2200(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitWhileStatement(UnitCompiler.java:1501)
    at org.codehaus.janino.UnitCompiler$6.visitWhileStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$WhileStatement.accept(Java.java:3245)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2486)
    at org.codehaus.janino.UnitCompiler.access$1900(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1498)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$IfStatement.accept(Java.java:3140)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:3420)
    at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1362)
    at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1335)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:807)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:975)
    at org.codehaus.janino.UnitCompiler.access$700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$2.visitMemberClassDeclaration(UnitCompiler.java:392)
    at org.codehaus.janino.UnitCompiler$2.visitMemberClassDeclaration(UnitCompiler.java:384)
    at org.codehaus.janino.Java$MemberClassDeclaration.accept(Java.java:1445)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:384)
    at org.codehaus.janino.UnitCompiler.compileDeclaredMemberTypes(UnitCompiler.java:1312)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:833)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:410)
    at org.codehaus.janino.UnitCompiler.access$400(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:389)
    at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:384)
    at org.codehaus.janino.Java$PackageMemberClassDeclaration.accept(Java.java:1594)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:384)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:362)
    ... 117 more
23/05/04 09:25:43 WARN WholeStageCodegenExec: Whole-stage codegen disabled for plan (id=3):
 *(3) Project [CASE WHEN CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN false ELSE false END THEN Infinity ELSE LOG2(cast(cast((((((CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN true WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.003902390004522083 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.3365268364360054 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.27677318122666966 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN true ELSE false END THEN 0.1990847971311897 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE true END THEN 0.0010900609336073567 END * CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN true WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END) * CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN true WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 0.45896561950688874 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 1.0 END) * CASE WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN true WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN true WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 256.78780963847476 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN true WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 236.76780078519445 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN true ELSE false END THEN 207.73789452299874 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE true END THEN 0.13449069645050282 END) as string) as double)) END AS match_weight#1530, CASE WHEN CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN false ELSE false END THEN 1.0 ELSE (CASE WHEN CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN false ELSE false END THEN Infinity ELSE cast(cast((((((CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN true WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.003902390004522083 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.3365268364360054 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.27677318122666966 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN true ELSE false END THEN 0.1990847971311897 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE true END THEN 0.0010900609336073567 END * CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN true WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END) * CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN true WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 0.45896561950688874 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 1.0 END) * CASE WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN true WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN true WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 256.78780963847476 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN true WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 236.76780078519445 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN true ELSE false END THEN 207.73789452299874 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE true END THEN 0.13449069645050282 END) as string) as double) END / CASE WHEN CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN false ELSE false END THEN Infinity ELSE (1.0 + cast(cast((((((CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN true WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.003902390004522083 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.3365268364360054 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.27677318122666966 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN true ELSE false END THEN 0.1990847971311897 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE true END THEN 0.0010900609336073567 END * CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN true WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END) * CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN true WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 0.45896561950688874 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 1.0 END) * CASE WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN true WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN true WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 256.78780963847476 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN true WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 236.76780078519445 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN true ELSE false END THEN 207.73789452299874 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE true END THEN 0.13449069645050282 END) as string) as double)) END) END AS match_probability#1531, unique_id#334 AS unique_id_l#1532, unique_id#1645 AS unique_id_r#1533, first_name#335 AS first_name_l#1534, first_name#1646 AS first_name_r#1535, CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN -1 WHEN (first_name#335 = first_name#1646) THEN 3 WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN 2 WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN 1 ELSE 0 END AS gamma_first_name#1562, CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN true WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 86.2360850776162 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 70.92401859013204 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN true ELSE false END THEN 51.01612009575941 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE true END THEN 0.2793316230167143 END AS bf_first_name#1567, surname#336 AS surname_l#1536, surname#1647 AS surname_r#1537, CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN -1 WHEN (surname#336 = surname#1647) THEN 3 WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN 2 WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN 1 ELSE 0 END AS gamma_surname#1563, CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN true WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END AS bf_surname#1568, dob#337 AS dob_l#1538, dob#1648 AS dob_r#1539, CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN -1 WHEN (dob#337 = dob#1648) THEN 5 WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN 4 WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN 3 WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN 2 WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN 1 ELSE 0 END AS gamma_dob#1564, CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN true WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END AS bf_dob#1569, city#338 AS city_l#1540, city#1649 AS city_r#1541, CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN -1 WHEN (city#338 = city#1649) THEN 1 ELSE 0 END AS gamma_city#1565, tf_city#341 AS tf_city_l#1542, tf_city#1652 AS tf_city_r#1543, CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 0.45896561950688874 END AS bf_city#1570, CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 1.0 END AS bf_tf_adj_city#1571, email#339 AS email_l#1544, ... 4 more fields]
+- *(3) BroadcastHashJoin [first_name#335], [first_name#1646], Inner, BuildRight, ((unique_id#334 &lt; unique_id#1645) AND (CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN false ELSE false END OR (LOG2(cast(cast((((((CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN true WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.003902390004522083 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.3365268364360054 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE false END THEN 0.27677318122666966 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN true ELSE false END THEN 0.1990847971311897 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1646)) THEN false WHEN (first_name#335 = first_name#1646) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1646) &gt;= 0.88) THEN false ELSE true END THEN 0.0010900609336073567 END * CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN true WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1647)) THEN false WHEN (surname#336 = surname#1647) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1647) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END) * CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN true WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1648)) THEN false WHEN (dob#337 = dob#1648) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1648) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1648, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 0.45896561950688874 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN true WHEN (city#338 = city#1649) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1652)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1652) &gt;= coalesce(tf_city#1652, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1652) ELSE coalesce(tf_city#1652, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1649)) THEN false WHEN (city#338 = city#1649) THEN false ELSE true END THEN 1.0 END) * CASE WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN true WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN true WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 256.78780963847476 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN true WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE false END THEN 236.76780078519445 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN true ELSE false END THEN 207.73789452299874 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1650)) THEN false WHEN (email#339 = email#1650) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1650) &lt;= 2) THEN false ELSE true END THEN 0.13449069645050282 END) as string) as double)) &gt;= 3.1699250014423126))), false
   :- *(3) Filter (isnotnull(unique_id#334) AND isnotnull(first_name#335))
   :  +- *(3) ColumnarToRow
   :     +- FileScan parquet [unique_id#334,first_name#335,surname#336,dob#337,city#338,email#339,tf_city#341] Batched: true, DataFilters: [isnotnull(unique_id#334), isnotnull(first_name#335)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/Users/rosskennedy/splink_demos/tmp_checkpoints/4a3d6387-4dc2-4a2..., PartitionFilters: [], PushedFilters: [IsNotNull(unique_id), IsNotNull(first_name)], ReadSchema: struct&lt;unique_id:string,first_name:string,surname:string,dob:string,city:string,email:string,tf_c...
   +- BroadcastQueryStage 0
      +- BroadcastExchange HashedRelationBroadcastMode(List(input[1, string, false]),false), [id=#4847]
         +- *(1) Filter (isnotnull(unique_id#1645) AND isnotnull(first_name#1646))
            +- *(1) ColumnarToRow
               +- FileScan parquet [unique_id#1645,first_name#1646,surname#1647,dob#1648,city#1649,email#1650,tf_city#1652] Batched: true, DataFilters: [isnotnull(unique_id#1645), isnotnull(first_name#1646)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/Users/rosskennedy/splink_demos/tmp_checkpoints/4a3d6387-4dc2-4a2..., PartitionFilters: [], PushedFilters: [IsNotNull(unique_id), IsNotNull(first_name)], ReadSchema: struct&lt;unique_id:string,first_name:string,surname:string,dob:string,city:string,email:string,tf_c...

23/05/04 09:25:44 ERROR CodeGenerator: failed to compile: org.codehaus.janino.InternalCompilerException: Compiling &#34;GeneratedClass&#34; in &#34;generated.java&#34;: Code of method &#34;bhj_doConsume_0$(Lorg/apache/spark/sql/catalyst/expressions/GeneratedClass$GeneratedIteratorForCodegenStage4;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZDZ)V&#34; of class &#34;org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage4&#34; grows beyond 64 KB
org.codehaus.janino.InternalCompilerException: Compiling &#34;GeneratedClass&#34; in &#34;generated.java&#34;: Code of method &#34;bhj_doConsume_0$(Lorg/apache/spark/sql/catalyst/expressions/GeneratedClass$GeneratedIteratorForCodegenStage4;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZDZ)V&#34; of class &#34;org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage4&#34; grows beyond 64 KB
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:366)
    at org.codehaus.janino.UnitCompiler.access$000(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$1.visitCompilationUnit(UnitCompiler.java:336)
    at org.codehaus.janino.UnitCompiler$1.visitCompilationUnit(UnitCompiler.java:333)
    at org.codehaus.janino.Java$CompilationUnit.accept(Java.java:363)
    at org.codehaus.janino.UnitCompiler.compileUnit(UnitCompiler.java:333)
    at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:235)
    at org.codehaus.janino.SimpleCompiler.compileToClassLoader(SimpleCompiler.java:464)
    at org.codehaus.janino.ClassBodyEvaluator.compileToClass(ClassBodyEvaluator.java:314)
    at org.codehaus.janino.ClassBodyEvaluator.cook(ClassBodyEvaluator.java:237)
    at org.codehaus.janino.SimpleCompiler.cook(SimpleCompiler.java:205)
    at org.codehaus.commons.compiler.Cookable.cook(Cookable.java:80)
    at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$.org$apache$spark$sql$catalyst$expressions$codegen$CodeGenerator$$doCompile(CodeGenerator.scala:1489)
    at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$$anon$1.load(CodeGenerator.scala:1586)
    at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$$anon$1.load(CodeGenerator.scala:1583)
    at org.sparkproject.guava.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3599)
    at org.sparkproject.guava.cache.LocalCache$Segment.loadSync(LocalCache.java:2379)
    at org.sparkproject.guava.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2342)
    at org.sparkproject.guava.cache.LocalCache$Segment.get(LocalCache.java:2257)
    at org.sparkproject.guava.cache.LocalCache.get(LocalCache.java:4000)
    at org.sparkproject.guava.cache.LocalCache.getOrLoad(LocalCache.java:4004)
    at org.sparkproject.guava.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4874)
    at org.apache.spark.sql.catalyst.expressions.codegen.CodeGenerator$.compile(CodeGenerator.scala:1436)
    at org.apache.spark.sql.execution.WholeStageCodegenExec.liftedTree1$1(WholeStageCodegenExec.scala:725)
    at org.apache.spark.sql.execution.WholeStageCodegenExec.doExecute(WholeStageCodegenExec.scala:724)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$execute$1(SparkPlan.scala:184)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
    at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
    at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
    at org.apache.spark.sql.execution.SparkPlan.execute(SparkPlan.scala:180)
    at org.apache.spark.sql.execution.UnionExec.$anonfun$doExecute$5(basicPhysicalOperators.scala:698)
    at scala.collection.TraversableLike.$anonfun$map$1(TraversableLike.scala:286)
    at scala.collection.Iterator.foreach(Iterator.scala:943)
    at scala.collection.Iterator.foreach$(Iterator.scala:943)
    at scala.collection.AbstractIterator.foreach(Iterator.scala:1431)
    at scala.collection.IterableLike.foreach(IterableLike.scala:74)
    at scala.collection.IterableLike.foreach$(IterableLike.scala:73)
    at scala.collection.AbstractIterable.foreach(Iterable.scala:56)
    at scala.collection.TraversableLike.map(TraversableLike.scala:286)
    at scala.collection.TraversableLike.map$(TraversableLike.scala:279)
    at scala.collection.AbstractTraversable.map(Traversable.scala:108)
    at org.apache.spark.sql.execution.UnionExec.doExecute(basicPhysicalOperators.scala:698)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$execute$1(SparkPlan.scala:184)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
    at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
    at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
    at org.apache.spark.sql.execution.SparkPlan.execute(SparkPlan.scala:180)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.inputRDD$lzycompute(ShuffleExchangeExec.scala:135)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.inputRDD(ShuffleExchangeExec.scala:135)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.mapOutputStatisticsFuture$lzycompute(ShuffleExchangeExec.scala:140)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.mapOutputStatisticsFuture(ShuffleExchangeExec.scala:139)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.$anonfun$submitShuffleJob$1(ShuffleExchangeExec.scala:68)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
    at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
    at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.submitShuffleJob(ShuffleExchangeExec.scala:68)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeLike.submitShuffleJob$(ShuffleExchangeExec.scala:67)
    at org.apache.spark.sql.execution.exchange.ShuffleExchangeExec.submitShuffleJob(ShuffleExchangeExec.scala:115)
    at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.shuffleFuture$lzycompute(QueryStageExec.scala:170)
    at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.shuffleFuture(QueryStageExec.scala:170)
    at org.apache.spark.sql.execution.adaptive.ShuffleQueryStageExec.doMaterialize(QueryStageExec.scala:172)
    at org.apache.spark.sql.execution.adaptive.QueryStageExec.materialize(QueryStageExec.scala:82)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$5(AdaptiveSparkPlanExec.scala:256)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$5$adapted(AdaptiveSparkPlanExec.scala:254)
    at scala.collection.immutable.List.foreach(List.scala:431)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.$anonfun$getFinalPhysicalPlan$1(AdaptiveSparkPlanExec.scala:254)
    at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:775)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.getFinalPhysicalPlan(AdaptiveSparkPlanExec.scala:226)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.withFinalPlanUpdate(AdaptiveSparkPlanExec.scala:365)
    at org.apache.spark.sql.execution.adaptive.AdaptiveSparkPlanExec.doExecute(AdaptiveSparkPlanExec.scala:350)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$execute$1(SparkPlan.scala:184)
    at org.apache.spark.sql.execution.SparkPlan.$anonfun$executeQuery$1(SparkPlan.scala:222)
    at org.apache.spark.rdd.RDDOperationScope$.withScope(RDDOperationScope.scala:151)
    at org.apache.spark.sql.execution.SparkPlan.executeQuery(SparkPlan.scala:219)
    at org.apache.spark.sql.execution.SparkPlan.execute(SparkPlan.scala:180)
    at org.apache.spark.sql.execution.datasources.FileFormatWriter$.write(FileFormatWriter.scala:186)
    at org.apache.spark.sql.execution.datasources.InsertIntoHadoopFsRelationCommand.run(InsertIntoHadoopFsRelationCommand.scala:186)
    at org.apache.spark.sql.execution.command.DataWritingCommandExec.sideEffectResult$lzycompute(commands.scala:113)
    at org.apache.spark.sql.execution.command.DataWritingCommandExec.sideEffectResult(commands.scala:111)
    at org.apache.spark.sql.execution.command.DataWritingCommandExec.executeCollect(commands.scala:125)
    at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.$anonfun$applyOrElse$1(QueryExecution.scala:110)
    at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$5(SQLExecution.scala:103)
    at org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:163)
    at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:90)
    at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:775)
    at org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)
    at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.applyOrElse(QueryExecution.scala:110)
    at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.applyOrElse(QueryExecution.scala:106)
    at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformDownWithPruning$1(TreeNode.scala:481)
    at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:82)
    at org.apache.spark.sql.catalyst.trees.TreeNode.transformDownWithPruning(TreeNode.scala:481)
    at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.org$apache$spark$sql$catalyst$plans$logical$AnalysisHelper$$super$transformDownWithPruning(LogicalPlan.scala:30)
    at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.transformDownWithPruning(AnalysisHelper.scala:267)
    at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.transformDownWithPruning$(AnalysisHelper.scala:263)
    at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.transformDownWithPruning(LogicalPlan.scala:30)
    at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.transformDownWithPruning(LogicalPlan.scala:30)
    at org.apache.spark.sql.catalyst.trees.TreeNode.transformDown(TreeNode.scala:457)
    at org.apache.spark.sql.execution.QueryExecution.eagerlyExecuteCommands(QueryExecution.scala:106)
    at org.apache.spark.sql.execution.QueryExecution.commandExecuted$lzycompute(QueryExecution.scala:93)
    at org.apache.spark.sql.execution.QueryExecution.commandExecuted(QueryExecution.scala:91)
    at org.apache.spark.sql.execution.QueryExecution.assertCommandExecuted(QueryExecution.scala:128)
    at org.apache.spark.sql.DataFrameWriter.runCommand(DataFrameWriter.scala:848)
    at org.apache.spark.sql.DataFrameWriter.saveToV1Source(DataFrameWriter.scala:382)
    at org.apache.spark.sql.DataFrameWriter.saveInternal(DataFrameWriter.scala:355)
    at org.apache.spark.sql.DataFrameWriter.save(DataFrameWriter.scala:239)
    at org.apache.spark.sql.DataFrameWriter.parquet(DataFrameWriter.scala:781)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at java.lang.reflect.Method.invoke(Method.java:498)
    at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
    at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)
    at py4j.Gateway.invoke(Gateway.java:282)
    at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
    at py4j.commands.CallCommand.execute(CallCommand.java:79)
    at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)
    at py4j.ClientServerConnection.run(ClientServerConnection.java:106)
    at java.lang.Thread.run(Thread.java:750)
Caused by: org.codehaus.janino.InternalCompilerException: Code of method &#34;bhj_doConsume_0$(Lorg/apache/spark/sql/catalyst/expressions/GeneratedClass$GeneratedIteratorForCodegenStage4;Lorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;Lorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZLorg/apache/spark/unsafe/types/UTF8String;ZDZ)V&#34; of class &#34;org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage4&#34; grows beyond 64 KB
    at org.codehaus.janino.CodeContext.makeSpace(CodeContext.java:1051)
    at org.codehaus.janino.CodeContext.write(CodeContext.java:932)
    at org.codehaus.janino.UnitCompiler.writeByte(UnitCompiler.java:12085)
    at org.codehaus.janino.UnitCompiler.store(UnitCompiler.java:11769)
    at org.codehaus.janino.UnitCompiler.store(UnitCompiler.java:11756)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2597)
    at org.codehaus.janino.UnitCompiler.access$2700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitLocalVariableDeclarationStatement(UnitCompiler.java:1506)
    at org.codehaus.janino.UnitCompiler$6.visitLocalVariableDeclarationStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$LocalVariableDeclarationStatement.accept(Java.java:3712)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1598)
    at org.codehaus.janino.UnitCompiler.access$2600(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitDoStatement(UnitCompiler.java:1505)
    at org.codehaus.janino.UnitCompiler$6.visitDoStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$DoStatement.accept(Java.java:3664)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1598)
    at org.codehaus.janino.UnitCompiler.access$2600(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitDoStatement(UnitCompiler.java:1505)
    at org.codehaus.janino.UnitCompiler$6.visitDoStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$DoStatement.accept(Java.java:3664)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2486)
    at org.codehaus.janino.UnitCompiler.access$1900(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1498)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$IfStatement.accept(Java.java:3140)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1848)
    at org.codehaus.janino.UnitCompiler.access$2200(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitWhileStatement(UnitCompiler.java:1501)
    at org.codehaus.janino.UnitCompiler$6.visitWhileStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$WhileStatement.accept(Java.java:3245)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:1559)
    at org.codehaus.janino.UnitCompiler.access$1700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1496)
    at org.codehaus.janino.UnitCompiler$6.visitBlock(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$Block.accept(Java.java:2969)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:2486)
    at org.codehaus.janino.UnitCompiler.access$1900(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1498)
    at org.codehaus.janino.UnitCompiler$6.visitIfStatement(UnitCompiler.java:1490)
    at org.codehaus.janino.Java$IfStatement.accept(Java.java:3140)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:1490)
    at org.codehaus.janino.UnitCompiler.compileStatements(UnitCompiler.java:1573)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:3420)
    at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1362)
    at org.codehaus.janino.UnitCompiler.compileDeclaredMethods(UnitCompiler.java:1335)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:807)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:975)
    at org.codehaus.janino.UnitCompiler.access$700(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$2.visitMemberClassDeclaration(UnitCompiler.java:392)
    at org.codehaus.janino.UnitCompiler$2.visitMemberClassDeclaration(UnitCompiler.java:384)
    at org.codehaus.janino.Java$MemberClassDeclaration.accept(Java.java:1445)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:384)
    at org.codehaus.janino.UnitCompiler.compileDeclaredMemberTypes(UnitCompiler.java:1312)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:833)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:410)
    at org.codehaus.janino.UnitCompiler.access$400(UnitCompiler.java:226)
    at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:389)
    at org.codehaus.janino.UnitCompiler$2.visitPackageMemberClassDeclaration(UnitCompiler.java:384)
    at org.codehaus.janino.Java$PackageMemberClassDeclaration.accept(Java.java:1594)
    at org.codehaus.janino.UnitCompiler.compile(UnitCompiler.java:384)
    at org.codehaus.janino.UnitCompiler.compile2(UnitCompiler.java:362)
    ... 117 more
23/05/04 09:25:44 WARN WholeStageCodegenExec: Whole-stage codegen disabled for plan (id=4):
 *(4) Project [CASE WHEN CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN false ELSE false END THEN Infinity ELSE LOG2(cast(cast((((((CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN true WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.003902390004522083 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.3365268364360054 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.27677318122666966 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN true ELSE false END THEN 0.1990847971311897 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE true END THEN 0.0010900609336073567 END * CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN true WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END) * CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN true WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 0.45896561950688874 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 1.0 END) * CASE WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN true WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN true WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 256.78780963847476 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN true WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 236.76780078519445 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN true ELSE false END THEN 207.73789452299874 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE true END THEN 0.13449069645050282 END) as string) as double)) END AS match_weight#1666, CASE WHEN CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN false ELSE false END THEN 1.0 ELSE (CASE WHEN CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN false ELSE false END THEN Infinity ELSE cast(cast((((((CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN true WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.003902390004522083 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.3365268364360054 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.27677318122666966 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN true ELSE false END THEN 0.1990847971311897 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE true END THEN 0.0010900609336073567 END * CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN true WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END) * CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN true WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 0.45896561950688874 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 1.0 END) * CASE WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN true WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN true WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 256.78780963847476 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN true WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 236.76780078519445 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN true ELSE false END THEN 207.73789452299874 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE true END THEN 0.13449069645050282 END) as string) as double) END / CASE WHEN CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN false ELSE false END THEN Infinity ELSE (1.0 + cast(cast((((((CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN true WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.003902390004522083 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.3365268364360054 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.27677318122666966 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN true ELSE false END THEN 0.1990847971311897 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE true END THEN 0.0010900609336073567 END * CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN true WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END) * CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN true WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 0.45896561950688874 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 1.0 END) * CASE WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN true WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN true WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 256.78780963847476 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN true WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 236.76780078519445 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN true ELSE false END THEN 207.73789452299874 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE true END THEN 0.13449069645050282 END) as string) as double)) END) END AS match_probability#1667, unique_id#334 AS unique_id_l#1547, unique_id#1653 AS unique_id_r#1548, first_name#335 AS first_name_l#1549, first_name#1654 AS first_name_r#1550, CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN -1 WHEN (first_name#335 = first_name#1654) THEN 3 WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN 2 WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN 1 ELSE 0 END AS gamma_first_name#1661, CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN true WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 86.2360850776162 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 70.92401859013204 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN true ELSE false END THEN 51.01612009575941 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE true END THEN 0.2793316230167143 END AS bf_first_name#1668, surname#336 AS surname_l#1551, surname#1655 AS surname_r#1552, CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN -1 WHEN (surname#336 = surname#1655) THEN 3 WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN 2 WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN 1 ELSE 0 END AS gamma_surname#1662, CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN true WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END AS bf_surname#1669, dob#337 AS dob_l#1553, dob#1656 AS dob_r#1554, CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN -1 WHEN (dob#337 = dob#1656) THEN 5 WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN 4 WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN 3 WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN 2 WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN 1 ELSE 0 END AS gamma_dob#1663, CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN true WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END AS bf_dob#1670, city#338 AS city_l#1555, city#1657 AS city_r#1556, CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN -1 WHEN (city#338 = city#1657) THEN 1 ELSE 0 END AS gamma_city#1664, tf_city#341 AS tf_city_l#1557, tf_city#1660 AS tf_city_r#1558, CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 0.45896561950688874 END AS bf_city#1671, CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 1.0 END AS bf_tf_adj_city#1672, email#339 AS email_l#1559, ... 4 more fields]
+- *(4) BroadcastHashJoin [surname#336], [surname#1655], Inner, BuildRight, (((unique_id#334 &lt; unique_id#1653) AND (CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN false WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN (POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) = Infinity) ELSE false END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN false ELSE false END OR (LOG2(cast(cast((((((CASE WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN true WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.003902390004522083 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.3365268364360054 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN true WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE false END THEN 0.27677318122666966 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN true ELSE false END THEN 0.1990847971311897 WHEN CASE WHEN (isnull(first_name#335) OR isnull(first_name#1654)) THEN false WHEN (first_name#335 = first_name#1654) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.95) THEN false WHEN (jaro_winkler(first_name#335, first_name#1654) &gt;= 0.88) THEN false ELSE true END THEN 0.0010900609336073567 END * CASE WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN true WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 91.08622270105276 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN true WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE false END THEN 84.76958263140128 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN true ELSE false END THEN 57.648261658181795 WHEN CASE WHEN (isnull(surname#336) OR isnull(surname#1655)) THEN false WHEN (surname#336 = surname#1655) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.95) THEN false WHEN (jaro_winkler(surname#336, surname#1655) &gt;= 0.88) THEN false ELSE true END THEN 0.2827410382590715 END) * CASE WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN true WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 224.04335331944097 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN true WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 93.3426724371058 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 13.284421514226679 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN true WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE false END THEN 2.014287367664165 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN true ELSE false END THEN 0.41016658710113535 WHEN CASE WHEN (isnull(dob#337) OR isnull(dob#1656)) THEN false WHEN (dob#337 = dob#1656) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 1) THEN false WHEN (levenshtein(dob#337, dob#1656) &lt;= 2) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 1) THEN false WHEN (FLOOR(abs((months_between(gettimestamp(dob#337, yyyy-MM-dd, TimestampType, Some(Europe/London), false), gettimestamp(dob#1656, yyyy-MM-dd, TimestampType, Some(Europe/London), false), true, Some(Europe/London)) / 12.0), false)) &lt;= 10) THEN false ELSE true END THEN 8.919181060305974E-7 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN 10.269631237504209 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 0.45896561950688874 END) * CASE WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN true WHEN (city#338 = city#1657) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN true ELSE false END THEN CASE WHEN isnotnull(coalesce(tf_city#341, tf_city#1660)) THEN POWER((0.0551475711801453 / CASE WHEN (coalesce(tf_city#341, tf_city#1660) &gt;= coalesce(tf_city#1660, tf_city#341)) THEN coalesce(tf_city#341, tf_city#1660) ELSE coalesce(tf_city#1660, tf_city#341) END), 1.0) ELSE 1.0 END WHEN CASE WHEN (isnull(city#338) OR isnull(city#1657)) THEN false WHEN (city#338 = city#1657) THEN false ELSE true END THEN 1.0 END) * CASE WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN true WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 1.0 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN true WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 256.78780963847476 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN true WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE false END THEN 236.76780078519445 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN true ELSE false END THEN 207.73789452299874 WHEN CASE WHEN (isnull(email#339) OR isnull(email#1658)) THEN false WHEN (email#339 = email#1658) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 1) THEN false WHEN (levenshtein(email#339, email#1658) &lt;= 2) THEN false ELSE true END THEN 0.13449069645050282 END) as string) as double)) &gt;= 3.1699250014423126))) AND NOT coalesce((first_name#335 = first_name#1654), false)), false
   :- *(4) Filter (isnotnull(unique_id#334) AND isnotnull(surname#336))
   :  +- *(4) ColumnarToRow
   :     +- FileScan parquet [unique_id#334,first_name#335,surname#336,dob#337,city#338,email#339,tf_city#341] Batched: true, DataFilters: [isnotnull(unique_id#334), isnotnull(surname#336)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/Users/rosskennedy/splink_demos/tmp_checkpoints/4a3d6387-4dc2-4a2..., PartitionFilters: [], PushedFilters: [IsNotNull(unique_id), IsNotNull(surname)], ReadSchema: struct&lt;unique_id:string,first_name:string,surname:string,dob:string,city:string,email:string,tf_c...
   +- BroadcastQueryStage 1
      +- BroadcastExchange HashedRelationBroadcastMode(List(input[2, string, false]),false), [id=#4864]
         +- *(2) Filter (isnotnull(unique_id#1653) AND isnotnull(surname#1655))
            +- *(2) ColumnarToRow
               +- FileScan parquet [unique_id#1653,first_name#1654,surname#1655,dob#1656,city#1657,email#1658,tf_city#1660] Batched: true, DataFilters: [isnotnull(unique_id#1653), isnotnull(surname#1655)], Format: Parquet, Location: InMemoryFileIndex(1 paths)[file:/Users/rosskennedy/splink_demos/tmp_checkpoints/4a3d6387-4dc2-4a2..., PartitionFilters: [], PushedFilters: [IsNotNull(unique_id), IsNotNull(surname)], ReadSchema: struct&lt;unique_id:string,first_name:string,surname:string,dob:string,city:string,email:string,tf_c...

23/05/04 09:25:46 WARN DataSource: All paths were ignored:                      
  file:/Users/rosskennedy/splink_demos/tmp_checkpoints/4a3d6387-4dc2-4a2b-8726-37954ed09b3a/__splink__df_predict_8b906362e
</code>
</pre>
</div>
</div>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="highlight"><pre><span></span><code><span class="n">results</span><span class="o">.</span><span class="n">as_pandas_dataframe</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

</div>
<div class="output_wrapper">
<div class="output">
<div class="output_area">
<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="scoped">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_weight</th>
      <th>match_probability</th>
      <th>unique_id_l</th>
      <th>unique_id_r</th>
      <th>first_name_l</th>
      <th>first_name_r</th>
      <th>gamma_first_name</th>
      <th>bf_first_name</th>
      <th>surname_l</th>
      <th>surname_r</th>
      <th>...</th>
      <th>gamma_city</th>
      <th>tf_city_l</th>
      <th>tf_city_r</th>
      <th>bf_city</th>
      <th>bf_tf_adj_city</th>
      <th>email_l</th>
      <th>email_r</th>
      <th>gamma_email</th>
      <th>bf_email</th>
      <th>match_key</th>
    </tr>
  </thead>
<tbody>
    <tr>
      <th>0</th>
      <td>7.442390</td>
      <td>0.994284</td>
      <td>101</td>
      <td>103</td>
      <td>Alfie</td>
      <td>Alfie</td>
      <td>3</td>
      <td>86.236085</td>
      <td>Griffiths</td>
      <td>Griffihs</td>
      <td>...</td>
      <td>0</td>
      <td>0.014760</td>
      <td>0.001230</td>
      <td>0.458966</td>
      <td>1.000000</td>
      <td>a.griffiths@garner-bridges.com</td>
      <td>None</td>
      <td>-1</td>
      <td>1.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>6.319954</td>
      <td>0.987638</td>
      <td>366</td>
      <td>369</td>
      <td>Samuel</td>
      <td>Samuel</td>
      <td>3</td>
      <td>86.236085</td>
      <td>None</td>
      <td>Campbell</td>
      <td>...</td>
      <td>0</td>
      <td>0.001230</td>
      <td>0.022140</td>
      <td>0.458966</td>
      <td>1.000000</td>
      <td>samuelcampbell35@hebert.com</td>
      <td>samuelcampbell35@hebert.com</td>
      <td>3</td>
      <td>256.787810</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>12.763094</td>
      <td>0.999856</td>
      <td>417</td>
      <td>419</td>
      <td>Florence</td>
      <td>Florence</td>
      <td>3</td>
      <td>86.236085</td>
      <td>Brown</td>
      <td>Brown</td>
      <td>...</td>
      <td>1</td>
      <td>0.212792</td>
      <td>0.212792</td>
      <td>10.269631</td>
      <td>0.259162</td>
      <td>fb@reose.cem</td>
      <td>fb@reese.com</td>
      <td>1</td>
      <td>207.737895</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>13.709128</td>
      <td>0.999925</td>
      <td>607</td>
      <td>609</td>
      <td>Amelia</td>
      <td>Amelia</td>
      <td>3</td>
      <td>86.236085</td>
      <td>Porter</td>
      <td>Porter</td>
      <td>...</td>
      <td>1</td>
      <td>0.017220</td>
      <td>0.017220</td>
      <td>10.269631</td>
      <td>3.202498</td>
      <td>None</td>
      <td>None</td>
      <td>-1</td>
      <td>1.000000</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>16.264552</td>
      <td>0.999987</td>
      <td>708</td>
      <td>709</td>
      <td>Maya</td>
      <td>Maya</td>
      <td>3</td>
      <td>86.236085</td>
      <td>Curtsi</td>
      <td>Curtis</td>
      <td>...</td>
      <td>-1</td>
      <td>NaN</td>
      <td>0.022140</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>mcurtis53@simpsoun.com</td>
      <td>micurtis53@simpson.com</td>
      <td>1</td>
      <td>207.737895</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows  28 columns</p>
</div>
</div>
</div>
</div>
</div>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="example_febrl4.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Febrl4 link-only" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Febrl4 link-only
              </div>
            </div>
          </a>
        
        
          
          <a href="../topic_guides/backends.html" class="md-footer__link md-footer__link--next" aria-label="Next: Splink&#39;s SQL backends - Spark, DuckDB etc" rel="next">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Splink's SQL backends - Spark, DuckDB etc
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "content.tooltips", "header.autohide", "search.highlight", "search.share", "search.suggest", "navigation.footer"], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b4d07000.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>